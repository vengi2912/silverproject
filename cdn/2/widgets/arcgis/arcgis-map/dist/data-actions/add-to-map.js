System.register(["jimu-core","jimu-arcgis"],(function(e,t){var a={},i={};return{setters:[function(e){a.AbstractDataAction=e.AbstractDataAction,a.CONSTANTS=e.CONSTANTS,a.DataLevel=e.DataLevel,a.DataSourceStatus=e.DataSourceStatus,a.DataSourceTypes=e.DataSourceTypes,a.MutableStoreManager=e.MutableStoreManager,a.defaultMessages=e.defaultMessages,a.getAppStore=e.getAppStore,a.i18n=e.i18n,a.utils=e.utils},function(e){i.ActionType=e.ActionType,i.DataChangeStatus=e.DataChangeStatus,i.DataChangeType=e.DataChangeType,i.MapViewManager=e.MapViewManager,i.zoomToUtils=e.zoomToUtils}],execute:function(){e((()=>{var e={62686:e=>{"use strict";e.exports=i},79244:e=>{"use strict";e.exports=a}},t={};function r(a){var i=t[a];if(void 0!==i)return i.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,r),n.exports}r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="";var n={};return r.p=window.jimuConfig.baseUrl,(()=>{"use strict";r.r(n),r.d(n,{default:()=>i});var e=r(79244),t=r(62686),a=function(e,t,a,i){return new(a||(a=Promise))((function(r,n){function o(e){try{s(i.next(e))}catch(e){n(e)}}function u(e){try{s(i.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,u)}s((i=i.apply(e,t||[])).next())}))};class i extends e.AbstractDataAction{constructor(){super(...arguments),this._viewManager=t.MapViewManager.getInstance()}isSupported(t,i){return a(this,void 0,void 0,(function*(){var a,r;if(t.length>1)return!1;const n=t[0],o=null==n?void 0:n.dataSource,u=this._getActiveViewId(this.widgetId,(0,e.getAppStore)().getState().jimuMapViewsInfo),s=this._viewManager.getJimuMapViewById(u);if(!o||o.getStatus()===e.DataSourceStatus.NotReady)return!1;if(i!==e.DataLevel.DataSource)return!1;if(o.type===e.DataSourceTypes.ElevationLayer)return!1;if(o.type===e.DataSourceTypes.SubtypeSublayer)return!1;if([e.DataSourceTypes.SceneLayer,e.DataSourceTypes.SceneService,e.DataSourceTypes.BuildingSceneLayer,e.DataSourceTypes.BuildingGroupSubLayer,e.DataSourceTypes.BuildingComponentSubLayer].includes(o.type)&&"2d"===(null===(a=null==s?void 0:s.view)||void 0===a?void 0:a.type))return!1;if(s&&s.view){const t=s.view.map.layers.toArray().filter((t=>t.id&&t.id.includes(e.CONSTANTS.ADD_TO_MAP_DATA_ID_PREFIX)));if(t.length>0){if(t.some((e=>{const t=s.getJimuLayerViewByAPILayer(e);return!(!t||t.getLayerDataSource()!==o)})))return!1}}return o.supportSpatialInfo&&o.supportSpatialInfo()&&!!o.createJSAPILayerByDataSource&&!o.isInAppConfig()&&0===(null===(r=n.records)||void 0===r?void 0:r.length)}))}onExecute(i,r){return a(this,void 0,void 0,(function*(){var a,r;const n=this._getActiveViewId(this.widgetId,(0,e.getAppStore)().getState().jimuMapViewsInfo),o=(null===(a=e.MutableStoreManager.getInstance().getStateValue([this.widgetId]))||void 0===a?void 0:a.addToMapDatas)||{},u=e.i18n.getIntl(),s=i[0],d=s.name||"",c=u.formatMessage({id:"action_addedData",defaultMessage:e.defaultMessages.action_addedData},{label:d});o[`${e.CONSTANTS.ADD_TO_MAP_DATA_ID_PREFIX}dataAction_${e.utils.getUUID()}`]={mapWidgetId:this.widgetId,jimuMapViewId:n,dataSourceId:s.dataSource.id,type:t.ActionType.DataAction,dataChangeType:t.DataChangeType.Create,dataChangeStatus:t.DataChangeStatus.Pending,title:c},e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"addToMapDatas",o);const p=this._viewManager.getJimuMapViewById(n);return p&&(null===(r=s.dataSource)||void 0===r||r.createJSAPILayerByDataSource().then((e=>{t.zoomToUtils.zoomTo(null==p?void 0:p.view,e,{padding:{left:50,right:50,top:50,bottom:50}})}))),yield Promise.resolve(!0)}))}_getActiveViewId(e,t){let a=Object.keys(t||{}).find((a=>t[a].mapWidgetId===e&&t[a].isActive));return a||(a=Object.keys(t||{}).find((a=>t[a].mapWidgetId===e))),a}}})(),n})())}}}));