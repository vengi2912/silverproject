System.register(["jimu-core","jimu-arcgis"],(function(t,e){var o={},n={};return{setters:[function(t){o.AbstractDataAction=t.AbstractDataAction,o.DataLevel=t.DataLevel,o.DataSourceStatus=t.DataSourceStatus,o.Immutable=t.Immutable,o.MutableStoreManager=t.MutableStoreManager,o.i18n=t.i18n},function(t){n.MapViewManager=t.MapViewManager,n.featureUtils=t.featureUtils,n.loadArcGISJSAPIModules=t.loadArcGISJSAPIModules}],execute:function(){t((()=>{var t={62686:t=>{"use strict";t.exports=n},79244:t=>{"use strict";t.exports=o},88217:t=>{t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAABsklEQVRYCe2WP0vDUBTFz2sLuggZHASX4ORYd4eIi07WybVuOhTrF5BXv0CHIrjVUae2U12EDO7t6CRdBAeHgBR0aJ/vJkUi5OXlplOxB9qG++/8cptXCvx3CdYCZMuDKh4BUw9QLiCcqF8F+noIFIYQkx5kzY/i9vdsALLtQI07epxnH0kV4g6i0IA8H9nqC7aCMK/GA/3pZaqNGqpQkw5kc7Yhc6cdQN5UdbtrHmHMlDEt1Y3ZWcIOoNSFbYgxL4R+XtJlBwDK6SNSs9beUmq7Iek6a2hX9lHeWIezuoLuyysuH58xCj4NHeZwlg386SbzwdkJPHczNKdkZXsrjFGOKzZA82D31zhuRpugrXDFBqC7NYm+Eq7YAMHXt9GDtsAVG2D4/mH06OmHkSs2wGn3CUlboFhdnwSu2AB01HZuH8KjR2Zk7I/ewlieY5jrd4CMju/73JtNrGdvIHHKHMElwHIDC7ABoRq5H3Jl7y1ah/t9H3uH+s+r8Ky18QIyv67JeCjp2g5AXVyIjOY0OhsAB4JhzgPIAsE05wOkQeQwzweQBJHTnEbNJ9mSuNKvRdYP0GGJ/zuVb/EAAAAASUVORK5CYII="}},e={};function r(o){var n=e[o];if(void 0!==n)return n.exports;var i=e[o]={exports:{}};return t[o](i,i.exports,r),i.exports}r.d=(t,e)=>{for(var o in e)r.o(e,o)&&!r.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.p="";var i={};return r.p=window.jimuConfig.baseUrl,(()=>{"use strict";r.r(i),r.d(i,{default:()=>s});var t=r(79244),e=r(62686),o=function(t,e,o,n){return new(o||(o=Promise))((function(r,i){function u(t){try{a(n.next(t))}catch(t){i(t)}}function l(t){try{a(n.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(u,l)}a((n=n.apply(t,e||[])).next())}))};const n=r(88217);function u(){return{type:"esriPMS",height:24,width:24,angle:0,xoffset:0,yoffset:12,url:n}}function l(e){return e&&e.symbol||(e=function(){const e={symbol:u()};return(0,t.Immutable)(e)}()),e}var a=function(t,e,o,n){return new(o||(o=Promise))((function(r,i){function u(t){try{a(n.next(t))}catch(t){i(t)}}function l(t){try{a(n.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(u,l)}a((n=n.apply(t,e||[])).next())}))};class s extends t.AbstractDataAction{constructor(){super(...arguments),this.supportProviderWidget=!0}isSupported(e,o,n){return a(this,void 0,void 0,(function*(){var n;if(1===e.length){const r=e[0];if(r&&o===t.DataLevel.Records&&(null===(n=r.records)||void 0===n?void 0:n.length)>0&&r.dataSource&&r.dataSource.getStatus()!==t.DataSourceStatus.NotReady){if(this.getFeaturesWithGeometry(r.records).length>0)return!0}}return!1}))}onExecute(n,r,i,u){return a(this,void 0,void 0,(function*(){var r,a;this.closePopupIfTriggeredFromMapSelf(i);const s=n[0],A=s.dataSource,c=(null==A?void 0:A.getLayerDefinition)&&A.getLayerDefinition(),d=null==c?void 0:c.displayField,v={};(null===(r=null==s?void 0:s.records)||void 0===r?void 0:r.length)>0&&s.records.forEach((t=>{const e=t.getId();v[e]=t}));const p=t.i18n.getIntl(),f=yield e.featureUtils.convertDataRecordSetToFeatureSet(s),g=(null==f?void 0:f.features)||[],[y]=yield(0,e.loadArcGISJSAPIModules)(["esri/Graphic"]),h=yield function(t){return o(this,void 0,void 0,(function*(){const o=(yield(0,e.loadArcGISJSAPIModules)(["esri/symbols/support/jsonUtils"]))[0],n=function(t,e){let o=null;const n=null==t?void 0:t.symbol;if(n&&e)try{o=e.fromJSON(n)}catch(t){o=null}return o}(l(t),o);return n}))}(u),S=[];if(g.forEach((t=>{var e,o,n,r,i;const u=null==t?void 0:t.geometry;if(u){let l=null;if("point"===u.type||"multipoint"===u.type?l=u.clone():"extent"===u.type?l=null===(e=u.center)||void 0===e?void 0:e.clone():"polygon"===u.type?l=null===(o=u.centroid)||void 0===o?void 0:o.clone():"polyline"===u.type&&(l=null===(r=null===(n=u.extent)||void 0===n?void 0:n.center)||void 0===r?void 0:r.clone()),l){let e="";if(t&&d){e=(null===(i=null==t?void 0:t.attributes)||void 0===i?void 0:i[d])||"";const o=t.getObjectId(),n=v[o];if(n&&n.getFormattedFieldValue){const t=n.getFormattedFieldValue(d,this.intl||p);t&&(e=t)}}const o=new y({geometry:l,attributes:{title:e||""}});S.push(o)}}})),S.length>0){const e=t.MutableStoreManager.getInstance(),o={configSymbolJson:(null===(a=null==u?void 0:u.symbol)||void 0===a?void 0:a.asMutable())||null,symbol:h,graphics:S};e.updateStateValue(this.widgetId,"addMarkerData",o)}return!0}))}closePopupIfTriggeredFromMapSelf(t){var o,n;const r=this.widgetId;if(r&&r===t){const t=e.MapViewManager.getInstance().getJimuMapViewGroup(r);if(t){const e=t.getActiveJimuMapView();e&&(null===(n=null===(o=null==e?void 0:e.view)||void 0===o?void 0:o.popup)||void 0===n?void 0:n.visible)&&e.closePopup()}}}getFeaturesWithGeometry(t){const e=[];return(null==t?void 0:t.length)>0&&t.forEach((t=>{const o=t.feature;o&&o.geometry&&e.push(o)})),e}}})(),i})())}}}));