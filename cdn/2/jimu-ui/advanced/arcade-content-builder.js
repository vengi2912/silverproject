System.register(["jimu-core","jimu-for-builder","jimu-theme","jimu-ui"],(function(e,t){var a={},n={},r={},l={};return{setters:[function(e){a.ArcadeContentCapability=e.ArcadeContentCapability,a.ArcadeProfileContextProvider=e.ArcadeProfileContextProvider,a.ArcadeProfileType=e.ArcadeProfileType,a.CONSTANTS=e.CONSTANTS,a.DataSourceManager=e.DataSourceManager,a.DynamicStyleType=e.DynamicStyleType,a.Immutable=e.Immutable,a.JimuFieldType=e.JimuFieldType,a.React=e.React,a.arcadeContentUtils=e.arcadeContentUtils,a.classNames=e.classNames,a.css=e.css,a.getAppStore=e.getAppStore,a.hooks=e.hooks,a.indexedDBUtils=e.indexedDBUtils,a.injectIntl=e.injectIntl,a.jsx=e.jsx,a.loadArcGISJSAPIModule=e.loadArcGISJSAPIModule,a.moduleLoader=e.moduleLoader,a.urlUtils=e.urlUtils,a.uuidv1=e.uuidv1},function(e){n.helpUtils=e.helpUtils},function(e){r.withTheme=e.withTheme},function(e){l.Alert=e.Alert,l.Button=e.Button,l.Label=e.Label,l.Loading=e.Loading,l.LoadingType=e.LoadingType,l.Modal=e.Modal,l.ModalBody=e.ModalBody,l.ModalFooter=e.ModalFooter,l.ModalHeader=e.ModalHeader,l.Popper=e.Popper,l.TextArea=e.TextArea,l.TextInput=e.TextInput,l.Tooltip=e.Tooltip,l.defaultMessages=e.defaultMessages}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=r},4108:e=>{"use strict";e.exports=n},14321:e=>{"use strict";e.exports=l},23662:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.5 0a.5.5 0 0 0-.5.5V7H.5a.5.5 0 0 0 0 1H7v6.5a.5.5 0 0 0 1 0V8h6.5a.5.5 0 0 0 0-1H8V.5a.5.5 0 0 0-.5-.5"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},30655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},72259:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M14 8A6 6 0 1 1 2 8a6 6 0 0 1 12 0m1 0A7 7 0 1 1 1 8a7 7 0 0 1 14 0M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=a},94064:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .54.54 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.54.54 0 0 1 0 .738" clip-rule="evenodd"></path></svg>'},98657:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11 2v10H3V4.414L5.414 2zM2 4.414a1 1 0 0 1 .293-.707l2.414-2.414A1 1 0 0 1 5.414 1H11a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1zM13.048 3v10.56c0 .265-.214.48-.477.48H4V15h8.571c.79 0 1.429-.645 1.429-1.44V3z" clip-rule="evenodd"></path></svg>'}},t={};function o(a){var n=t[a];if(void 0!==n)return n.exports;var r=t[a]={exports:{}};return e[a](r,r.exports,o),r.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};return(()=>{"use strict";o.r(s),o.d(s,{ArcadeContentBuilder:()=>Y,ArcadeContentBuilderPopup:()=>Q});var e=o(79244),t=o(14321),a=o(1888),n=o(4108),r=o(28996),l=o.n(r),i=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a};const c=t=>{const a=window.SVG,{className:n}=t,r=i(t,["className"]),o=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:o,src:l()},r)):e.React.createElement("svg",Object.assign({className:o},r))};var d=o(98657),u=o.n(d),p=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a};const m=t=>{const a=window.SVG,{className:n}=t,r=p(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:l,src:u()},r)):e.React.createElement("svg",Object.assign({className:l},r))};var v=o(45508),f=o.n(v),y=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a};const g=t=>{const a=window.SVG,{className:n}=t,r=y(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:l,src:f()},r)):e.React.createElement("svg",Object.assign({className:l},r))};var b=o(23662),h=o.n(b),x=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a};const j=t=>{const a=window.SVG,{className:n}=t,r=x(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:l,src:h()},r)):e.React.createElement("svg",Object.assign({className:l},r))};var R=o(94064),S=o.n(R),O=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a};const w=t=>{const a=window.SVG,{className:n}=t,r=O(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:l,src:S()},r)):e.React.createElement("svg",Object.assign({className:l},r))};var N=o(30655),C=o.n(N),T=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a};const A=t=>{const a=window.SVG,{className:n}=t,r=T(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:l,src:C()},r)):e.React.createElement("svg",Object.assign({className:l},r))};var M=o(62838),k=o.n(M),P=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a};const I=t=>{const a=window.SVG,{className:n}=t,r=P(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:l,src:k()},r)):e.React.createElement("svg",Object.assign({className:l},r))};var E=o(72259),D=o.n(E),_=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a};const F=t=>{const a=window.SVG,{className:n}=t,r=_(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:l,src:D()},r)):e.React.createElement("svg",Object.assign({className:l},r))},L=e.css`
  display: flex;
  flex-direction: column;
  .icons-body {
    overflow: auto;
  }

  .text-input-and-icon-picker {
    width: calc(100% - 16px);
  }
`;const B=(0,a.withTheme)((0,e.injectIntl)((function(a){const n=a.inModal,r=a.expand,l=a.icons,o=e.React.useMemo((()=>{let t=null;return t=(null==l?void 0:l.length)>0?l:(0,e.Immutable)([]),t=t.filter((e=>!!e)),t}),[l]),s=a.onExpandChange,i=a.onClose,c=a.onIconsChange,[d,u]=e.hooks.useLoadedModule("jimu-ui/advanced/setting-components"),p=d&&u?u.SettingRow:null,[m,v]=e.hooks.useLoadedModule("jimu-ui/advanced/resource-selector"),f=v?v.IconPicker:null,y=d&&p&&m&&f,g=e.hooks.useTranslation(t.defaultMessages),b=g("icons"),h=g("add"),x=g("collapse"),R=g("expand"),S=g("close"),O=g("name"),N=g("icon"),C=g("remove"),T=g("duplicatedLabel"),M=e.React.useCallback((e=>{c&&c(e)}),[c]),k=e.React.useCallback((()=>{const t=o.asMutable({deep:!0}),a=function(e){let t="",a=0;function n(e){const t=/^Icon\s+([1-9]\d*)$/,a=e.match(t);return a?Number(a[1]):null}const r=[];(null==e?void 0:e.length)>0&&e.forEach((e=>{const t=null==e?void 0:e.name;t&&r.push(t)}));r.forEach((e=>{const t=n(e);"number"==typeof t&&t>0&&(a=Math.max(a,t))}));let l=a+1;for(;t=`Icon ${l}`,r.includes(t);)l++;return t}(o)||"",n={name:a,data:null};t.push(n);const r=(0,e.Immutable)(t);M(r)}),[o,M]),P=e.React.useCallback((()=>{s&&s(!r)}),[r,s]),E=e.React.useCallback((()=>{i&&i()}),[i]),D=e.React.useRef(o),_=e.React.useCallback((()=>{D.current=(0,e.Immutable)(o.asMutable({deep:!0}))}),[o]),B=e.React.useCallback(((e,t)=>{if(t&&(null==o?void 0:o.length)>0){if(o.find(((a,n)=>(null==a?void 0:a.name)===t&&n!==e)))return{valid:!1,msg:T}}return{valid:!0}}),[T,o]),U=e.React.useCallback((e=>({valid:!0})),[]),K=e.React.useCallback(((e,t)=>{const a=o.map(((a,n)=>{if(n===e){return a.set("name",t)}return a}));M(a)}),[o,M]),V=e.React.useCallback(((e,t)=>{var a;const n=(null===(a=null==t?void 0:t.target)||void 0===a?void 0:a.value)||"";K(e,n)}),[K]),$=e.React.useCallback(((e,t)=>{var a;let n=(null===(a=null==t?void 0:t.target)||void 0===a?void 0:a.value)||"";n=n.trim();if(!(n&&B(e,n).valid)){const t=D.current,a=t&&e<=t.length-1?t[e]:null,n=null==a?void 0:a.name;n&&K(e,n)}}),[K,B]),z=e.React.useCallback(((e,t)=>{const a=o.map(((a,n)=>{if(n===e){return a.set("data",t)}return a}));M(a)}),[o,M]),H=e.React.useCallback((e=>{const t=o.filter(((t,a)=>a!==e));M(t)}),[o,M]),J=!(!n&&!r);return(0,e.jsx)("div",{className:(0,e.classNames)("icons-selector h-100 p-3",a.className),css:L},y&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(p,null,(0,e.jsx)(t.Label,{className:"w-100 d-inline"},b),J&&(0,e.jsx)(t.Button,{className:"add-icon-btn mr-2",icon:!0,size:"sm",type:"tertiary",title:h,"aria-label":h,onClick:k},(0,e.jsx)(j,null)),!n&&(0,e.jsx)(t.Button,{className:"collapse-icon-btn",icon:!0,size:"sm",type:"tertiary",title:r?x:R,"aria-label":r?x:R,onClick:P},r?(0,e.jsx)(w,null):(0,e.jsx)(A,null)),n&&(0,e.jsx)(t.Button,{className:"close-btn",icon:!0,size:"sm",type:"tertiary",title:S,"aria-label":S,onClick:E},(0,e.jsx)(I,null))),J&&(0,e.jsx)("div",{className:"icons-body h-100"},(null==o?void 0:o.length)>0&&(0,e.jsx)(p,{className:"mt-2"},(0,e.jsx)(t.Label,{className:"d-inline",style:{width:"70px"}},O),(0,e.jsx)(t.Label,{className:"d-inline ml-3"},N)),null==o?void 0:o.map(((a,n)=>(0,e.jsx)(p,{key:n},(0,e.jsx)("div",{className:"text-input-and-icon-picker d-flex"},(0,e.jsx)(t.TextInput,{required:!0,size:"sm",style:{width:"70px"},value:(null==a?void 0:a.name)||"",onFocus:_,checkValidityOnChange:e=>B(n,e),checkValidityOnAccept:U,onChange:e=>{V(n,e)},onBlur:e=>{$(n,e)}}),(0,e.jsx)(f,{className:"ml-3",icon:null==a?void 0:a.data,configurableOption:"none",onChange:e=>{z(n,e)},"aria-label":N,setButtonUseColor:!1})),(0,e.jsx)(t.Button,{icon:!0,size:"sm",type:"tertiary",title:C,"aria-label":C,onClick:()=>{H(n)}},(0,e.jsx)(F,null))))))))})));function U(t){var a;if(!t)return null;const n=function(){const t=(0,e.getAppStore)().getState(),a=window.jimuConfig.isBuilder?null==t?void 0:t.appStateInBuilder:t;return null==a?void 0:a.appConfig}();return null===(a=null==n?void 0:n.widgets)||void 0===a?void 0:a[t]}var K=function(e,t,a,n){return new(a||(a=Promise))((function(r,l){function o(e){try{i(n.next(e))}catch(e){l(e)}}function s(e){try{i(n.throw(e))}catch(e){l(e)}}function i(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}i((n=n.apply(e,t||[])).next())}))};let V=0;const $=e.css`
position: relative;
flex-direction: column;

.hidden {
  visibility: hidden;
}

.script-section {
  position: relative;
  display: flex;
  flex-direction: column;

  .text-area-container {
    position: relative;

    .jimu-input-area {
      textarea {
        height: 100%;
        resize: none;
      }
    }

    .copy-script-btn {
      position: absolute;
      right: 0;
      top: 0;
      cursor: pointer;
    }
  }
}

.arcade-script-stored-locally-tip {
  color: var(--sys-color-surface-overlay-hint, #DCDCDC);
  line-height: 20px;
}

.modal-arcgis-arcade-editor-container {
  position: relative;
  height: 600px;
  max-height: calc(100vh - 298px);

  .modal-arcgis-arcade-editor-overlay {
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
  }
}

.invalid-msg {
  white-space: nowrap;
  align-items: center;
}

arcgis-arcade-editor {
  --arcgis-coding-components-border: 1px solid var(--sys-color-divider-secondary, #585858);
  border-color: var(--sys-color-divider-secondary, #585858);

  calcite-action-bar.main-action-bar,
  arcgis-editor-variables.side-panel,
  arcgis-language-api-panel.side-panel,
  arcgis-arcade-suggestions.side-panel,
  calcite-action-bar.side-action-bar {
    border-color: var(--sys-color-divider-secondary, #585858);
  }
}

.arcade-content-builder-loading {
  background-color: var(--ref-palette-custom1-300);
}

.modal-icons-section {
  height: 40px;
  border: 1px solid var(--sys-color-divider-secondary, #585858);
  border-top: none;
}
`;function z(a){const n=a.invalidMessage,r=a.invalidKeys,l=a.unsupportedReturnTypeLabel;if(n){const o=(0,e.jsx)("div",{className:(0,e.classNames)("invalid-msg d-flex",a.className)},(0,e.jsx)(c,{size:16,color:"var(--sys-color-error-main)"}),(0,e.jsx)(t.Label,{className:"mb-0 ml-1"},n));let s="";return(null==r?void 0:r.length)>0&&(s=l+": "+r.join(", ")),s?(0,e.jsx)(t.Tooltip,{title:s,showArrow:!0,placement:"top"},o):o}return null}function H(e){let t=null;if(null==e||"number"==typeof e||"string"==typeof e||"boolean"==typeof e||e instanceof Date)t=e;else if(e&&"esri.arcade.Dictionary"===e.declaredClass){t={};const a=e.attributes;a&&Object.keys(a).forEach((e=>{t[e]=H(a[e])}))}else J(e)||G(e)?t=e.toString():Array.isArray(e)&&(t=e.map((e=>H(e))));return t}function J(e){return"esri.core.sql.dateonly"===(null==e?void 0:e.declaredRootClass)}function G(e){return"esri.core.sql.timeonly"===(null==e?void 0:e.declaredRootClass)}function q(e,t){if(e&&t){const{profile:a,profileVariableInstances:n,timeZone:r}=t;e.profile=a,e.testData={profileVariableInstances:n,timeZone:r||"system"}}}function W(t,a,n,r,l,o){const s={id:t,title:a,scriptContent:n,valueType:r,icons:l};(null==o?void 0:o.length)>0&&(s.useDataSources=o);return(0,e.Immutable)(s)}function X(t){return`${e.arcadeContentUtils.doesWidgetHaveRepeatDataSource(t)?e.CONSTANTS.FEATURE_PROFILE_ARCADE_CONTENT_ID_PREFIX:e.CONSTANTS.DATA_SOURCES_PROFILE_ARCADE_CONTENT_ID_PREFIX}${(0,e.uuidv1)()}`}const Y=(0,a.withTheme)((0,e.injectIntl)((function(a){const r=a.onChange,l=a.capabilities,o=e.React.useMemo((()=>(null==l?void 0:l.length)>0?l:[e.ArcadeContentCapability.Value,e.ArcadeContentCapability.Style]),[l]),s=a.useTitle,i=a.widgetId,c=e.React.useRef(i);c.current=i;const d=a.config,u=null==d?void 0:d.id,p=e.React.useMemo((()=>{let e=d;if(e){if(!e.id){const t=X(i);e=e.set("id",t)}}else{e=W(X(i),"","",null,[],null)}return e}),[d,i]),v=p.id,f=e.React.useRef(v);f.current=v;const y=a.useDataSources,b=a.dynamicStyleTypes,h=a.modalOnly,x=a.insertMode,j=a.onModalClose,[R,S]=e.React.useState(!1),O=e.React.useRef(null);O.current=y,e.React.useEffect((()=>{const t=O.current;(null==t?void 0:t.length)>0&&function(t){return K(this,void 0,void 0,(function*(){if((null==t?void 0:t.length)>0){const a=e.DataSourceManager.getInstance(),n=t.map((e=>K(this,void 0,void 0,(function*(){try{yield a.createDataSourceByUseDataSource(e)}catch(t){console.error("dsManager.createDataSourceByUseDataSource() error",e,t)}}))));yield Promise.all(n)}}))}(t).then((()=>{S(!0)}))}),[]);const[w,N]=e.hooks.useArcgisArcadeEditor(),C=e.React.useMemo((()=>{if(!u&&v&&v.includes(e.CONSTANTS.DATA_SOURCES_PROFILE_ARCADE_CONTENT_ID_PREFIX)){return!e.arcadeContentUtils.canAddNewDataSourcesProfileArcadeContent(i)}return!1}),[v,u,i]),T=p.title||"",A=p.scriptContent||"",M=p.icons,k=o.includes(e.ArcadeContentCapability.Value),P=o.includes(e.ArcadeContentCapability.Style),I=a.useIcons,E=e.React.useMemo((()=>!!o.includes(e.ArcadeContentCapability.Style)&&!("boolean"==typeof I&&!I)),[o,I]),[D,_]=e.React.useState(!1),F=D||h,L=e.React.useRef(0),[Y,Z]=e.React.useState(null),Q=e.React.useRef(null);Q.current=Y;const ee=e.React.useRef(!1),[te,ae]=e.React.useState(null),ne=!!te,re=e.React.useRef(null),[le,oe]=e.React.useState(!1),se=!R||!le||!ne,[ie,ce]=e.React.useState(!1),de=e.React.useRef(null),[ue,pe]=e.React.useState(!1),me=!R||!ue||!ne,[ve,fe]=e.React.useState(T),ye=e.React.useRef(T),[ge,be]=e.React.useState(A),[he,xe]=e.React.useState(""),[je,Re]=e.React.useState([]),[Se,Oe]=e.React.useState(M),we=e.React.useRef(null),[Ne,Ce]=e.React.useState(!1),[Te,Ae]=e.React.useState(!1),Me=e.React.useRef(),[ke,Pe]=e.React.useState(!1),Ie=ke?Me.current:null,Ee=e.hooks.useTranslation(t.defaultMessages),De=Ee("editScriptInArcadeEditor"),_e=Ee("arcadeEditor"),Fe=Ee("dataSourcesArcadeContentCountLimit"),Le=Ee("scriptInUse"),Be=Ee("addScriptFirst"),Ue=Ee("copyToClipboard"),Ke=Ee("scriptCopied"),Ve=Ee("arcadeScriptStoredLocally"),$e=Ee("reset"),ze=Ee("invalidArcadeScript"),He=Ee("unsupportedReturnType"),Je=Ee(x?"insert":"apply"),Ge=Ee("close"),qe=Ee("arcadeScript"),We=Ee("icons");e.React.useEffect((()=>{!function(){K(this,void 0,void 0,(function*(){let t="",a="";try{if(t=yield n.helpUtils.getWidgetHelpLink("advanced-formatting"),t||(t=""),t)try{a=yield e.urlUtils.createShortUrl(t),a||(a="")}catch(e){console.error("can not create short link for Arcade content help url",e),a=""}}catch(e){console.error("get Arcade content help doc url error",e)}ae({url:a||t||""})}))}()}),[]),e.React.useEffect((()=>(function(t){return K(this,void 0,void 0,(function*(){var a;let n=null;try{if(t){const r=U(t),l=(null===(a=null==r?void 0:r.manifest)||void 0===a?void 0:a.name)||t;n=new e.indexedDBUtils.IndexedDBCache(t,l,"arcade"),yield n.init()}}catch(e){console.error("initialize arcade db error",t,e),n=null}return n&&!n.initialized()&&(n=null),n}))}(c.current).then((e=>{Me.current=e,Pe(!0);const t=f.current;e&&t&&e.get(t).then((e=>{console.log("get Arcade script from indexedDB",t),"string"==typeof e&&e&&be(e)})).catch((e=>{console.error("get Arcade script from indexedDB error",t,e)}))})),()=>{Me.current&&Me.current.close()})),[]);const Xe=e.React.useCallback((e=>{r&&(ee.current=!0,r(e))}),[r]),Ye=e.React.useCallback((()=>{const t=Q.current;if(!u&&!A&&!ge&&t&&te){const a=function(t,a,n,r,l){var o;let s="";a&&(s=`// Documentation: ${a}\n\n`);let i="";if((null==t?void 0:t.type)===e.ArcadeProfileType.DataSourcesProfile){const u="function getFilteredFeatureSet(ds) {\n  var result = ds.layer;\n  var queryParams = ds.queryParams;\n\n  if (!IsEmpty(queryParams.where)) {\n    result = Filter(result, queryParams.where);\n  }\n\n  if (!IsEmpty(queryParams.geometry)) {\n    result = Intersects(result, queryParams.geometry);\n  }\n\n  return result;\n}\n\n",p=t,m=null===(o=null==p?void 0:p.profileVariableInstances)||void 0===o?void 0:o.$dataSources,v=[];if(m){const f=e.DataSourceManager.getInstance();Object.keys(m).forEach(((e,t)=>{const a=t+1,n=f.getDataSource(e);if(n){const t=`\n// ${n.getLabel()||e}\n// The filteredFeatureSet${a} has already been filtered using spatial filters and attribute filters.\n// var filteredFeatureSet${a} = getFilteredFeatureSet($dataSources["${e}"]);\n// selectedFeatures${a} is the selection view of data source.\n// var selectedFeatures${a} = $dataSources["${e}"].selectedFeatures;\n\n`;v.push(t)}}))}i=u+v.join("")}let c="";if(r&&(null==l?void 0:l.length)>0){function y(e,t){let a=e;const n=`[placeholder_${t}_start]`,r=`[placeholder_${t}_end]`,l=e.indexOf(n),o=e.indexOf(r);if(l>=0&&o>=0){const t=o+r.length;a=e.slice(0,l)+e.slice(t)}return a}c="\nreturn {\n  [placeholder_value_start]value: '',[placeholder_value_end]\n  [placeholder_background_start]background: {\n    // color: 'green',\n    // fillType: 'fill', // 'fit', 'fill', 'center', 'tile', 'stretch'\n    // image: ''\n  },[placeholder_background_end]\n  [placeholder_text_start]text: {\n    // size: 14,\n    // color: 'rgb(0, 0, 255)',\n    // bold: true,\n    // italic: false,\n    // underline: false,\n    // strike: false\n  },[placeholder_text_end]\n  [placeholder_border_start]border: {\n    // border: {\n    //   type: 'dashed', // 'solid', 'dashed', 'dotted', 'double'\n    //   color: 'red',\n    //   width: 1\n    // }\n  },[placeholder_border_end]\n  [placeholder_borderRadius_start]borderRadius: {\n    // unit: 'px', // 'px', 'rem', 'em', 'vw', '%'\n    // number: [5, 5, 5, 5]\n  },[placeholder_borderRadius_end]\n  [placeholder_icon_start]icon: {\n    // name: '',\n    // position: 'LEFT', // 'LEFT', 'RIGHT'\n    // size: 30,\n    // color: 'green'\n  }[placeholder_icon_end]\n};\n  ",n||(c=y(c,"value")),l.includes(e.DynamicStyleType.Background)||(c=y(c,"background")),l.includes(e.DynamicStyleType.Text)||(c=y(c,"text")),l.includes(e.DynamicStyleType.Border)||(c=y(c,"border")),l.includes(e.DynamicStyleType.BorderRadius)||(c=y(c,"borderRadius")),l.includes(e.DynamicStyleType.Icon)||(c=y(c,"icon"));const g=/\[placeholder_\w+_(?:start|end)\]/g;c=c.replace(g,"");const b=/^\s*$(?:\r\n?|\n)/gm;c=c.replace(b,""),c="\n"+c}else c=n?'return "";':"return {};";const d=s+i+c;return d}(t,te.url,k,P,b);a&&a!==A&&be(a)}}),[u,b,te,ge,A,P,k]),Ze=e.React.useRef();Ze.current=Ye;const Qe=e.React.useCallback((e=>{Q.current=e,Z(e),q(re.current,e),q(de.current,e),!Y&&e&&Ze.current()}),[Y]);e.React.useEffect((()=>{te&&Ze.current()}),[te]);const et=e.React.useRef(!1);et.current=s&&!T;const tt=e.React.useRef(!1),at=e.React.useRef("");at.current=Ee("arcade"),e.React.useEffect((()=>{if(et.current){V++,tt.current=!0;const e=`${at.current} ${V}`;fe(e)}return()=>{tt.current&&!ee.current&&V--}}),[]);const nt=e.React.useCallback((()=>{C||(xe(""),Re([]),Ae(!1),_(!0))}),[C]),rt=e.React.useCallback((()=>{!function(){K(this,void 0,void 0,(function*(){try{yield navigator.clipboard.writeText(A),ce(!0)}catch(e){console.error("copy Arcade script error",e)}finally{setTimeout((()=>{ce(!1)}),2e3)}}))}()}),[A]),lt=e.React.useCallback((e=>{e&&e.componentOnReady().then((()=>{oe(!0)})).catch((e=>{console.error("ArcgisArcadeEditor componentOnReady error",e)})),re.current=e,q(e,Y)}),[Y]),ot=Te||s&&!ve||!ge||ve===T&&ge===A&&Se===M,st=ge!==A&&!(!u&&x),it=e.React.useCallback((e=>{var t;const a=(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value)||"";fe(a)}),[]),ct=e.React.useCallback((e=>{var t;const a=(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value)||"";ye.current=a}),[]),dt=e.React.useCallback((e=>{var t;!((null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value)||"")&&ye.current&&fe(ye.current)}),[]),ut=e.React.useCallback((()=>{be(A)}),[A]),pt=e.React.useCallback((e=>{e&&e.componentOnReady().then((()=>{pe(!0)})).catch((e=>{console.error("ArcgisArcadeEditor componentOnReady error",e)})),de.current=e,q(e,Y)}),[Y]),mt=e.React.useCallback((e=>{const t=e.detail||"";be(t)}),[]),vt=e.React.useCallback((()=>{Ce(!Ne)}),[Ne]),ft=e.React.useCallback((()=>{Ce(!1)}),[]),yt=e.React.useCallback((()=>{Ce(!1)}),[]),gt=e.React.useCallback((e=>{Oe(e)}),[]),bt=e.React.useCallback((()=>{const t=de.current;if(!t)return;L.current++,Ae(!0);const a=L.current;(function(t,a,n,r,l){return K(this,void 0,void 0,(function*(){let o=null;const s={valueType:null,errorMsg:l,invalidKeys:[]},i={valueType:null,errorMsg:r,invalidKeys:[]},c=(null==a?void 0:a.script)||"",d=null==a?void 0:a.profile;let u=[];try{const r=a.getTestResult(),p=function(t,a,n){return K(this,void 0,void 0,(function*(){var r,l;let o=[];try{if(1===(null===(r=n.variables)||void 0===r?void 0:r.length)){const r=n.variables[0];if("$feature"===(null==r?void 0:r.name)&&1===(null==t?void 0:t.length)&&t[0]){const r=yield(0,e.loadArcGISJSAPIModule)("esri/arcade"),s=yield r.createArcadeExecutor(a,n);if((null===(l=null==s?void 0:s.fieldsUsed)||void 0===l?void 0:l.length)>0){const a=s.fieldsUsed.slice().map((e=>e.toLocaleLowerCase())),n=t[0].asMutable({deep:!0}),r=e.DataSourceManager.getInstance().getDataSource(n.dataSourceId);if(r){const e=r.getSchema(),t=null==e?void 0:e.fields;if(t){const e=Object.keys(t).filter((e=>a.includes(e.toLocaleLowerCase())));e.length>0&&(delete n.useFieldsInPopupInfo,delete n.useFieldsInSymbol,n.fields=e,o=[n])}}}}}}catch(e){console.error("getArcadeUseDataSources() error",e),o=[]}return o}))}(t,c,d),[m,v]=yield Promise.all([r,p]);if(u=v,m){const t=m.type;if("error"===t)return o=i,o;if("number"===t)o={valueType:e.JimuFieldType.Number,errorMsg:"",invalidKeys:[]};else if("text"===t)o={valueType:e.JimuFieldType.String,errorMsg:"",invalidKeys:[]};else if("date"===t)o={valueType:e.JimuFieldType.Date,errorMsg:"",invalidKeys:[]};else if("dateOnly"===t)o={valueType:e.JimuFieldType.DateOnly,errorMsg:"",invalidKeys:[]};else if("time"===t)o={valueType:e.JimuFieldType.TimeOnly,errorMsg:"",invalidKeys:[]};else if("dictionary"===t){const t=m.value;if(t&&"esri.arcade.Dictionary"===t.declaredClass){const a=t.attributes;if(a){const r=a.value;J(r)?o={valueType:e.JimuFieldType.DateOnly,errorMsg:"",invalidKeys:[]}:G(r)?o={valueType:e.JimuFieldType.TimeOnly,errorMsg:"",invalidKeys:[]}:"number"==typeof r?o={valueType:e.JimuFieldType.Number,errorMsg:"",invalidKeys:[]}:"string"==typeof r?o={valueType:e.JimuFieldType.String,errorMsg:"",invalidKeys:[]}:r instanceof Date?o={valueType:e.JimuFieldType.Date,errorMsg:"",invalidKeys:[]}:null==r&&(o=n?{valueType:null,errorMsg:l,invalidKeys:["value"]}:{valueType:null,errorMsg:"",invalidKeys:[]}),o||(o={valueType:null,errorMsg:l,invalidKeys:["value"]}),o.invalidKeys||(o.invalidKeys=[]);const s=H(t);if(s){delete s.value;const t=e.arcadeContentUtils.validateArcadeScriptResult(s);t.valid||(o.errorMsg=l),o.invalidKeys.push(...t.invalidKeys)}}}}o||(o=s)}}catch(e){console.error("ArcadeEditor can not get test result",e),o=i}return o&&n&&!o.valueType&&!o.errorMsg&&(o=i),o||(o=i),o.invalidKeys||(o.invalidKeys=[]),(null==u?void 0:u.length)>0&&(o.arcadeUseDataSources=u),o}))})(y,t,k,ze,He).then((e=>K(this,void 0,void 0,(function*(){if(L.current!==a)return;Ae(!1);const{valueType:t,errorMsg:n,invalidKeys:r,arcadeUseDataSources:l}=e;if(n)xe(n||ze),Re(r);else{const e=W(v,ve,ge,t,Se,l);if(Xe(e),xe(""),Re([]),_(!1),Ie&&v)try{yield Ie.delete(v),console.log("delete Arcade script from indexedDB",v)}catch(e){console.error("delete Arcade script from indexedDB error",v,e)}j&&j()}}))))}),[v,Ie,ze,ge,Se,ve,j,He,Xe,y,k]),ht=e.React.useCallback((()=>{if(L.current++,_(!1),Ae(!1),!x){let e=p;ve&&ve!==T&&(e=e.set("title",ve)),Se!==M&&(e=e.set("icons",Se));const t=!u&&e.id&&st;(t||u&&e!==p)&&Xe(e);Ie&&v&&(t||u)&&Ie.put(v,ge).then((()=>{console.log("save Arcade script into indexedDB",v)})).catch((e=>{console.error("save Arcade script into indexedDB error",v,e)}))}j&&j()}),[v,u,p,M,Ie,x,ge,Se,ve,j,st,T,Xe]),xt=h?"d-none":"d-flex";return(0,e.jsx)("div",{className:(0,e.classNames)("arcade-style-builder p-4 h-100",xt,a.className),css:$},!h&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)("div",{className:"mb-4","aria-label":De},De),(0,e.jsx)(t.Button,{className:"mb-4",color:"primary","aria-label":_e,disabled:C,onClick:nt},_e),C&&(0,e.jsx)(t.Alert,{className:"w-100 mt-2",form:"basic",text:Fe,type:"warning",withIcon:!0}),!C&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)("div",{className:"mb-4","aria-label":Le},Le),(0,e.jsx)("div",{className:"script-section h-100"},(0,e.jsx)("div",{className:"text-area-container h-100"},(0,e.jsx)(t.TextArea,{className:"h-100",disabled:!0,value:A,placeholder:Be}),A&&(0,e.jsx)(t.Tooltip,{title:Ke,open:ie,disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0},(0,e.jsx)(t.Button,{className:"copy-script-btn",size:"sm",icon:!0,type:"tertiary",target:"_blank",disableHoverEffect:!0,disableRipple:!0,title:Ue,"aria-label":Ue,onClick:rt},(0,e.jsx)(m,null)))))),w&&N&&(0,e.jsx)(N,{className:"hidden-arcgis-arcade-editor d-none",ref:lt,editorOptions:{theme:"vs-dark"},script:ge}),se&&(0,e.jsx)(t.Loading,{className:"arcade-content-builder-loading",type:t.LoadingType.Secondary})),(0,e.jsx)(e.ArcadeProfileContextProvider,{usedForArcadeEditor:!0,widgetId:i,useDataSources:y,onProfileContextChange:Qe}),F&&!C&&(0,e.jsx)(t.Modal,{className:(0,e.classNames)("arcade-editor-modal",a.className),css:$,style:{maxWidth:1120,flexDirection:"row"},centered:!0,contentClassName:"border-0 h-100",isOpen:!0,keyboard:!0},(0,e.jsx)(t.ModalHeader,{className:"d-flex justify-content-between align-items-center",toggle:ht},qe),(0,e.jsx)(t.ModalBody,{className:"w-auto pt-2"},s&&(0,e.jsx)("div",{className:"mb-2"},(0,e.jsx)(t.Label,null,Ee("name")),(0,e.jsx)(t.TextInput,{disabled:Te,value:ve,onChange:it,onFocus:ct,onBlur:dt})),(0,e.jsx)("div",{className:(0,e.classNames)(["arcade-script-stored-locally-tip-container d-flex align-items-center",{hidden:!st}])},(0,e.jsx)(g,{color:"var(--sys-color-info-main)"}),(0,e.jsx)("div",{className:"arcade-script-stored-locally-tip ml-2","aria-label":Ve},Ve),(0,e.jsx)(t.Button,{className:"ml-2",size:"sm",onClick:ut},$e)),w&&N&&(0,e.jsx)("div",{className:"modal-arcgis-arcade-editor-container mt-2"},(0,e.jsx)(N,{className:"modal-arcgis-arcade-editor h-100",ref:pt,editorOptions:{theme:"vs-dark"},script:ge,onArcgisScriptChange:mt}),Te&&(0,e.jsx)("div",{className:"modal-arcgis-arcade-editor-overlay"})),E&&(0,e.jsx)("div",{className:"modal-icons-section d-flex align-items-center w-100"},(0,e.jsx)(t.Button,{className:"ml-2",type:"default",size:"sm","aria-label":We,ref:we,onClick:vt},We),Ne&&(0,e.jsx)(t.Popper,{open:Ne,placement:"top-start",reference:we,toggle:ft,offsetOptions:[0,8]},(0,e.jsx)("div",{className:"modal-icons-selector-container",style:{minWidth:"230px",height:"246px"}},(0,e.jsx)(B,{inModal:!0,expand:!1,icons:Se,onClose:yt,onIconsChange:gt})))),me&&(0,e.jsx)(t.Loading,{className:"arcade-content-builder-loading",type:t.LoadingType.Secondary})),(0,e.jsx)(t.ModalFooter,{className:"d-flex flex-column pb-30"},(0,e.jsx)("div",{className:"w-100 d-flex justify-content-between"},(0,e.jsx)(z,{className:"modal-invalid-msg mr-2",invalidMessage:he,invalidKeys:je,unsupportedReturnTypeLabel:He}),(0,e.jsx)(t.Button,{type:"primary",className:"ml-auto mr-2",style:{minWidth:"64px",minHeight:"32px"},"aria-label":Je,disabled:ot,onClick:bt},Te&&(0,e.jsx)(t.Loading,{type:t.LoadingType.Donut,height:20,width:20}),!Te&&Je),!x&&(0,e.jsx)(t.Button,{type:"secondary",style:{minWidth:"64px",minHeight:"32px"},"aria-label":Ge,onClick:ht},Ge)))))})));class Z extends e.React.PureComponent{constructor(e){super(e),this.overflowYStyle={overflow:"hidden"},this.__unmount=!1,this.state={SidePopper:null}}componentDidMount(){this.__unmount=!1,e.moduleLoader.loadModule("jimu-ui/advanced/setting-components").then((e=>{!this.__unmount&&this.setState({SidePopper:e.SidePopper})}))}componentWillUnmount(){this.__unmount=!0}render(){const a=this.state.SidePopper,n=this.props.intl.formatMessage({id:"arcade",defaultMessage:t.defaultMessages.arcade});return(0,e.jsx)("div",{className:"arcade-content-builder-popup w-100 h-100"},a&&(0,e.jsx)(a,{isOpen:this.props.isOpen&&!e.urlUtils.getAppIdPageIdFromUrl().pageId,position:"right",toggle:this.props.onClose,trigger:this.props.trigger,backToFocusNode:this.props.backToFocusNode,title:n},(0,e.jsx)("div",{className:"h-100 bg-default border-color-gray-400 component-arcade-content-builder-popup"},(0,e.jsx)("div",{className:"w-100 h-100 arcade-popup"},(0,e.jsx)("div",{style:this.overflowYStyle,className:"h-100"},(0,e.jsx)(Y,Object.assign({},this.props)))))))}}const Q=(0,a.withTheme)((0,e.injectIntl)(Z))})(),s})())}}}));