System.register(["jimu-core","jimu-theme","jimu-ui"],(function(e,t){var o={},n={},a={};return{setters:[function(e){o.AppMode=e.AppMode,o.BaseVersionManager=e.BaseVersionManager,o.DynamicStyleResolverComponent=e.DynamicStyleResolverComponent,o.ExpressionResolverComponent=e.ExpressionResolverComponent,o.Immutable=e.Immutable,o.MutableStoreManager=e.MutableStoreManager,o.React=e.React,o.ReactRedux=e.ReactRedux,o.appActions=e.appActions,o.appConfigUtils=e.appConfigUtils,o.classNames=e.classNames,o.css=e.css,o.dynamicStyleUtils=e.dynamicStyleUtils,o.expressionUtils=e.expressionUtils,o.getAppStore=e.getAppStore,o.hooks=e.hooks,o.jsx=e.jsx,o.polished=e.polished},function(e){n.styled=e.styled,n.useTheme=e.useTheme},function(e){a.Popper=e.Popper,a.RichTextDisplayer=e.RichTextDisplayer,a.Scrollable=e.Scrollable,a.defaultMessages=e.defaultMessages,a.richTextUtils=e.richTextUtils,a.styleUtils=e.styleUtils}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=n},14321:e=>{"use strict";e.exports=a},17663:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.854 2.153a.485.485 0 0 0-.708 0 .54.54 0 0 0 0 .738l5.5 5.956a.485.485 0 0 0 .708 0l5.5-5.956a.54.54 0 0 0 0-.738.485.485 0 0 0-.708 0L8 7.74zm0 5a.485.485 0 0 0-.708 0 .54.54 0 0 0 0 .738l5.5 5.956a.485.485 0 0 0 .708 0l5.5-5.956a.54.54 0 0 0 0-.738.485.485 0 0 0-.708 0L8 12.74z" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=o}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,r),a.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="";var s={};return r.p=window.jimuConfig.baseUrl,(()=>{"use strict";r.r(s),r.d(s,{__set_webpack_public_path__:()=>k,default:()=>w});var e=r(79244),t=r(1888),o=r(17663),n=r.n(o),a=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(o[n[a]]=e[n[a]])}return o};const i=t=>{const o=window.SVG,{className:r}=t,s=a(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",r);return o?e.React.createElement(o,Object.assign({className:i,src:n()},s)):e.React.createElement("svg",Object.assign({className:i},s))};var l=r(14321),c=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(o[n[a]]=e[n[a]])}return o};const u=(0,t.styled)("div")((({theme:t,styleState:o})=>{var n;return{width:"100%",height:"100%",position:"relative",overflowY:"hidden",".rich-displayer":Object.assign(Object.assign({width:"100%",height:"fit-content",lineHeight:1.42},!o.wrap&&{whiteSpace:"preserve nowrap !important"}),{"a:focus":{outlineOffset:"-3px",outlineWidth:"2px"},"exp:hover,arcade:hover":{background:"transparent !important",outline:"none !important",cursor:"default !important"}}),".text-fade":{position:"absolute",left:"0",height:o.fadeLength,width:"100%",display:"flex",alignItems:"center",justifyContent:"flex-end",pointerEvents:"none","> .arrow":{position:"absolute",width:"16px",height:"16px",background:t.ref.palette.white,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center","&.arrow-bottom":{bottom:"4px"}},"&.text-fade-bottom":{bottom:"0",background:`linear-gradient(180deg, rgba(182, 182, 182, 0) 0%, ${e.polished.rgba(null!==(n=t.ref.palette.neutral[500])&&void 0!==n?n:"#444",.5)} 100%)`}},".bounce":{animationName:"bounce",animationDuration:"0.6s",animationIterationCount:"infinite",animationTimingFunction:"linear"},"@keyframes bounce":{"0%":{transform:"translateY(0px)"},"50%":{transform:"translateY(2px)"},"100%":{transform:"translateY(4px)"}}}}));function d(o){var n;const{value:a="",placeholder:r,repeatedDataSource:s,useDataSources:d,widgetId:p,wrap:g,tooltip:f,dynamicStyleConfig:m,onArcadeChange:b}=o,v=c(o,["value","placeholder","repeatedDataSource","useDataSources","widgetId","wrap","tooltip","dynamicStyleConfig","onArcadeChange"]),h=e.React.useMemo((()=>a.replace(/\ufeff/g,"")),[a]),S=(0,t.useTheme)(),y=e.React.useRef(),x=e.expressionUtils.isSingleStringExpression(f),[R,w]=e.React.useState(""),[k,O]=e.React.useState("24px"),[M,j]=e.React.useState(!1),[I,C]=e.React.useState(!1),[E,D]=e.React.useState(0),[P,U]=e.React.useState(!1),A=e.React.useCallback((e=>{if(null==e)return;const{scrollable:t,bottoming:o}=e;j(o),C(t)}),[]);e.React.useEffect((()=>{var t;if(null!=f&&x){const o=null!==(t=e.expressionUtils.getSingleStringExpressionText(f))&&void 0!==t?t:f.name;w(o)}}),[f,x]);const N=e.React.useRef();return e.React.createElement(u,Object.assign({styleState:{wrap:g,fadeLength:k},title:R,onMouseEnter:()=>{var e,t;null!=N.current&&(clearTimeout(N.current),N.current=null);const o=(n=null!==(t=null===(e=y.current)||void 0===e?void 0:e.clientHeight)&&void 0!==t?t:0)<=80?"0px":n<=140?"24px":"15%";var n;U("0px"!==o),D((e=>e+1)),O(o)},onMouseLeave:()=>{N.current=setTimeout((()=>{U(!1),N.current=null}),500)},ref:y},v),e.React.createElement(l.Scrollable,{ref:A,version:E},e.React.createElement(l.RichTextDisplayer,{widgetId:p,repeatedDataSource:s,useDataSources:d,value:h,placeholder:r})),P&&I&&!M&&e.React.createElement("div",{className:"text-fade text-fade-bottom"},e.React.createElement("span",{className:"arrow arrow-bottom rounded-circle mr-1"},e.React.createElement(i,{className:"bounce",color:null===(n=null==S?void 0:S.ref.palette)||void 0===n?void 0:n.black}))),!x&&f&&e.React.createElement(e.ExpressionResolverComponent,{useDataSources:d,expression:f,widgetId:p,onChange:e=>{(null==e?void 0:e.isSuccessful)?w(e.value):w("")}}),e.React.createElement(e.DynamicStyleResolverComponent,{widgetId:p,useDataSources:d,dynamicStyleConfig:m,onChange:e=>{if(e){const t=e.asMutable({deep:!0});(null==t?void 0:t.border)&&Object.assign(t,t.border),(null==t?void 0:t.borderRadius)&&(t.borderRadius.number=t.borderRadius.number.map((e=>null===e?0:e)));const o=l.styleUtils.toCSSStyle(t);null==b||b(o)}else null==b||b({})}}))}const p={_widgetLabel:"Text",defaultPlaceholder:"Double click to edit text"},g=JSON.parse('{"Qq":"<p></p>","qf":"Double click to edit text","iF":{"wrap":true}}');class f extends e.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.13.0",description:"Remove useless line-height: normal;",upgrader:e=>{var t;let o=null!==(t=e.text)&&void 0!==t?t:"";return o.includes("line-height: normal;")?(o=o.replace(/line-height: normal;/gm,"line-height: 1.2;"),e.set("text",o)):e}},{version:"1.17.0",description:"Complete the default config",upgrader:e=>{let t=e;return t.text||(t=t.set("text",g.Qq)),t.placeholder||(t=t.set("placeholder",g.qf)),t.style||(t=t.set("style",g.iF)),t}}]}}const m=new f;var b,v=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(o[n[a]]=e[n[a]])}return o};!function(e){e[e.None=0]="None",e[e.Main=1]="Main",e[e.Sub=2]="Sub"}(b||(b={}));const h=(e,t)=>(e===p.defaultPlaceholder&&(e=((e,t)=>null!==t?t.formatMessage({id:e,defaultMessage:p[e]}):"")("defaultPlaceholder",t)),e),S=(0,t.styled)("div")((({styleState:e})=>{const{dynamicStyles:t,color:o}=e,n=t||{},{backgroundColor:a,backgroundImage:r,backgroundPosition:s,backgroundRepeat:i,backgroundSize:l}=n,c=v(n,["backgroundColor","backgroundImage","backgroundPosition","backgroundRepeat","backgroundSize"]);return Object.assign(Object.assign({minHeight:"12px"},c),{backgroundColor:a,backgroundImage:r,backgroundPosition:s,backgroundRepeat:i,backgroundSize:l,color:c.color||o,"h1,h2,h3,h4,h5,h6,span,p,span,p,s,strong,em,u,ol,ul,li,exp,a,arcade":c})})),y={rootBoundary:"viewport",crossAxis:!0,padding:4},x={boundary:document.body,fallbackPlacements:["right-start","left-start","top","bottom","left","right","top-start","bottom-start"]},R=t=>{var o,n,a,r,s;const{builderSupportModules:i,id:c,intl:u,useDataSources:p,repeatedDataSource:g,useDataSourcesEnabled:f,isInlineEditing:m,config:v,onInitResizeHandler:R}=t,w=e.ReactRedux.useDispatch(),{current:k}=e.React.useRef((0,e.getAppStore)().getState().appContext.isInBuilder),O=e.hooks.useWidgetSelected(c),M=e.hooks.useLatest(O),j=e.React.useRef(null),I=e.ReactRedux.useSelector((e=>e.appRuntimeInfo.appMode)),C=e.ReactRedux.useSelector((e=>e.dynamicStyleState)),E=null==i?void 0:i.jimuForBuilderLib.getAppConfigAction,D=null==i?void 0:i.widgetModules.Editor,P=null==i?void 0:i.widgetModules.builderUtils,U=null===(n=null===(o=v.style)||void 0===o?void 0:o.wrap)||void 0===n||n,A=null===(a=v.style)||void 0===a?void 0:a.color,N=e.React.useMemo((()=>e.appConfigUtils.processResourceUrl(v.text)),[v.text]),T=v.tooltip,z=h(v.placeholder,u),_=f?p:void 0,B=null!==(r=null==_?void 0:_.length)&&void 0!==r?r:0,F=null===(s=v.style)||void 0===s?void 0:s.dynamicStyleConfig,[L,W]=e.React.useState({}),[V,H]=e.React.useState(null),q=e.React.useRef(!1),Y=e.React.useMemo((()=>{let e=b.Sub;return e=null==g?b.None:0===g.recordIndex?b.Main:b.Sub,e}),[g]),Q=e.React.useMemo((()=>{var e,t;return"number"==typeof(null===(t=null===(e=null==C?void 0:C.previewConditionInfo)||void 0===e?void 0:e[c])||void 0===t?void 0:t.conditionId)}),[C,c]),$=e.hooks.usePrevious(Q);e.React.useEffect((()=>{var t,o;if(Q&&!$&&g){const n=g,a=(null===(o=null===(t=null==C?void 0:C.previewRepeatedRecordInfo)||void 0===t?void 0:t[n.widgetId])||void 0===o?void 0:o.asMutable())||{};w(e.appActions.changeDynamicStylePreviewRepeatedRecordInfo(n.widgetId,Object.assign(Object.assign({},a),{needUpdateRecordIndex:!0})))}}),[w,Q,$,g,C]);const G=e.React.useMemo((()=>{var e,t;let o=Q;if(g&&o){const n=g,a=n.widgetId,r=n.recordIndex;if(a&&void 0!==r){(null===(t=null===(e=null==C?void 0:C.previewRepeatedRecordInfo)||void 0===e?void 0:e[a])||void 0===t?void 0:t.recordIndex)!==r&&(o=!1)}}return o}),[C,Q,g]),J=e.hooks.useLatest(Y!==b.Sub);e.React.useEffect((()=>{J.current&&M.current&&I===e.AppMode.Run&&w(e.appActions.setWidgetIsInlineEditingState(c,!1))}),[J,M,I,w,c]),e.hooks.useUpdateEffect((()=>{J.current&&k&&(m&&0!==B||(w(e.appActions.widgetStatePropChange(c,"showExpression",!1)),w(e.appActions.widgetStatePropChange(c,"showArcade",!1))))}),[J,m,B,w,c]);const K=(I===e.AppMode.Design||I===e.AppMode.Express)&&Y!==b.Sub,X=K&&O,Z=K&&m,ee=e.React.useRef(!1);e.React.useEffect((()=>()=>{ee.current=!0}),[]),e.hooks.useUpdateEffect((()=>{if(!J.current)return;let t=l.richTextUtils.getAllExpressions(N);t=null!=t?t:(0,e.Immutable)({}),t=t.merge(null!=T?{tooltip:T}:{}),(q.current||0!==Object.keys(t).length)&&(q.current=Object.keys(t).length>0,H(t))}),[J,N,T,B]);const te=e.hooks.useEventCallback((()=>{if(ee.current)return;if(!k)return;const t=P.getExpressionParts(V);let o=e.expressionUtils.generateFieldsForUseDataSourcesByExpressionParts(t,_);if(F){const t=e.dynamicStyleUtils.generateFieldsForUseDataSourcesByDynamicStyle(F,_);o=e.expressionUtils.mergeUseDataSources(o,t)}((e,t)=>{if(!e||!t)return!1;if(e.length!==t.length)return!1;let o=!0;return e.forEach(((e,n)=>{var a,r,s,i,l;e.dataSourceId===t[n].dataSourceId&&(null===(r=null!==(a=e.fields)&&void 0!==a?a:[])||void 0===r?void 0:r.length)===(null===(i=null!==(s=t[n].fields)&&void 0!==s?s:[])||void 0===i?void 0:i.length)?null===(l=e.fields)||void 0===l||l.forEach(((e,a)=>{e!==t[n].fields[a]&&(o=!1)})):o=!1})),o})(_,o)||E((0,e.getAppStore)().getState().appConfig).editWidget({id:c,useDataSources:null==o?void 0:o.asMutable({deep:!0})}).exec()}));e.hooks.useUpdateEffect((()=>{te()}),[V,F,te]);const oe=e.React.useMemo((()=>{const e=e=>e?`${e} !important`:void 0;return{color:e(L.color),fontStyle:e(L.fontStyle),fontWeight:e(L.fontWeight),fontSize:e(L.fontSize),textDecoration:e(L.textDecoration),backgroundColor:e(L.backgroundColor),backgroundImage:e(L.backgroundImage),backgroundPosition:e(L.backgroundPosition),backgroundRepeat:e(L.backgroundRepeat),backgroundSize:e(L.backgroundSize)}}),[L]);return(0,e.jsx)(S,{"data-testid":"text-widget",className:(0,e.classNames)("widget-text jimu-widget p-1"),styleState:{dynamicStyles:oe,color:A},ref:j},X&&(0,e.jsx)(D,{className:(0,e.classNames)({"d-none":!Z}),widgetId:c,nowrap:!U,onInitResizeHandler:R,useDataSources:_,enabled:!!m,onCreate:t=>{e.MutableStoreManager.getInstance().updateStateValue(c,"editor",t)},onDestroy:()=>{e.MutableStoreManager.getInstance().updateStateValue(c,"editor",null)},onComplete:(e,t)=>{ee.current||k&&E().editWidget({id:c,config:v.set("text",e).set("placeholder",t)}).exec()},onEditorFocus:()=>{w(e.appActions.widgetToolbarStateChange(c,["text-inline-editing"]))},placeholder:z,preserveWhitespace:!0,value:N}),(0,e.jsx)(d,{className:(0,e.classNames)({"d-none":Z}),value:N,tooltip:T,wrap:U,placeholder:z,useDataSources:_,widgetId:c,dynamicStyleConfig:F,onArcadeChange:e=>{W(e)},repeatedDataSource:g}),(0,e.jsx)(l.Popper,{open:G,offsetOptions:[0,4],css:e.css`
          white-space: nowrap;
          z-index: 12;
          background-color: var(--sys-color-info-dark);
          font-size: 12px;
          font-weight: 400;
          border: none;
          box-shadow: none;
          color: var(--sys-color-info-text);
      `,autoUpdate:!0,shiftOptions:y,flipOptions:x,placement:"right-start",reference:j},(0,e.jsx)("div",{className:"pl-2 pr-2 pt-1 pb-1"},u.formatMessage({id:"conditionalStylePreview",defaultMessage:l.defaultMessages.conditionalStylePreview}))))};R.versionManager=m;const w=R;function k(e){r.p=e}})(),s})())}}}));