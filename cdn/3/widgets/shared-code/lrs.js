System.register(["jimu-theme","jimu-core","jimu-arcgis","calcite-components","jimu-ui","widgets/shared-code/lrs","jimu-core/react","jimu-ui/advanced/map"],(function(e,t){var n={},r={},o={},i={},a={},s={},l={},u={};return{setters:[function(e){n.registerStyles=e.registerStyles,n.useTheme=e.useTheme,n.withStyles=e.withStyles,n.withTheme=e.withTheme},function(e){r.DataSourceManager=e.DataSourceManager,r.DataSourceTypes=e.DataSourceTypes,r.JimuFieldType=e.JimuFieldType,r.React=e.React,r.ReactRedux=e.ReactRedux,r.SessionManager=e.SessionManager,r.WidgetState=e.WidgetState,r.classNames=e.classNames,r.css=e.css,r.dataSourceUtils=e.dataSourceUtils,r.esri=e.esri,r.focusElementInKeyboardMode=e.focusElementInKeyboardMode,r.getAppStore=e.getAppStore,r.hooks=e.hooks,r.jsx=e.jsx,r.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,r.polished=e.polished,r.utils=e.utils},function(e){o.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){i.CalciteButton=e.CalciteButton,i.CalciteInputDatePicker=e.CalciteInputDatePicker,i.CalciteTable=e.CalciteTable,i.CalciteTableCell=e.CalciteTableCell,i.CalciteTableHeader=e.CalciteTableHeader,i.CalciteTableRow=e.CalciteTableRow},function(e){a.Alert=e.Alert,a.Button=e.Button,a.Checkbox=e.Checkbox,a.FloatingPanel=e.FloatingPanel,a.Icon=e.Icon,a.Label=e.Label,a.Popper=e.Popper,a.Select=e.Select,a.TextInput=e.TextInput,a.Tooltip=e.Tooltip,a.defaultMessages=e.defaultMessages},function(e){s.fetchEnterpriseContingentValues=e.fetchEnterpriseContingentValues,s.fetchEnterpriseFieldGroup=e.fetchEnterpriseFieldGroup,s.fieldsWithContingentValues=e.fieldsWithContingentValues,s.getContingentOptions=e.getContingentOptions,s.normalizeFieldName=e.normalizeFieldName,s.setContingentValues=e.setContingentValues,s.validateContingencyConstraints=e.validateContingencyConstraints},function(e){l.default=e.default},function(e){u.DrawingElevationMode3D=e.DrawingElevationMode3D}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=n},8547:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M7.5 0A3.5 3.5 0 0 1 11 3.5V6h1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h1V3.5A3.5 3.5 0 0 1 7.5 0M5 6h5V3.5a2.5 2.5 0 0 0-2.336-2.495L7.5 1a2.5 2.5 0 0 0-2.495 2.336L5 3.5zm6 1H3v8h9V7zm-3.5 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3" clip-rule="evenodd"></path></svg>'},14321:e=>{"use strict";e.exports=a},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},47626:e=>{"use strict";e.exports=s},48993:e=>{"use strict";e.exports=u},62686:e=>{"use strict";e.exports=o},68972:e=>{"use strict";e.exports=l},79244:e=>{"use strict";e.exports=r},99037:e=>{"use strict";e.exports=i}},t={};function c(n){var r=t[n];if(void 0!==r)return r.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,c),o.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var n in t)c.o(t,n)&&!c.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var d={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(d),c.d(d,{AttributeTable:()=>wo,ConvertUnits:()=>X,CopyAttributeTool:()=>ci,GetEsriUnits:()=>ne,GetSRUnits:()=>ee,GetUnits:()=>te,InlineEditableDropdown:()=>Ro,Intellisense:()=>Lo,IntellisenseTextInput:()=>Co,LockAcquireStatus:()=>Vo,LockAction:()=>qo,LockManagerComponent:()=>li,LockReleaseStatus:()=>_o,LocksEndpointType:()=>$o,LrsApplyEdits:()=>Ye,LrsLayerType:()=>_i,QueryLock:()=>Wo,QueryMapPointWithMeasureOnRoute:()=>Je,QueryMeasureOnRoute:()=>Ke,QueryPolylineOnRoute:()=>Xe,QueryRouteMeasures:()=>He,QueryRouteMeasuresAndDistances:()=>Qe,ReleasableStatus:()=>Uo,RoutePicker:()=>rt,RoutePickerPopup:()=>it,SearchMethod:()=>Ui,VMSEndpoints:()=>Go,acquireLock:()=>Ho,atOrBetween:()=>Ie,colorBlack:()=>Le,colorCyan:()=>je,convertStationToNumber:()=>fe,createFeatureLayer:()=>mi,createField:()=>Ii,createLabelLayer:()=>Pi,errorMessageDelay:()=>Ee,fetchEnterpriseContingentValues:()=>Ri,fetchEnterpriseFieldGroup:()=>wi,fieldsWithContingentValues:()=>ji,findFieldByName:()=>vi,findFieldByType:()=>hi,flash:()=>Ne,formatMessage:()=>Z,getAttributeSets:()=>Ji,getBaseURL:()=>oi,getCalciteBasicTheme:()=>De,getCalciteButtonWithIconTheme:()=>Te,getCalciteNoticeTheme:()=>xe,getContingentOptions:()=>Li,getDateToUTC:()=>de,getDateWithTZOffset:()=>Fe,getDateWithoutTZOffset:()=>Re,getEventInfoFromResults:()=>Ki,getExistingFieldNames:()=>bi,getFeatureLayer:()=>Ze,getGDBVersion:()=>ye,getGeometryGraphic:()=>Oe,getHoverGraphic:()=>Pe,getInitialEventInfoState:()=>pe,getInitialRouteInfoState:()=>me,getInitialRouteMeasurePickerInfoState:()=>he,getIntialLocksInfo:()=>Xo,getLayer:()=>pi,getLocalTimeOffset:()=>Se,getLocksEndpoint:()=>ni,getLrsRequestUrl:()=>Wi,getMapAllLayers:()=>zi,getNetworkFields:()=>gi,getNetworkInfoFromResults:()=>Qi,getNetworkOutFields:()=>ie,getPolylineMidPoint:()=>Ci,getRouteFromEndMeasures:()=>oe,getRouteMeasures:()=>qi,getSimpleLineGraphic:()=>Ue,getSimplePointGraphic:()=>_e,getSuggestions:()=>ce,getUUID:()=>pt,getUniqueUrls:()=>Hi,getUserSession:()=>ve,getVMSEndpoint:()=>ri,getVersionGuid:()=>Zo,highlightColor:()=>Me,isCodedDomain:()=>dt,isConflictPreventionEnabled:()=>ii,isDate:()=>ut,isDefaultVersion:()=>ge,isDefined:()=>re,isInWidgetController:()=>ke,isNumber:()=>ct,isParentNetworkAvailable:()=>Yi,isRangeDomain:()=>ft,isValidRoute:()=>le,isWithinTolerance:()=>be,messages:()=>Y,normalizeFieldName:()=>Ei,queryAllRoutesByLineId:()=>se,queryEventsByEventObjectIds:()=>Be,queryEventsByRouteIdOrEventObjectId:()=>qe,queryLineId:()=>We,queryRouteId:()=>et,queryRouteIdOrName:()=>ue,queryRouteIds:()=>tt,queryRoutes:()=>ze,queryRoutesByLineId:()=>ae,releaseLock:()=>Jo,removeLabelLayer:()=>Oi,requestService:()=>Ge,resolveFieldName:()=>yi,setContingentValues:()=>xi,setRouteInfoByRouteIdOrName:()=>Gi,shouldQueryRouteLock:()=>ei,shouldTryAcquireLock:()=>ti,tryAutoReconcile:()=>Yo,tryReleaseLock:()=>Ko,tryReleaseLockOnDefault:()=>Qo,validateContingencyConstraints:()=>Fi,validateField:()=>st,validateRangeDomain:()=>lt});var e={};c.r(e),c.d(e,{AttributeTable:()=>r});var t=c(1888),n=c(79244);const r=()=>n.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .calcite-attribute-table {
      width: 100%;
      flex: 1 1 auto;
      max-height: 87vh;
      overflow: auto;
      height: 100%
    }
    .table-container {
      overflow-x: hidden;
    }
    .calcite-table {
      width: 100%;
    }
    .cell-error {
      border-left: 6px solid red;
    }

  `;var o=c(62686);const i="object"==typeof global&&global&&global.Object===Object&&global;var a="object"==typeof self&&self&&self.Object===Object&&self;const s=i||a||Function("return this")();var l=/\s/;const u=function(e){for(var t=e.length;t--&&l.test(e.charAt(t)););return t};var f=/^\s+/;const m=function(e){return e?e.slice(0,u(e)+1).replace(f,""):e};const p=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const h=s.Symbol;var v=Object.prototype,y=v.hasOwnProperty,g=v.toString,b=h?h.toStringTag:void 0;const I=function(e){var t=y.call(e,b),n=e[b];try{e[b]=void 0;var r=!0}catch(e){}var o=g.call(e);return r&&(t?e[b]=n:delete e[b]),o};var N=Object.prototype.toString;const S=function(e){return N.call(e)};var w=h?h.toStringTag:void 0;const R=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":w&&w in Object(e)?I(e):S(e)};const F=function(e){return null!=e&&"object"==typeof e};const k=function(e){return"symbol"==typeof e||F(e)&&"[object Symbol]"==R(e)};var D=/^[-+]0x[0-9a-f]+$/i,T=/^0b[01]+$/i,x=/^0o[0-7]+$/i,E=parseInt;const M=function(e){if("number"==typeof e)return e;if(k(e))return NaN;if(p(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=p(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=m(e);var n=T.test(e);return n||x.test(e)?E(e.slice(2),n?2:8):D.test(e)?NaN:+e};var L=1/0;const j=function(e){return e?(e=M(e))===L||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const A=function(e){var t=j(e),n=t%1;return t==t?n?t-n:t:0};const O=function(e,t){for(var n=-1,r=null==e?0:e.length,o=Array(r);++n<r;)o[n]=t(e[n],n,e);return o};const P=Array.isArray;var C=h?h.prototype:void 0,V=C?C.toString:void 0;const _=function e(t){if("string"==typeof t)return t;if(P(t))return O(t,e)+"";if(k(t))return V?V.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n};const U=function(e){return null==e?"":_(e)};var $=s.isFinite,G=Math.min;const q=function(e){var t=Math[e];return function(e,n){if(e=M(e),(n=null==n?0:G(A(n),292))&&$(e)){var r=(U(e)+"e").split("e"),o=t(r[0]+"e"+(+r[1]+n));return+((r=(U(o)+"e").split("e"))[0]+"e"+(+r[1]-n))}return t(e)}}("round");var B=c(99037),z=c(14321),W=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};var H;function Q(e,t,r){return W(this,void 0,void 0,(function*(){const o={jimuName:e,type:n.JimuFieldType.String,esriType:H.String,name:e,alias:e,format:null};return function(e,t,r){return W(this,void 0,void 0,(function*(){const o={searchText:e,searchFields:r.map((e=>e.name)),dataSource:t,maxSuggestions:1e3};return n.dataSourceUtils.querySuggestions(o).then((e=>{const t={suggestionItem:null==e?void 0:e.map((e=>Object.assign(Object.assign({},e),{isFromSuggestion:!0}))),layer:null,icon:null};return Promise.resolve(t)})).catch((e=>Promise.resolve({suggestionItem:[],layer:null,icon:null})))}))}(t,r,[o])}))}!function(e){e.Blob="esriFieldTypeBlob",e.Date="esriFieldTypeDate",e.Double="esriFieldTypeDouble",e.Geometry="esriFieldTypeGeometry",e.GlobalID="esriFieldTypeGlobalID",e.GUID="esriFieldTypeGUID",e.Integer="esriFieldTypeInteger",e.OID="esriFieldTypeOID",e.Raster="esriFieldTypeRaster",e.Single="esriFieldTypeSingle",e.SmallInteger="esriFieldTypeSmallInteger",e.String="esriFieldTypeString",e.XML="esriFieldTypeXML"}(H||(H={}));const K={eventRequiredLabel:"Event *",networkRequiredLabel:"Network *",routeIdRequiredLabel:"Route ID *",routeNameRequiredLabel:"Route Name *",startDateRequiredLabel:"Start Date *",nullLabel:"null",fieldInfo:"Name: {name}\nAlias: {alias}\nType: {type}\nNullable: {nullable}\nDefault Value: {default}\nEditable: {editable}",fieldInfoWithError:"Name: {name}\nAlias: {alias}\nType: {type}\nNullable: {nullable}\nDefault Value: {default}\nEditable: {editable}\nError: {error}",fieldTypeWithLength:"{fieldType} ({length})",attributeError:"{fieldValue}: {message}",nonNullable:"Value cannot be null.",invalidShort:"Invalid value for short data type.",invalidInteger:"Invalid value for long data type.",invalidSingle:"Invalid value for float data type.",invalidDouble:"Invalid value for double data type.",invalidString:"Value exceeds maximum length of field",invalidDate:"Invalid date.",invalidRange:"Value exceeds min or max values of range.",contingentValueError:"Invalid contingent value in the field",selectRouteLabel:"Select Route",routePicker:"Route Picker",routeNameLabel:"Route Name",routeIdLabel:"Route ID",fromRouteNameLabel:"From Route Name",fromRouteIdLabel:"From Route ID",toRouteNameLabel:"To Route Name",toRouteIdLabel:"To Route ID",fromDateLabel:"From Date",toDateLabel:"To Date",measureLabel:"Measure",fromMeasureLabel:"From Measure",toMeasureLabel:"To Measure",noResult:"No Results",copyAttributes:"Copy Attributes",noLrsLayersTips:"No LRS layers are present in the selected map. Select a map with LRS Network and Event layers present in the webmap.",multipleServicesTips:"Map contains layers from more than one feature service. Select a map with LRS Network and Event layers coming from a single feature service.",noNetworkLayersTips:"No LRS Network layers are present in the selected map. Select a map with at least one LRS network layer present in the web map.",noMapSelectedTips:"Select a map.",displaySettings:"Display Settings",hideNetwork:"Hide Network",hideEvent:"Hide Event",hideMethod:"Hide Method",hideRoute:"Hide Route in Search by Line",hideType:"Hide Type",hideAttributeSet:"Hide Attribute Set",hideMeasures:"Hide Measures",hideDates:"Hide Dates",useRoutesStartEndDates:"Use Routes Start and End Dates",useRoutesStartEndDatesTooltip:"Routes start/end dates will be used for new events. If disabled, the current date will be used.",selectMap:"Select Map",loadLayers:"Load layers",clearLayers:"Clear layers",removeLayer:"Remove",missingParentNetwork:"Parent network is missing",inches:"Inches (US Survey)",feet:"Feet (US Survey)",yards:"Yards (US Survey)",miles:"Miles (US Survey)",nauticalMiles:"Nautical miles (US Survey)",points:"Points",millimeters:"Millimeters",centimeters:"Centimeters",meters:"Meters",kilometers:"Kilometers",decimalDegrees:"Decimal degrees",decimeters:"Decimeters",intFeet:"Feet (International)",intMiles:"Statute miles",esriUnknownUnits:"esriUnknownUnits",invalidRouteField:"Route could not be found with provided value",CannotAcquireLockUserAndVersion:"Cannot acquire lock because {user} has the lock in version {version}.",UnavailableLockOnLine:"Line {nameOrId} ({networkName}) is already locked by {lockUser} in version {version}.",UnavailableLockOnRoute:"Route {nameOrId} ({networkName}) is already locked by {lockUser} in version {version}.",UnavailableLockOnLineWithoutVersion:"Line {nameOrId} ({networkName}) is already locked by {lockUser} in a different service.",UnavailableLockOnRouteWithoutVersion:"Route {nameOrId} ({networkName}) is already locked by {lockUser} in a different service.",YouAcquiredLockOnLine:"You have acquired a lock on line {nameOrId} ({networkName}) in version {version}.",YouAcquiredLockOnRoute:"You have acquired a lock on route {nameOrId} ({networkName}) in version {version}.",ReconcileRequired:"The default version has changed. Reconcile this version with the default version in order to acquire locks."};var J=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};const Y=Object.assign({},K,z.defaultMessages);function Z(e,t,n){return e.formatMessage({id:t,defaultMessage:Y[t]},n)}const X=(e,t,n)=>{if(isNaN(e)||!t||!n||t===n)return e;const r={esriMeters:1,esriDecimalDegrees:899928005759e-17,esriNauticalMiles:.00053995680345572,esriIntNauticalMiles:.00053959318990227,esriMiles:.00062136994949496,esriIntMiles:.00062137119223733,esriKilometers:.001,esriYards:1.093611111115486,esriIntYards:1.093613298337708,esriFeet:3.280833333346457,esriIntFeet:3.280839895013123,esriDecimeters:10,esriInches:39.370078740157,esriIntInches:39.37007874015748,esriCentimeters:100,esriMillimeters:1e3,esriPoints:2834.645669291964};return t in r&&n in r?r[n]/r[t]*e:e};function ee(e){switch(e){case"esriFeet":case"esriIntFeet":return"esriSRUnit_Foot";case"esriMiles":case"esriIntMiles":return"esriSRUnit_StatuteMile";case"esriNauticalMiles":return"esriSRUnit_USNauticalMile";case"esriIntNauticalMiles":return"esriSRUnit_NauticalMile";case"esriMeters":return"esriSRUnit_Meter";case"esriKilometers":return"esriSRUnit_Kilometer";default:return""}}function te(e,t){switch(e){case"esriInches":return Z(t,"inches");case"esriPoints":return Z(t,"points");case"esriFeet":return Z(t,"feet");case"esriYards":return Z(t,"yards");case"esriMiles":return Z(t,"miles");case"esriNauticalMiles":return Z(t,"nauticalMiles");case"esriMillimeters":return Z(t,"millimeters");case"esriCentimeters":return Z(t,"centimeters");case"esriMeters":return Z(t,"meters");case"esriKilometers":return Z(t,"kilometers");case"esriDecimalDegrees":return Z(t,"decimalDegrees");case"esriDecimeters":return Z(t,"decimeters");case"esriIntFeet":return Z(t,"intFeet");case"esriIntMiles":return Z(t,"intMiles");default:return Z(t,"esriUnknownUnits")}}function ne(e,t){switch(e){case Z(t,"inches"):return"esriInches";case Z(t,"points"):return"esriPoints";case Z(t,"feet"):return"esriFeet";case Z(t,"yards"):return"esriYards";case Z(t,"miles"):return"esriMiles";case Z(t,"nauticalMiles"):return"esriNauticalMiles";case Z(t,"millimeters"):return"esriMillimeters";case Z(t,"centimeters"):return"esriCentimeters";case Z(t,"meters"):return"esriMeters";case Z(t,"kilometers"):return"esriKilometers";case Z(t,"decimalDegrees"):return"esriDecimalDegrees";case Z(t,"decimeters"):return"esriDecimeters";case Z(t,"intFeet"):return"esriIntFeet";case Z(t,"intMiles"):return"esriIntMiles";default:return"unknownUnits"}}function re(e){return null!=e}const oe=e=>{var t;if(re(e)){const n=e;if((null===(t=n.paths)||void 0===t?void 0:t.length)>0){const e=n.getPoint(0,0),t=n.paths[n.paths.length-1].length-1;return[e,n.getPoint(n.paths.length-1,t)]}}return[null,null]},ie=e=>{const t={routeIdFieldName:"",routeNameFieldName:"",fromDateFieldName:"",toDateFieldName:"",lineIdFieldName:"",lineNameFieldName:"",lineOrderFieldName:""};return re(e)&&(t.routeIdFieldName=e.routeIdFieldSchema.name,t.routeNameFieldName=e.useRouteName?e.routeNameFieldSchema.name:"",t.fromDateFieldName=e.fromDateFieldSchema.name,t.toDateFieldName=e.toDateFieldSchema.name,t.lineIdFieldName=re(e.lineIdFieldSchema)?e.lineIdFieldSchema.name:"",t.lineNameFieldName=re(e.lineNameFieldSchema)?e.lineNameFieldSchema.name:"",t.lineOrderFieldName=re(e.lineOrderFieldSchema)?e.lineOrderFieldSchema.name:""),t},ae=(e,t,n,r)=>{if(!(re(n)&&re(r)&&e.length&&t.length))return Promise.reject(new Error(null));const o=r.layer,i=o.createQuery();let a;a=(n.useRouteName,e.map((e=>`${n.routeNameFieldSchema.name} = '${e}'`)));const s=a.join(" OR "),l=`${n.lineIdFieldSchema.name} = '${t}' AND (${s})`,u=ie(n);return i.returnM=!0,i.outFields=[u.routeIdFieldName,u.fromDateFieldName,u.toDateFieldName],n.useRouteName&&i.outFields.push(u.routeNameFieldName),i.where=l,o.queryFeatures(i).then((e=>e)).catch((e=>Promise.reject(new Error(null))))},se=(e,t,n)=>{if(!re(t)||!re(n))return Promise.reject(new Error(null));const r=n.layer,o=r.createQuery(),i=`${t.lineIdFieldSchema.name} = '${e}'`,a=ie(t);return o.returnM=!0,o.outFields=[a.routeIdFieldName,a.fromDateFieldName,a.toDateFieldName,a.lineOrderFieldName],t.useRouteName&&o.outFields.push(a.routeNameFieldName),o.where=i,r.queryFeatures(o).then((e=>e)).catch((e=>Promise.reject(new Error(null))))},le=(e,t,n,...r)=>J(void 0,[e,t,n,...r],void 0,(function*(e,t,n,r=!1,o=!0,i="",a=null,s=!1){const l=n,u=(null==l?void 0:l.layer)||(yield l.createJSAPILayerByDataSource());let c;if(c=!t.useRouteName||s?`${t.routeIdFieldSchema.name} = '${e}'`:`${t.routeNameFieldSchema.name} = '${e}'`,re(a)){const e=`TIMESTAMP '${a.toISOString().slice(0,10)}'`;c=`${c} AND ${t.fromDateFieldSchema.name} <= ${e} AND (${t.toDateFieldSchema.name} >= ${e} OR ${t.toDateFieldSchema.name} IS NULL)`}const d=c,f=u.createQuery();f.where=d;const m=ie(t);return f.returnGeometry=!0,f.returnM=!0,f.outFields=[m.routeIdFieldName,m.fromDateFieldName,m.toDateFieldName],t.useRouteName&&f.outFields.push(m.routeNameFieldName),t.supportsLines&&(f.outFields.push(m.lineIdFieldName),f.outFields.push(m.lineNameFieldName),f.outFields.push(m.lineOrderFieldName)),u.queryFeatures(f).then((e=>e)).catch((e=>Promise.reject(new Error(null))))})),ue=(e,t,n,...r)=>J(void 0,[e,t,n,...r],void 0,(function*(e,t,n,r=!1,o=!0,i="",a=null,s=!1){if(!re(t)||!re(n)||!e.length)return Promise.reject(new Error(null));const l=n,u=(null==l?void 0:l.layer)||(yield l.createJSAPILayerByDataSource());let c;if(c=!t.useRouteName||s?`${t.routeIdFieldSchema.name} = '${e}'`:`${t.routeNameFieldSchema.name} = '${e}'`,re(a)){const e=`TIMESTAMP '${a.toISOString().slice(0,10)}'`;c=`${c} AND ${t.fromDateFieldSchema.name} <= ${e} AND (${t.toDateFieldSchema.name} >= ${e} OR ${t.toDateFieldSchema.name} IS NULL)`}const d=yield le(e,t,n,r,o,i,a,s);if(!d||0===d.features.length)return Promise.reject(new Error("invalidRoute"));let f=c;r&&!o&&re(i)&&(f=`${t.lineIdFieldSchema.name} = '${i}' AND (${c})`);const m=u.createQuery();m.where=f;const p=ie(t);return m.returnGeometry=!0,m.returnM=!0,m.outFields=[p.routeIdFieldName,p.fromDateFieldName,p.toDateFieldName],t.useRouteName&&m.outFields.push(p.routeNameFieldName),t.supportsLines&&(m.outFields.push(p.lineIdFieldName),m.outFields.push(p.lineNameFieldName),m.outFields.push(p.lineOrderFieldName)),u.queryFeatures(m).then((t=>0===t.features.length&&e.length>0?Promise.reject(new Error("routeNotOnSameLine")):t)).catch((e=>Promise.reject(new Error(e))))})),ce=(e,t,n)=>{const r=[],o=Q(e,t,n);return r.push(o),Promise.all(r)},de=e=>{const t=new Date(e);return re(t)?Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),0,0,0,0):null};function fe(e){if(null!=e&&/^-?\d+\+\d{2}(\.\d+)?$/g.test(e)){const t="-"===e.charAt(0),n=e.split("+");let r=100*parseInt(n[0],10);return isNaN(r)?r=NaN:2===n.length&&(t?r-=parseFloat(n[1]):r+=parseFloat(n[1])),r}if(null!=e&&/^-?\d+\+\d{3}(\.\d+)?$/g.test(e)){const t="-"===e.charAt(0),n=e.split("+");let r=1e3*parseInt(n[0],10);return isNaN(r)?r=NaN:2===n.length&&(t?r-=parseFloat(n[1]):r+=parseFloat(n[1])),r}return NaN}function me(){return{routeId:"",toRouteId:"",lineId:"",toLineId:"",lineName:"",toLineName:"",routeLineOrder:NaN,toRouteLineOrder:NaN,routeName:"",toRouteName:"",fromMeasure:NaN,toMeasure:NaN,toRouteFromMeasure:NaN,toRouteToMeasure:NaN,fromDate:new Date(Date.now()),toRouteFromDate:new Date(Date.now()),toDate:null,toRouteToDate:null,selectedMeasure:NaN,selectedToMeasure:NaN,selectedFromDate:new Date(Date.now()),selectedToDate:null,selectedPoint:null,selectedToPoint:null,selectedPolyline:null,selectedToPolyline:null,validRoute:!1,validToRoute:!1}}function pe(){return{eventUrl:"",fromDateFieldName:"",toDateFieldName:"",derivedFromMeasureFieldName:"",derivedRouteIdFieldName:"",derivedRouteNameFieldName:"",derivedToMeasureFieldName:"",fromReferentLocationFieldName:"",fromReferentMethodFieldName:"",fromReferentOffsetFieldName:"",toReferentLocationFieldName:"",toReferentMethodFieldName:"",toReferentOffsetFieldName:"",locErrorFieldName:"",eventIdFieldName:"",routeIdFieldName:"",routeNameFieldName:"",fromMeasureFieldName:"",toRouteIdFieldName:"",toRouteNameFieldName:"",toMeasureFieldName:"",lrsFields:null,attributeFields:null,parentNetworkId:NaN,useRouteName:!1,isPointEvent:!1,canSpanRoutes:!1,mergeCoincident:!1,retireOverlapping:!1,datasetName:""}}function he(){return{fromRoutePickerActive:!1,fromMeasurePickerActive:!1,toRoutePickerActive:!1,toMeasurePickerActive:!1}}function ve(e){return n.SessionManager.getInstance().getSessionByUrl(e)}function ye(e){return e.getGDBVersion()||"sde.DEFAULT"}function ge(e){return"sde.default"===e.toLocaleLowerCase()||""===e}function be(e,t,n){return!isNaN(e)&&!isNaN(t)&&!isNaN(n)&&Math.abs(e-t)<=n}function Ie(e,t,n){return function(e,t,n){return function(e,t,n,r){return n=Math.abs(n),r?e>t+n:e>=t-n}(e,t,n,!1)}(t,e[0],n)&&function(e,t,n){return function(e,t,n,r){return n=Math.abs(n),r?e<t-n:e<=t+n}(e,t,n,!1)}(t,e[1],n)}const Ne=(e,t)=>{re(t)&&(e.add(t),setTimeout((()=>{e.removeAll(),setTimeout((()=>{e.add(t),setTimeout((()=>{e.removeAll(),setTimeout((()=>{e.add(t),setTimeout((()=>{e.removeAll()}),800)}),800)}),800)}),800)}),800))};function Se(e){const t=(new Date).getTimezoneOffset();return(t<0?1:-1)*(t<0?Math.abs(t)/60:t/60)*60*60*1e3+function(e){const t=we(new Date(Date.now())),n=we(e);return t&&!n?-36e5:!t&&n?36e5:0}(e)}function we(e){const t=new Date(e.getFullYear(),0,1),n=new Date(e.getFullYear(),6,1),r=Math.max(t.getTimezoneOffset(),n.getTimezoneOffset());return e.getTimezoneOffset()<r}function Re(e,t){if(!re(e)||!re(new Date(e)))return null;const r=t.getTimezone();if(r.includes("/")||"device"===r)return new Date(n.dataSourceUtils.getDateFieldValueWithoutTzOffset(e,t));{const t=Se(new Date(e));return new Date(e+t)}}function Fe(e,t){if(!re(e)||!re(new Date(e)))return null;const r=t.getTimezone();if(r.includes("/")||"device"===r)return new Date(n.dataSourceUtils.getDateFieldValue(e,t));{const t=Se(new Date(e));return new Date(e-t)}}function ke(e){let t=document.getElementById(e);for(;t&&!t.classList.contains("floating-panel");)if(t=t.parentElement,t&&t.classList.contains("floating-panel"))return!0;for(t=document.getElementById(e);t&&!t.classList.contains("panel-content");)if(t=t.parentElement,t&&t.classList.contains("panel-content"))return!0;return!1}function De(){return n.css`
    --calcite-color-brand: var(--sys-color-primary-main);
    --calcite-color-brand-press: var(--sys-color-primary-dark);
    --calcite-color-brand-hover: var(--sys-color-primary-light);
    --calcite-color-text-inverse: var(--sys-color-primary-text)};
  `}function Te(){return n.css`
    --calcite-ui-icon-color: var(--ref-palette-neutral-1200);
    --calcite-color-brand: var(--sys-color-primary-main);
    --calcite-color-brand-press: var(--sys-color-primary-dark);
    --calcite-color-brand-hover: var(--sys-color-primary-light);
    --calcite-color-text-inverse: var(--sys-color-primary-text)};
  `}function xe(e){return n.css`
      --calcite-color-foreground-1: ${e.sys.color.surface.paper};
      --calcite-color-brand: ${e.sys.color.primary.main};
      --calcite-color-status-warning: ${e.sys.color.error.main};
      --calcite-color-text-3: ${e.sys.color.primary.text};
      --calcite-color-transparent-hover: ${e.sys.color.primary.light};
      --calcite-color-transparent-pressed: ${e.sys.color.primary.dark};
      --calcite-color-status-success: ${e.sys.color.success.main};
    `}const Ee=1e4,Me="#00FFFF",Le="#000000",je="#00FFFF";var Ae=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};const Oe=(e,t,n,r)=>Ae(void 0,void 0,void 0,(function*(){var o;switch(t||(t=Me),null===(o=null==e?void 0:e.geometry)||void 0===o?void 0:o.type){case"point":return yield Ce(e,t,n).then((e=>e));case"polyline":return yield Ve(e,t,n,r).then((e=>e));default:return null}})),Pe=e=>(0,o.loadArcGISJSAPIModules)(["esri/Graphic"]).then((t=>{let n=null;[n]=t;const r={type:"simple-marker",style:"circle",size:6,color:Le};return new n({geometry:e.geometry,symbol:r,attributes:e.attributes})})),Ce=(e,t,n=3)=>(0,o.loadArcGISJSAPIModules)(["esri/Graphic"]).then((r=>{let o=null;[o]=r;const i={type:"simple-marker",style:"circle",width:n,color:t||Me,outline:{color:Le,width:1}};return new o({geometry:e.geometry,symbol:i,attributes:e.attributes})})),Ve=(e,t,n=9,r=!1)=>(0,o.loadArcGISJSAPIModules)(["esri/Graphic"]).then((o=>{let i=null;[i]=o;let a={};a=r?{type:"simple-line",color:t||Me,width:n,style:"solid",marker:{color:t||Me,style:"arrow",placement:"end"},outline:{color:Le,width:1}}:{type:"simple-line",color:t||Me,width:n,style:"solid",outline:{color:Le,width:1}};return new i({geometry:e.geometry,symbol:a,attributes:e.attributes})})),_e=e=>(0,o.loadArcGISJSAPIModules)(["esri/Graphic"]).then((t=>{let n=null;[n]=t;return new n({geometry:e,symbol:null,attributes:[]})})),Ue=e=>(0,o.loadArcGISJSAPIModules)(["esri/Graphic"]).then((t=>{let n=null;[n]=t;return new n({geometry:e,symbol:null,attributes:[]})}));var $e=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function Ge(e){return $e(this,void 0,void 0,(function*(){return new Promise((function(t,r){const o={params:e.params,httpMethod:e.method};n.esri.restRequest.request(e.url,o).then((e=>{t(e)})).catch((e=>{t(e)}))}))}))}function qe(e,t,r,o,i,a){return $e(this,void 0,void 0,(function*(){var s,l,u,c,d,f;const m=o.routeId,p=[];if(!re(o.selectedPoint)&&!re(a))return p;const h=null!==(l=null===(s=t.getTimeInfo())||void 0===s?void 0:s.timeExtent)&&void 0!==l?l:0,v=r.eventInfo.eventUrl.replace("/exts/LRServer/eventLayers",""),y=`${v}/query`,g=yield n.SessionManager.getInstance().getSessionByUrl(v).getToken(v);let b,I,N,S,w=t.getGDBVersion();if(w||(w=""),re(o.selectedPoint)){N=o.selectedPoint.toJSON?o.selectedPoint.toJSON():o.selectedPoint,S=o.distance>e?o.distance:"";let t="";if(r.eventInfo.canSpanRoutes)i.length>0&&(t=`${null===(u=r.eventInfo)||void 0===u?void 0:u.routeIdFieldName} IN ('${i.join("','")}')`);else{if(!(m&&m.length>0))return p;t=`${null===(c=r.eventInfo)||void 0===c?void 0:c.routeIdFieldName} = '${m}'`}if(re(o.fromDate)){if(o.fromDate){const e=`TIMESTAMP '${o.fromDate.toISOString().slice(0,10)}'`;t.length>0&&(t+=" AND "),t+=`${e} <= ${r.eventInfo.fromDateFieldName}`}if(o.toDate){const e=`TIMESTAMP '${o.toDate.toISOString().slice(0,10)}'`;t.length>0&&(t+=" AND "),t+=`${e} > ${r.eventInfo.fromDateFieldName}`}}I=t}else b=[a];let R=null===(f=null===(d=t.layerDefinition)||void 0===d?void 0:d.geometryProperties)||void 0===f?void 0:f.units;R&&(R=ee(R));const F={f:"json",token:g,returnGeometry:!1,time:h,gdbVersion:w,outSR:102100,objectIds:b,where:I,outFields:"*",spatialRel:"esriSpatialRelIntersects",geometryType:"esriGeometryPoint",geometry:N,distance:S,units:R};return Ge({method:"GET",url:y,params:F}).then((e=>$e(this,void 0,void 0,(function*(){var t;return(null===(t=e.features)||void 0===t?void 0:t.length)>0?e.features:(F.distance=.2,F.units="esriSRUnit_Meter",Ge({method:"GET",url:y,params:F}).then((e=>{var t;return(null===(t=e.features)||void 0===t?void 0:t.length)>0?e.features:p})).catch((e=>p)))})))).catch((e=>p))}))}function Be(e,t){return $e(this,void 0,void 0,(function*(){const n=[],r=null==e?void 0:e.layer,o=r.createQuery();return t.length>0?(o.objectIds=t,r.queryFeatures(o).then((e=>e&&e.features.length>0?e.features:n)).catch((e=>n))):n}))}function ze(e,t,n){return $e(this,void 0,void 0,(function*(){var r,o;const i=[];let a="";n.routeId.length>0?a=`${t.routeIdFieldSchema.jimuName} = '${n.routeId}'`:n.routeName.length>0&&(a=`${t.routeNameFieldSchema.jimuName} = '${n.routeName}'`);const s={returnGeometry:!0,returnM:!0,returnZ:!0,where:a,orderByFields:[],time:null!==(o=null===(r=e.getTimeInfo())||void 0===r?void 0:r.timeExtent)&&void 0!==o?o:0};return e.query(s).then((e=>{var t;return(null===(t=e.records)||void 0===t?void 0:t.length)>0?e.records:i})).catch((e=>i))}))}function We(e,t,n){return $e(this,void 0,void 0,(function*(){var r,o;const i=[];let a="";if(!(n.length>0))return i;a=`${t.lineIdFieldSchema.jimuName} = '${n}'`;const s={where:a,time:null!==(o=null===(r=e.getTimeInfo())||void 0===r?void 0:r.timeExtent)&&void 0!==o?o:0,outFields:[t.routeIdFieldSchema.name],notAddFieldsToClient:!0};return e.query(s).then((e=>{var t;return(null===(t=e.records)||void 0===t?void 0:t.length)>0?e.records:i})).catch((e=>i))}))}function He(e,t,r,o,i){return $e(this,void 0,void 0,(function*(){const a=[];if(!re(r)&&r.length)return a;const s=t.networkUrl,l=`${s}/geometryToMeasure`,u=yield n.SessionManager.getInstance().getSessionByUrl(s).getToken(s),c=[];r.forEach((e=>{c.push({routeId:i,geometry:{x:e.x,y:e.y}})}));let d=e.getGDBVersion();d||(d="");return Ge({method:"GET",url:l,params:{f:"json",token:u,locations:c,tolerance:10,temporalViewDate:re(o)&&0!==o.valueOf()?o:"",inSR:r[0].spatialReference.wkid,gdbVersion:d}}).then((e=>e&&e.locations?(e.locations.forEach((e=>{var t;(null===(t=e.results)||void 0===t?void 0:t.length)>0&&e.results.forEach((e=>{a.push(e.measure)}))})),a):a))}))}function Qe(e,t,r,o,i){return $e(this,void 0,void 0,(function*(){const a=[];if(!re(r)&&r.length)return a;const s=t.networkUrl,l=`${s}/geometryToMeasure`,u=yield n.SessionManager.getInstance().getSessionByUrl(s).getToken(s),c=[];r.forEach((e=>{c.push({routeId:i,geometry:{x:e.x,y:e.y}})}));let d=e.getGDBVersion();d||(d="");return Ge({method:"GET",url:l,params:{f:"json",token:u,locations:c,tolerance:10,temporalViewDate:re(o)&&0!==o.valueOf()?o:"",inSR:r[0].spatialReference.wkid,gdbVersion:d}}).then((e=>e&&e.locations?(e.locations.forEach((e=>{var t;(null===(t=e.results)||void 0===t?void 0:t.length)>0&&e.results.forEach((e=>{a.push({measure:e.measure,distance:e.distance})}))})),a):a))}))}function Ke(e,t,r,o,i){return $e(this,void 0,void 0,(function*(){if(!r.length)return null;const a=t.networkUrl,s=`${a}/measureToGeometry`,l=yield n.SessionManager.getInstance().getSessionByUrl(a).getToken(a),u=[];u.push({routeId:r,measure:i});let c=e.getGDBVersion();c||(c="");return Ge({method:"GET",url:s,params:{f:"json",token:l,locations:u,temporalViewDate:re(o)&&0!==o.valueOf()?o:"",gdbVersion:c}}).then((e=>$e(this,void 0,void 0,(function*(){if(!e||!e.locations)return null;let t=null,r=null;return(0,n.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then((e=>{[t,r]=e})).then((()=>{let n=null;return e.locations.forEach((o=>{if("esriGeometryPoint"===o.geometryType&&null!=o.geometry){const i=new r({wkid:e.spatialReference.wkid,wkt:e.spatialReference.wkt});n=new t(o.geometry),n.spatialReference=i}})),n}))}))))}))}function Je(e,t,r,o,i){return $e(this,void 0,void 0,(function*(){if(!r.length)return null;const a=t.networkUrl,s=`${a}/measureToGeometry`,l=yield n.SessionManager.getInstance().getSessionByUrl(a).getToken(a),u=[];u.push({routeId:r,measure:i});let c=e.getGDBVersion();c||(c="");return Ge({method:"GET",url:s,params:{f:"json",token:l,locations:u,temporalViewDate:re(o)&&0!==o.valueOf()?o:"",gdbVersion:c,outSR:102100}}).then((e=>$e(this,void 0,void 0,(function*(){if(!e||!e.locations)return null;let t=null,r=null;return(0,n.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then((e=>{[t,r]=e})).then((()=>{let n=null;return e.locations.forEach((o=>{if("esriGeometryPoint"===o.geometryType&&null!=o.geometry){const i=new r({wkid:e.spatialReference.wkid,wkt:e.spatialReference.wkt});n=new t(o.geometry),n.spatialReference=i}})),n}))}))))}))}function Ye(e,t,r){return $e(this,void 0,void 0,(function*(){const o=`${e}/applyEdits`,i=yield n.SessionManager.getInstance().getSessionByUrl(e).getToken(e),a=[];t.edits.forEach((e=>{a.push(e)}));return Ge({method:"POST",url:o,params:{f:"json",token:i,gdbVersion:r,edits:a}}).then((e=>{const t={success:!1,editResults:[],code:0,message:"",details:""};return e.hasOwnProperty("success")?(t.success=!0,t.editResults=e.editResults):(t.success=!1,t.code=e.code,t.message=e.message,t.details=e.response.error.details[0]),t}))}))}function Ze(e){return $e(this,void 0,void 0,(function*(){return yield(0,n.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer"]).then((t=>{const[n]=t;let r;if(e.url.includes("MapServer")){let t="";t=e.url.substring(0,e.url.indexOf("MapServer")),t+="FeatureServer/"+e.layerId,r=new n({url:t})}else e.layer?r=e.layer:e.itemId&&(r=new n({portalItem:{id:e.itemId,portal:{url:e.portalUrl}}}));return r.load().then((()=>$e(this,void 0,void 0,(function*(){return yield Promise.resolve(r)}))))})).catch((e=>(console.warn(e),null)))}))}function Xe(e,t,r,o,i,a,s){return $e(this,void 0,void 0,(function*(){if(!r.length||!o.length)return null;const l=t.networkUrl,u=`${l}/measureToGeometry`,c=yield n.SessionManager.getInstance().getSessionByUrl(l).getToken(l),d=[];d.push({routeId:r,toRouteId:o,fromMeasure:a,toMeasure:s});let f=e.getGDBVersion();f||(f="");return Ge({method:"GET",url:u,params:{f:"json",token:c,locations:d,temporalViewDate:re(i)&&0!==i.valueOf()?i:"",gdbVersion:f}}).then((e=>$e(this,void 0,void 0,(function*(){if(!e||!e.locations)return null;let t=null,r=null;return(0,n.loadArcGISJSAPIModules)(["esri/geometry/Polyline","esri/geometry/SpatialReference"]).then((e=>{[t,r]=e})).then((()=>{let n=null;return e.locations.forEach((o=>{if("esriGeometryPolyline"===o.geometryType){const i=new r({wkid:e.spatialReference.wkid,wkt:e.spatialReference.wkt});n=new t(o.geometry),n.spatialReference=i}})),n}))}))))}))}const et=(e,t,n)=>{if(!re(t)||!re(n)||!e.length)return Promise.reject(new Error(null));const r=ie(t),o=n.layer,i=o.createQuery();return i.where=`${r.routeIdFieldName} = '${e}'`,i.orderByFields=[t.fromDateFieldSchema.name],i.returnM=!0,i.outFields=[r.routeIdFieldName,r.fromDateFieldName,r.toDateFieldName],t.useRouteName&&i.outFields.push(r.routeNameFieldName),t.supportsLines&&(i.outFields.push(r.lineIdFieldName),i.outFields.push(r.lineNameFieldName),i.outFields.push(r.lineOrderFieldName)),o.queryFeatures(i).then((t=>0===t.features.length&&e.length>0?Promise.reject(new Error(null)):t)).catch((e=>Promise.reject(new Error(null))))},tt=(e,t,n)=>{if(!re(t)||!re(n)||!e.length||0===e.length)return Promise.reject(new Error(null));const r=ie(t),o=n.layer,i=o.createQuery();return i.where=`${r.routeIdFieldName} IN ('${e.join("','")}')`,i.outFields=[r.routeIdFieldName,r.lineIdFieldName,r.lineOrderFieldName],o.queryFeatures(i).then((t=>0===t.features.length&&e.length>0?Promise.reject(new Error(null)):t)).catch((e=>Promise.reject(new Error(null))))};var nt=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function rt(e){const{type:t,active:r,networkDs:i,network:a,routeInfo:s,disabled:l,jimuMapView:u,hoverGraphic:c,isFrom:d=!1,canSpanRoutes:f=!1,useRouteStartMeasure:m=!1,useRouteEndMeasure:p=!1,onActiveChange:h,onRouteInfoUpdated:v,onMultiRouteSelect:y}=e,g=n.React.useRef(null),b=n.React.useRef(null),[I,N]=n.React.useState(null),S=n.React.useRef(!1),w=n.React.useRef(!1);n.React.useEffect((()=>{if(re(i)&&re(u)){const e=i;re(null==e?void 0:e.layer)&&N(null==e?void 0:e.layer)}}),[u,i]),n.React.useEffect((()=>{r?R():F()}),[r]);const R=()=>{g.current=null==u?void 0:u.view.on("pointer-move",x),b.current=null==u?void 0:u.view.on("pointer-down",E)},F=()=>{re(g.current)&&(g.current.remove(),g.current=null),re(b.current)&&(b.current.remove(),b.current=null),w.current&&(w.current=!1),S.current&&(S.current=!1)},k=()=>{re(c)&&c.removeAll()},D=e=>{k(),re(e)&&c.add(e)},T=e=>{const t=I.spatialReference,n=I.createQuery(),r="degrees"===t.unit?4:Math.max(3*t.metersPerUnit,3);return n.geometry=e,n.units="meters",n.returnGeometry=!0,n.returnM=!0,n.returnZ=!0,n.distance=(null==u?void 0:u.view.resolution)*r,n.spatialRelationship="intersects",n},x=e=>{re(I)&&!S.current&&(0,o.loadArcGISJSAPIModules)(["esri/geometry/operators/proximityOperator","esri/TimeExtent"]).then((n=>{let r=null,o=null;[r,o]=n,S.current=!0;const l=i.getCurrentQueryParams(),c=null==u?void 0:u.view.toMap(e),m=T(c),p=a.lineIdFieldSchema?a.lineIdFieldSchema.name:"",h=f?s.lineId:"";if(m.outFields=f?[p]:[],(null==l?void 0:l.time)&&(m.timeExtent=new o({start:l.time[0],end:l.time[1]})),m.gdbVersion=l.gdbVersion,"route-measure"===t)I.queryFeatures(m).then((e=>{e.features.forEach((e=>nt(this,void 0,void 0,(function*(){const t=e.geometry;if(!f||f&&d){const e=r.getNearestCoordinate(t,c),n=r.getNearestVertex(t,c);return n.distance<3*m.distance&&(e.coordinate=n.coordinate),D(yield Pe(yield _e(e.coordinate))),S.current=!1,!0}if(f&&!d){if(e.attributes[p]===h){const e=r.getNearestCoordinate(t,c),n=r.getNearestVertex(t,c);return n.distance<3*m.distance&&(e.coordinate=n.coordinate),D(yield Pe(yield _e(e.coordinate))),S.current=!1,!0}}})))),S.current&&(D(null),S.current=!1)}));else{const e=a.routeIdFieldSchema?a.routeIdFieldSchema.name:"",t=a.fromDateFieldSchema?a.fromDateFieldSchema.name:"",n=a.lineIdFieldSchema?a.lineIdFieldSchema.name:"";m.outFields=f?[e,n,t]:[e,t];const o=d?s.routeId:s.toRouteId;I.queryFeatures(m).then((n=>{n.features.forEach((a=>nt(this,void 0,void 0,(function*(){const l=a.attributes[e],u=Fe(a.attributes[t],i).toLocaleDateString(),f=d?s.fromDate.toLocaleDateString():s.toRouteFromDate.toLocaleDateString();if(l===o&&u===f){const e=n.features[0].geometry,t=r.getNearestCoordinate(e,c),o=r.getNearestVertex(e,c);o.distance<3*m.distance&&(t.coordinate=o.coordinate),D(yield Pe(yield _e(t.coordinate))),S.current=!1}})))),S.current&&(D(null),S.current=!1)}))}}))},E=e=>nt(this,void 0,void 0,(function*(){return new Promise((n=>{try{re(I)&&!w.current&&(e.stopPropagation(),(0,o.loadArcGISJSAPIModules)(["esri/geometry/operators/proximityOperator","esri/TimeExtent"]).then((n=>nt(this,void 0,void 0,(function*(){let r=null,o=null;[r,o]=n;const l=I.popupEnabled;I.popupEnabled=!1,w.current=!0;const c=null==u?void 0:u.view.toMap(e),g=T(c),b=a.routeNameFieldSchema?a.routeNameFieldSchema.name:"",N=a.routeIdFieldSchema?a.routeIdFieldSchema.name:"",S=a.fromDateFieldSchema.name,R=a.toDateFieldSchema.name,D=a.lineIdFieldSchema?a.lineIdFieldSchema.name:"",x=a.lineNameFieldSchema?a.lineNameFieldSchema.name:"",E=a.lineOrderFieldSchema?a.lineOrderFieldSchema.name:"";g.outFields=[N,S,R],(f||""!==D)&&(g.outFields.push(D),g.outFields.push(x),g.outFields.push(E)),a.useRouteName&&g.outFields.push(b);const M=i.getCurrentQueryParams();(null==M?void 0:M.time)&&(g.timeExtent=new o({start:M.time[0],end:M.time[1]})),g.gdbVersion=M.gdbVersion,!d&&f&&("esriFieldTypeGUID"===a.lineIdFieldSchema.esriType?g.where=`${D} = '${s.lineId}'`:g.where=`${D} LIKE '%${s.lineId}'`);const L=[];yield I.queryFeatures(g).then((e=>nt(this,void 0,void 0,(function*(){"route-measure"===t?yield Promise.all(e.features.map((e=>nt(this,void 0,void 0,(function*(){const t=e.attributes[N],n=a.useRouteName?e.attributes[b]:"",o=(null==e?void 0:e.attributes[D])||"",l=(null==e?void 0:e.attributes[x])||"",u=(null==e?void 0:e.attributes[E])||"",h=e.attributes[S],v=e.attributes[R],y=oe(e.geometry),I=e.geometry,w=r.getNearestCoordinate(I,c),F=r.getNearestVertex(I,c);F.distance<3*g.distance&&(w.coordinate=F.coordinate),yield He(i,a,y,h,t).then((c=>nt(this,void 0,void 0,(function*(){const g=Math.min(...c),b=Math.max(...c);yield Qe(i,a,[w.coordinate],h,t).then((c=>{c.forEach((c=>{const N=c.measure;let S=new Date(Date.now());const R=h?Fe(h,i):null,F=v?Fe(v,i):null;re(F)&&S>F||re(h)&&S<R?S=R:S.setHours(0,0,0,0);let k=new Date(Date.now());re(F)&&k>F?k=F:k.setHours(0,0,0,0),(!re(v)||F>k)&&(k=null);let D=!1;!d||f||s.routeId===t&&s.routeName===n&&s.toRouteId===t&&s.toRouteName===n?d&&f&&!s.validToRoute&&(D=!0):D=!0,d&&o&&s.lineId!==o&&(D=!0);let T=!1;(d&&f&&!s.validToRoute||d&&o&&s.toLineId!==o||d&&!f&&s.routeId===s.toRouteId)&&(T=!0);let x=re(h)?Fe(h,i):null,E=re(v)?Fe(v,i):null;d&&f&&""!==s.toRouteId&&t!==s.toRouteId&&(x=s.toRouteFromDate,E=s.toRouteToDate);w.coordinate.hasZ=!0;const M={routeId:d?t:s.routeId,toRouteId:d?T?t:s.toRouteId:t,routeName:d?n:s.routeName,toRouteName:d?T?n:s.toRouteName:n,routeLineOrder:d?u:s.routeLineOrder,toRouteLineOrder:d?s.toRouteLineOrder:u,lineId:o,toLineId:o,lineName:l,toLineName:l,fromMeasure:d?q(g,a.measurePrecision):s.fromMeasure,toMeasure:d?q(b,a.measurePrecision):s.toMeasure,toRouteFromMeasure:d?T?q(g,a.measurePrecision):s.toRouteFromMeasure:q(g,a.measurePrecision),toRouteToMeasure:d?T?q(b,a.measurePrecision):s.toRouteToMeasure:q(b,a.measurePrecision),selectedMeasure:d?q(N,a.measurePrecision):s.selectedMeasure,distance:c.distance,selectedToMeasure:d?D?NaN:s.selectedToMeasure:q(N,a.measurePrecision),fromDate:d?re(h)?Fe(h,i):null:s.fromDate,toDate:d?re(v)?Fe(v,i):null:s.toDate,toRouteFromDate:x,toRouteToDate:E,selectedPoint:d?w.coordinate:s.selectedPoint,isNearestCoordinate:d,selectedToPoint:d?D?null:s.selectedToPoint:w.coordinate,selectedPolyline:e.geometry,selectedToPolyline:d?s.selectedToPolyline:e.geometry,selectedFromDate:d?S:s.selectedFromDate,selectedToDate:d?k:s.selectedToDate,validRoute:!!d||s.validRoute,validToRoute:!d||s.validToRoute};if(d){if(m){M.selectedMeasure=M.fromMeasure;const e=r.getNearestCoordinate(I,y[0]);M.selectedPoint=e.coordinate}if(p&&(!f||M.routeId===M.toRouteId)){const e=r.getNearestCoordinate(I,y[1]);M.selectedToMeasure=M.toRouteToMeasure,M.selectedToPoint=e.coordinate,M.selectedToPolyline=M.selectedPolyline}}else if(p&&f){const e=r.getNearestCoordinate(I,y[1]);M.selectedToMeasure=M.toRouteToMeasure,M.selectedToPoint=e.coordinate}if(d)L.push(M);else{L.find((e=>e.routeId===M.routeId&&e.fromDate===M.fromDate))||L.push(M)}}))}))}))))}))))):yield Promise.all(e.features.map((e=>nt(this,void 0,void 0,(function*(){const t=e.attributes[N],n=e.attributes[S]?Fe(e.attributes[S],i):null,o=d?s.routeId:s.toRouteId,l=d?s.fromDate:s.toRouteFromDate;if(t===o&&n.toLocaleDateString()===l.toLocaleDateString()){const t=e.attributes[N],n=a.useRouteName?e.attributes[b]:"",o=e.attributes[S],l=e.attributes[R],u=f?e.attributes[E]:"",m=oe(e.geometry),p=e.geometry,h=r.getNearestCoordinate(p,c),v=r.getNearestCoordinate(p,c);v.distance<3*g.distance&&(h.coordinate=v.coordinate),m.push(h.coordinate),yield He(i,a,m,o,t).then((r=>nt(this,void 0,void 0,(function*(){const c=Math.min(...r),m=Math.max(...r);yield He(i,a,[h.coordinate],o,t).then((r=>{r.forEach((r=>{let p=new Date(Date.now());re(l)&&p>l?p=Fe(o,i):p.setHours(0,0,0,0);let v=new Date(Date.now());re(l)&&v>l?v=Fe(l,i):v.setHours(0,0,0,0),re(l)||(v=null);let y=re(o)?Fe(o,i):null,g=re(l)?Fe(l,i):null;d&&f&&""!==s.toRouteId&&t!==s.toRouteId&&(y=s.toRouteFromDate,g=s.toRouteToDate);h.coordinate.hasZ=!0;const b={routeId:d?t:s.routeId,toRouteId:d?s.toRouteId:t,routeName:d?n:s.routeName,toRouteName:d?s.toRouteName:n,lineId:s.lineId,toLineId:s.toLineId,lineName:s.lineName,routeLineOrder:d?u:s.routeLineOrder,toRouteLineOrder:d?s.toRouteLineOrder:u,fromMeasure:d?q(c,a.measurePrecision):s.fromMeasure,toMeasure:d?q(m,a.measurePrecision):s.toMeasure,toRouteFromMeasure:d?s.toRouteFromMeasure:q(c,a.measurePrecision),toRouteToMeasure:d?s.toRouteToMeasure:q(m,a.measurePrecision),selectedMeasure:d?q(r,a.measurePrecision):s.selectedMeasure,selectedToMeasure:d?s.selectedToMeasure:q(r,a.measurePrecision),fromDate:d?re(o)?Fe(o,i):null:s.fromDate,toDate:d?re(l)?Fe(l,i):null:s.toDate,toRouteFromDate:y,toRouteToDate:g,selectedFromDate:s.selectedFromDate,selectedToDate:s.selectedToDate,selectedPoint:d?h.coordinate:s.selectedPoint,selectedToPoint:d?s.selectedToPoint:h.coordinate,selectedPolyline:e.geometry,selectedToPolyline:d?s.selectedToPolyline:e.geometry,validRoute:!!d||s.validRoute,validToRoute:!d||s.validToRoute};L.push(b)}))}))}))))}})))))})))).then((()=>{L.length>1?y(L):1===L.length&&((e,t=!1)=>{v(e,t),k()})(L[0],!0)})).finally((()=>{l&&(I.popupEnabled=!1),F(),h(),w.current=!1})).catch((()=>{F(),h(),w.current=!1}))})))))}catch(e){console.error("Error in pointerClickHandler",e)}n()}))}));return(0,n.jsx)(B.CalciteButton,{scale:"s",iconStart:"select",css:Te(),disabled:!!l||void 0,appearance:r?"solid":"transparent",kind:r?"brand":"neutral",onClick:()=>{h()}})}var ot=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function it(e){const t=n.hooks.useTranslation(K),{isOpen:r,routeInfos:o,useRouteName:i,measurePrecision:a,isFrom:s,jimuMapView:l,graphicLayer:u,onRouteSelect:c,onRouteSelectCancel:d}=e,f=16,m=n.React.useRef(null),[p,h]=n.React.useState({x:0,y:0}),[v,y]=n.React.useState({width:500,height:250});n.React.useEffect((()=>{if(o.length){m.current=o[0];const e=S(),t=w();if(y({width:t,height:e}),g(s,0),re(l)&&re(l.view)){const e=s?o[0].selectedPoint:o[0].selectedToPoint;if(re(e)){const t=null==l?void 0:l.view.toScreen(e);if(t){const e=p;e.x=t.x+f,e.y=t.y+f;const n=N(t.x,t.y,null==l?void 0:l.view);n&&(e.x=n.x+f,e.y=n.y+f),h(e)}}}}}),[o]);const g=(e,t)=>ot(this,void 0,void 0,(function*(){if(re(u)){if(u.removeAll(),e&&re(o[t].selectedPolyline)){const e=yield Oe(yield Ue(o[t].selectedPolyline),je,6);u.add(e)}if(!e&&re(o[t].selectedToPolyline)){const e=yield Oe(yield Ue(o[t].selectedToPolyline),je,6);u.add(e)}}})),b=()=>{re(u)&&u.removeAll()},I=()=>{b(),d()},N=(e,t,n)=>{if(!n)return;const r=w(),o=S(),i=e>=0&&t>=0&&e+r<=window.innerWidth&&t+o<=window.innerHeight,a=n.width-e+32,s=n.height-t+32;return i?null:(e+r>window.innerWidth&&(e=window.innerWidth-r-a),t+o>window.innerHeight&&(t=window.innerHeight-o-s),e<0&&(e=0),t<0&&(t=0),{x:e,y:t})},S=n.React.useCallback((()=>{const e=250;return 2===o.length?e:3===o.length?290:4===o.length?330:o.length>=5?370:e}),[o]),w=n.React.useCallback((()=>i?700:500),[i]),R=n.React.useCallback((e=>{h(e)}),[]),F=n.React.useCallback(((e,t)=>{const n=S(),r=w();e.height<=n&&(e.height=n),e.width<=r&&(e.width=r),e.height>370&&(e.height=370),e.width>700&&(e.width=700),y(e),h(t)}),[S,w]);return(0,n.jsx)("div",null,r&&(0,n.jsx)(z.FloatingPanel,{headerTitle:t("selectRouteLabel"),size:v,defaultPosition:p,position:p,disableActivateOverlay:!1,dragBounds:"body",onDrag:R,onResize:F,onLeave:I,onHeaderClose:I},(0,n.jsx)("div",{css:De()},(null==o?void 0:o.length)&&(0,n.jsx)(B.CalciteTable,{pageSize:5,caption:t("routePicker"),striped:!0,bordered:!0,"selection-mode":"single",scale:"s"},(0,n.jsx)("calcite-table-row",{slot:"table-header"},i&&(0,n.jsx)("calcite-table-header",{heading:t("routeNameLabel")}),(0,n.jsx)("calcite-table-header",{heading:t("routeIdLabel")}),(0,n.jsx)("calcite-table-header",{heading:t("fromDateLabel")}),(0,n.jsx)("calcite-table-header",{heading:t("toDateLabel")}),(0,n.jsx)("calcite-table-header",{heading:t("measureLabel")})),o.map(((e,t)=>(0,n.jsx)(B.CalciteTableRow,{key:t,selected:0===t,onCalciteTableRowSelect:()=>{(e=>{g(s,e),m.current=o[e]})(t)}},i&&(0,n.jsx)("calcite-table-cell",{minWidth:200,itemKey:t},(0,n.jsx)("span",{style:{textWrap:"nowrap",minWidth:"100px"}},s?e.routeName:e.toRouteName)),(0,n.jsx)("calcite-table-cell",{minWidth:200,itemKey:t},(0,n.jsx)("span",{style:{textWrap:"nowrap",minWidth:"100px"}},s?e.routeId:e.toRouteId)),(0,n.jsx)("calcite-table-cell",{style:{minWidth:"100px"},itemKey:t},(0,n.jsx)("span",{style:{textWrap:"nowrap",minWidth:"100px"}},re(e.fromDate)?e.fromDate.toLocaleDateString():"")),(0,n.jsx)("calcite-table-cell",{style:{minWidth:"100px"},itemKey:t},(0,n.jsx)("span",{style:{textWrap:"nowrap",minWidth:"100px"}},re(e.toDate)?e.toDate.toLocaleDateString():"")),(0,n.jsx)("calcite-table-cell",{style:{minWidth:"100px"},itemKey:t},(0,n.jsx)("span",{style:{textWrap:"nowrap",minWidth:"100px"}},q(s?e.selectedMeasure:e.selectedToMeasure,a))))))),(0,n.jsx)("div",{className:"pt-1 d-flex justify-content-center"},(0,n.jsx)(z.Button,{className:"mr-2",style:{width:"100px"},type:"secondary",onClick:I},t("cancel")),(0,n.jsx)(z.Button,{className:"ml-2",style:{width:"100px"},type:"primary",onClick:()=>{b(),re(m.current)&&c(m.current)}},t("ok"))))))}const at=function(e){return null===e};function st(e,t,n,r){const o={hasError:!1,message:""};let i=[];if(re(n)){const e=n;i=null==e?void 0:e.layer.fields}else re(r)&&i.push(r);const a=i.find((e=>e.name===t));if(a){if(!re(e)&&a.nullable)return o;if(re(e)||a.nullable||(o.hasError=!0,o.message="nonNullable"),"string"==typeof e&&0===e.length&&a.nullable)return o;"string"!=typeof e||0!==e.length||a.nullable||(o.hasError=!0,o.message="nonNullable"),"small-integer"===a.type?function(e){const t=Number(e);if(!Number.isInteger(t))return!1;if(t<-32768||t>32767)return!1;return!0}(e)||(o.hasError=!0,o.message="invalidShort"):"integer"===a.type?function(e){const t=Number(e);if(!Number.isInteger(t))return!1;if(t<-2147483648||t>2147483647)return!1;return!0}(e)||(o.hasError=!0,o.message="invalidInteger"):"single"===a.type?function(e){const t=Number(e);if(isNaN(t))return!1;return!0}(e)||(o.hasError=!0,o.message="invalidSingle"):"double"===a.type?function(e){const t=Number(e);if(isNaN(t))return!1;return!0}(e)||(o.hasError=!0,o.message="invalidDouble"):"string"===a.type?function(e,t){if(re(e)&&e.length>t)return!1;return!0}(e,a.length)||(o.hasError=!0,o.message="invalidString"):"date"===a.type&&(function(e){return!isNaN(Date.parse(e))}(e)||(o.hasError=!0,o.message="invalidDate"))}return o}function lt(e,t,n,r){const o={hasError:!1,message:""};let i=[];if(re(n)){const e=n;i=null==e?void 0:e.layer.fields}else re(r)&&i.push(r);const a=i.find((e=>e.name===t)),s=a.domain;if(re(a)&&re(s)&&"range"===a.domain.type){const t=s;if(a.nullable&&(at(e)||!re(e)||""===e))return o;if("number"==typeof t.minValue&&"number"==typeof t.maxValue){const n=Number(e);isNaN(n)&&(o.hasError=!0,o.message="invalidRange"),(n<t.minValue||n>t.maxValue)&&(o.hasError=!0,o.message="invalidRange")}else if("string"==typeof t.minValue&&"string"==typeof t.maxValue&&"string"==typeof e){const n=new Date(e),r=new Date(t.minValue),i=new Date(t.maxValue);(n<r||n>i)&&(o.hasError=!0,o.message="invalidRange")}}return o}function ut(e){return"date"===e}function ct(e){return"small-integer"===e||"big-integer"===e||"integer"===e||"single"===e||"double"===e||"long"===e}function dt(e){return"coded-value"===e}function ft(e){return"range"===e}function mt(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function pt(){return mt()+mt()+"-"+mt()+"-"+mt()+"-"+mt()+"-"+mt()+mt()+mt()}var ht=c(28996),vt=c.n(ht);const yt=n.React.memo((e=>{var t,r;const o=n.hooks.useTranslation(K),{validValues:i,fieldInfo:a,isSubtype:s,eventDS:l,selected:u,onSelectionChange:c,onUpdateItem:d}=e,[f,m]=n.React.useState(a.value),[p,h]=n.React.useState(""),[v,y]=n.React.useState(a.error);n.React.useEffect((()=>{if(re(a)){if(m(a.value),y(a.error),"contingentValueError"===a.error&&y(o("contingentValueError")),re(g.domain)&&dt(g.domain.type))if(re(a.value)){const e=b.codedValues.find((e=>"string"==typeof e.code?e.code.toLowerCase()===a.value.toLowerCase():e.code===a.value));re(e)?(h(R(e.code,e.name)),y("")):(h(a.value),y("Invalid value."))}else h("");if(s){const e=I.find((e=>"string"==typeof e.value?e.value.toLowerCase()===a.value.toLowerCase():e.value===a.value));h(e?R(e.value,e.label):"")}}}),[l,a]);const g=n.React.useMemo((()=>{const e=l,t=(null==e?void 0:e.layer.fields).find((e=>e.name===a.name));return t||(m(t.defaultValue),null)}),[l,a]),b=n.React.useMemo((()=>{if(re(g)&&re(g.domain)&&"coded-value"===g.domain.type){const e=g.domain.codedValues.some((e=>null===e.code&&e.name===o("nullLabel")));return g.nullable&&!e&&g.domain.codedValues.unshift({code:null,name:o("nullLabel")}),g.domain}return null}),[g]),I=n.React.useMemo((()=>{if(s){const e=null==l?void 0:l.layer;if(re(e)&&re(e.subtypes)){const t=e.subtypes.map((e=>({value:e.code,label:e.name})));if(t)return t}const t=null==l?void 0:l.getFieldCodedValueList(g.name);if(t)return t}return[]}),[l,g.name,s]),N=e=>{if(e.target.value!==f){if(m(e.target.value),re(a.value)&&re(g.domain)&&dt(g.domain.type)){const e=b.codedValues.find((e=>"string"==typeof e.code?e.code.toLowerCase()===a.value.toLowerCase():e.code===a.value));e&&h(R(e.code,e.name))}if(s){const t=I.find((e=>"string"==typeof e.value?e.value.toLowerCase()===a.value.toLowerCase():e.value===a.value));t&&h(R(t.value,t.label)),w(e.target.value,v)}else w(e.target.value,"")}},S=e=>{m(e)},w=(e,t)=>{d(e,t,a.index),c(-1)},R=(e,t)=>re(e)?`${e} - ${t}`:t;let F=[];return u&&re(g.domain)&&!s&&dt(g.domain.type)&&(F=(null===(t=null==e?void 0:e.contingentValues)||void 0===t?void 0:t.length)>0?e.contingentValues.map(((e,t)=>{var r;const o=(r=e.code,!(!i||!i.includes(r)))?{}:{color:"#a0a0a0",background:"#d5d5d5"};return(0,n.jsx)("option",{key:t,value:e.code,style:o},R(e.code,e.name))})):null===(r=null==b?void 0:b.codedValues)||void 0===r?void 0:r.map(((e,t)=>(0,n.jsx)("option",{key:t,value:e.code},R(e.code,e.name))))),(0,n.jsx)("div",{className:"attribute-table-field",style:{border:v.length?"1.2px solid red":"none"}},!u&&(0,n.jsx)("div",{onClick:()=>{a.editable&&c(a.index)},style:{borderRight:v.length?"6px solid red":"none",display:"flex",alignItems:"center"}},(0,n.jsx)(z.Label,{size:"sm",className:"w-100",style:{textOverflow:"ellipsis",width:100,marginBottom:0,alignItems:"center",textAlign:"left"}},s||re(g.domain)&&dt(g.domain.type)?re(f)?p:o("nullLabel"):"string"==typeof f&&f.length?f:"number"!=typeof f||isNaN(f)?re(f)&&"date"===g.type?new Date(f).toLocaleDateString():o("nullLabel"):f.toString()),(0,n.jsx)("span",{style:{margin:"0.1rem"}},v.length>0&&(0,n.jsx)(z.Icon,{icon:vt(),size:16,title:v,color:"red"}))),u&&!re(g.domain)&&!s&&!ut(g.type)&&(0,n.jsx)(z.TextInput,{size:"sm",className:"w-100",autoFocus:!0,required:!g.nullable,value:f,type:"text",onChange:e=>{S(e.currentTarget.value)},checkValidityOnAccept:e=>{if(!re(e)||a.value===e||!re(a.value)&&!e.length||a.contingentValError)return a.error.length?{valid:!1,msg:o(a.error)}:{valid:!0};const t=st(e,a.name,l);return t.hasError?(y(o(t.message)),"contingentValueError"===a.error&&y(o("contingentValueError")),w(e,t.message),{valid:!1,msg:o(t.message)}):(y(""),w(e,""),{valid:!0})}}),u&&!re(g.domain)&&!s&&ut(g.type)&&(0,n.jsx)(B.CalciteInputDatePicker,{scale:"s",valueAsDate:re(f)?new Date(f):null,onCalciteInputDatePickerChange:e=>{var t,n;const r=null===(t=e.target)||void 0===t?void 0:t.valueAsDate;if(a.value===r)return a.error.length?{valid:!1,msg:o(a.error)}:{valid:!0};const i=st(null===(n=e.target)||void 0===n?void 0:n.valueAsDate,a.name,l);return i.hasError?(y(o(i.message)),"contingentValueError"===a.error&&y(o("contingentValueError")),w(r,i.message),{valid:!1,msg:o(i.message)}):(y(""),w(r,""),{valid:!0})},placement:"top",overlayPositioning:"fixed"}),u&&re(g.domain)&&!s&&dt(g.domain.type)&&(0,n.jsx)(z.Select,{size:"sm",className:"w-100",value:f,onChange:e=>{N(e)}},F),u&&s&&(0,n.jsx)(z.Select,{size:"sm",className:"w-100",value:f,onChange:e=>{N(e)}},I.map(((e,t)=>(0,n.jsx)("option",{key:t,value:e.value},R(e.value,e.label))))),u&&re(g.domain)&&ft(g.domain.type)&&(0,n.jsx)(z.TextInput,{size:"sm",className:"w-100",autoFocus:!0,required:!g.nullable,value:f,onChange:e=>{S(e.currentTarget.value)},checkValidityOnAccept:e=>{if(a.value===e)return a.error.length?{valid:!1,msg:o(a.error)}:{valid:!0};const t=lt(e,a.name,l);return t.hasError?(y(o(t.message)),"contingentValueError"===a.error&&y(o("contingentValueError")),w(e,t.message),{valid:!1,msg:o(t.message)}):(y(""),w(e,""),{valid:!0})}}))}));const gt=function(){this.__data__=[],this.size=0};const bt=function(e,t){return e===t||e!=e&&t!=t};const It=function(e,t){for(var n=e.length;n--;)if(bt(e[n][0],t))return n;return-1};var Nt=Array.prototype.splice;const St=function(e){var t=this.__data__,n=It(t,e);return!(n<0)&&(n==t.length-1?t.pop():Nt.call(t,n,1),--this.size,!0)};const wt=function(e){var t=this.__data__,n=It(t,e);return n<0?void 0:t[n][1]};const Rt=function(e){return It(this.__data__,e)>-1};const Ft=function(e,t){var n=this.__data__,r=It(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function kt(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}kt.prototype.clear=gt,kt.prototype.delete=St,kt.prototype.get=wt,kt.prototype.has=Rt,kt.prototype.set=Ft;const Dt=kt;const Tt=function(){this.__data__=new Dt,this.size=0};const xt=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};const Et=function(e){return this.__data__.get(e)};const Mt=function(e){return this.__data__.has(e)};const Lt=function(e){if(!p(e))return!1;var t=R(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};const jt=s["__core-js_shared__"];var At,Ot=(At=/[^.]+$/.exec(jt&&jt.keys&&jt.keys.IE_PROTO||""))?"Symbol(src)_1."+At:"";const Pt=function(e){return!!Ot&&Ot in e};var Ct=Function.prototype.toString;const Vt=function(e){if(null!=e){try{return Ct.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var _t=/^\[object .+?Constructor\]$/,Ut=Function.prototype,$t=Object.prototype,Gt=Ut.toString,qt=$t.hasOwnProperty,Bt=RegExp("^"+Gt.call(qt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const zt=function(e){return!(!p(e)||Pt(e))&&(Lt(e)?Bt:_t).test(Vt(e))};const Wt=function(e,t){return null==e?void 0:e[t]};const Ht=function(e,t){var n=Wt(e,t);return zt(n)?n:void 0};const Qt=Ht(s,"Map");const Kt=Ht(Object,"create");const Jt=function(){this.__data__=Kt?Kt(null):{},this.size=0};const Yt=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var Zt=Object.prototype.hasOwnProperty;const Xt=function(e){var t=this.__data__;if(Kt){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return Zt.call(t,e)?t[e]:void 0};var en=Object.prototype.hasOwnProperty;const tn=function(e){var t=this.__data__;return Kt?void 0!==t[e]:en.call(t,e)};const nn=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Kt&&void 0===t?"__lodash_hash_undefined__":t,this};function rn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}rn.prototype.clear=Jt,rn.prototype.delete=Yt,rn.prototype.get=Xt,rn.prototype.has=tn,rn.prototype.set=nn;const on=rn;const an=function(){this.size=0,this.__data__={hash:new on,map:new(Qt||Dt),string:new on}};const sn=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};const ln=function(e,t){var n=e.__data__;return sn(t)?n["string"==typeof t?"string":"hash"]:n.map};const un=function(e){var t=ln(this,e).delete(e);return this.size-=t?1:0,t};const cn=function(e){return ln(this,e).get(e)};const dn=function(e){return ln(this,e).has(e)};const fn=function(e,t){var n=ln(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function mn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}mn.prototype.clear=an,mn.prototype.delete=un,mn.prototype.get=cn,mn.prototype.has=dn,mn.prototype.set=fn;const pn=mn;const hn=function(e,t){var n=this.__data__;if(n instanceof Dt){var r=n.__data__;if(!Qt||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new pn(r)}return n.set(e,t),this.size=n.size,this};function vn(e){var t=this.__data__=new Dt(e);this.size=t.size}vn.prototype.clear=Tt,vn.prototype.delete=xt,vn.prototype.get=Et,vn.prototype.has=Mt,vn.prototype.set=hn;const yn=vn;const gn=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e};const bn=function(){try{var e=Ht(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();const In=function(e,t,n){"__proto__"==t&&bn?bn(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n};var Nn=Object.prototype.hasOwnProperty;const Sn=function(e,t,n){var r=e[t];Nn.call(e,t)&&bt(r,n)&&(void 0!==n||t in e)||In(e,t,n)};const wn=function(e,t,n,r){var o=!n;n||(n={});for(var i=-1,a=t.length;++i<a;){var s=t[i],l=r?r(n[s],e[s],s,n,e):void 0;void 0===l&&(l=e[s]),o?In(n,s,l):Sn(n,s,l)}return n};const Rn=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r};const Fn=function(e){return F(e)&&"[object Arguments]"==R(e)};var kn=Object.prototype,Dn=kn.hasOwnProperty,Tn=kn.propertyIsEnumerable,xn=Fn(function(){return arguments}())?Fn:function(e){return F(e)&&Dn.call(e,"callee")&&!Tn.call(e,"callee")};const En=xn;const Mn=function(){return!1};var Ln="object"==typeof exports&&exports&&!exports.nodeType&&exports,jn=Ln&&"object"==typeof module&&module&&!module.nodeType&&module,An=jn&&jn.exports===Ln?s.Buffer:void 0;const On=(An?An.isBuffer:void 0)||Mn;var Pn=/^(?:0|[1-9]\d*)$/;const Cn=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&Pn.test(e))&&e>-1&&e%1==0&&e<t};const Vn=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var _n={};_n["[object Float32Array]"]=_n["[object Float64Array]"]=_n["[object Int8Array]"]=_n["[object Int16Array]"]=_n["[object Int32Array]"]=_n["[object Uint8Array]"]=_n["[object Uint8ClampedArray]"]=_n["[object Uint16Array]"]=_n["[object Uint32Array]"]=!0,_n["[object Arguments]"]=_n["[object Array]"]=_n["[object ArrayBuffer]"]=_n["[object Boolean]"]=_n["[object DataView]"]=_n["[object Date]"]=_n["[object Error]"]=_n["[object Function]"]=_n["[object Map]"]=_n["[object Number]"]=_n["[object Object]"]=_n["[object RegExp]"]=_n["[object Set]"]=_n["[object String]"]=_n["[object WeakMap]"]=!1;const Un=function(e){return F(e)&&Vn(e.length)&&!!_n[R(e)]};const $n=function(e){return function(t){return e(t)}};var Gn="object"==typeof exports&&exports&&!exports.nodeType&&exports,qn=Gn&&"object"==typeof module&&module&&!module.nodeType&&module,Bn=qn&&qn.exports===Gn&&i.process;const zn=function(){try{var e=qn&&qn.require&&qn.require("util").types;return e||Bn&&Bn.binding&&Bn.binding("util")}catch(e){}}();var Wn=zn&&zn.isTypedArray;const Hn=Wn?$n(Wn):Un;var Qn=Object.prototype.hasOwnProperty;const Kn=function(e,t){var n=P(e),r=!n&&En(e),o=!n&&!r&&On(e),i=!n&&!r&&!o&&Hn(e),a=n||r||o||i,s=a?Rn(e.length,String):[],l=s.length;for(var u in e)!t&&!Qn.call(e,u)||a&&("length"==u||o&&("offset"==u||"parent"==u)||i&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Cn(u,l))||s.push(u);return s};var Jn=Object.prototype;const Yn=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Jn)};const Zn=function(e,t){return function(n){return e(t(n))}};const Xn=Zn(Object.keys,Object);var er=Object.prototype.hasOwnProperty;const tr=function(e){if(!Yn(e))return Xn(e);var t=[];for(var n in Object(e))er.call(e,n)&&"constructor"!=n&&t.push(n);return t};const nr=function(e){return null!=e&&Vn(e.length)&&!Lt(e)};const rr=function(e){return nr(e)?Kn(e):tr(e)};const or=function(e,t){return e&&wn(t,rr(t),e)};const ir=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t};var ar=Object.prototype.hasOwnProperty;const sr=function(e){if(!p(e))return ir(e);var t=Yn(e),n=[];for(var r in e)("constructor"!=r||!t&&ar.call(e,r))&&n.push(r);return n};const lr=function(e){return nr(e)?Kn(e,!0):sr(e)};const ur=function(e,t){return e&&wn(t,lr(t),e)};var cr="object"==typeof exports&&exports&&!exports.nodeType&&exports,dr=cr&&"object"==typeof module&&module&&!module.nodeType&&module,fr=dr&&dr.exports===cr?s.Buffer:void 0,mr=fr?fr.allocUnsafe:void 0;const pr=function(e,t){if(t)return e.slice();var n=e.length,r=mr?mr(n):new e.constructor(n);return e.copy(r),r};const hr=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t};const vr=function(e,t){for(var n=-1,r=null==e?0:e.length,o=0,i=[];++n<r;){var a=e[n];t(a,n,e)&&(i[o++]=a)}return i};const yr=function(){return[]};var gr=Object.prototype.propertyIsEnumerable,br=Object.getOwnPropertySymbols;const Ir=br?function(e){return null==e?[]:(e=Object(e),vr(br(e),(function(t){return gr.call(e,t)})))}:yr;const Nr=function(e,t){return wn(e,Ir(e),t)};const Sr=function(e,t){for(var n=-1,r=t.length,o=e.length;++n<r;)e[o+n]=t[n];return e};const wr=Zn(Object.getPrototypeOf,Object);const Rr=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Sr(t,Ir(e)),e=wr(e);return t}:yr;const Fr=function(e,t){return wn(e,Rr(e),t)};const kr=function(e,t,n){var r=t(e);return P(e)?r:Sr(r,n(e))};const Dr=function(e){return kr(e,rr,Ir)};const Tr=function(e){return kr(e,lr,Rr)};const xr=Ht(s,"DataView");const Er=Ht(s,"Promise");const Mr=Ht(s,"Set");const Lr=Ht(s,"WeakMap");var jr="[object Map]",Ar="[object Promise]",Or="[object Set]",Pr="[object WeakMap]",Cr="[object DataView]",Vr=Vt(xr),_r=Vt(Qt),Ur=Vt(Er),$r=Vt(Mr),Gr=Vt(Lr),qr=R;(xr&&qr(new xr(new ArrayBuffer(1)))!=Cr||Qt&&qr(new Qt)!=jr||Er&&qr(Er.resolve())!=Ar||Mr&&qr(new Mr)!=Or||Lr&&qr(new Lr)!=Pr)&&(qr=function(e){var t=R(e),n="[object Object]"==t?e.constructor:void 0,r=n?Vt(n):"";if(r)switch(r){case Vr:return Cr;case _r:return jr;case Ur:return Ar;case $r:return Or;case Gr:return Pr}return t});const Br=qr;var zr=Object.prototype.hasOwnProperty;const Wr=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&zr.call(e,"index")&&(n.index=e.index,n.input=e.input),n};const Hr=s.Uint8Array;const Qr=function(e){var t=new e.constructor(e.byteLength);return new Hr(t).set(new Hr(e)),t};const Kr=function(e,t){var n=t?Qr(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)};var Jr=/\w*$/;const Yr=function(e){var t=new e.constructor(e.source,Jr.exec(e));return t.lastIndex=e.lastIndex,t};var Zr=h?h.prototype:void 0,Xr=Zr?Zr.valueOf:void 0;const eo=function(e){return Xr?Object(Xr.call(e)):{}};const to=function(e,t){var n=t?Qr(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)};const no=function(e,t,n){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return Qr(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return Kr(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return to(e,n);case"[object Map]":case"[object Set]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return Yr(e);case"[object Symbol]":return eo(e)}};var ro=Object.create;const oo=function(){function e(){}return function(t){if(!p(t))return{};if(ro)return ro(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();const io=function(e){return"function"!=typeof e.constructor||Yn(e)?{}:oo(wr(e))};const ao=function(e){return F(e)&&"[object Map]"==Br(e)};var so=zn&&zn.isMap;const lo=so?$n(so):ao;const uo=function(e){return F(e)&&"[object Set]"==Br(e)};var co=zn&&zn.isSet;const fo=co?$n(co):uo;var mo="[object Arguments]",po="[object Function]",ho="[object Object]",vo={};vo[mo]=vo["[object Array]"]=vo["[object ArrayBuffer]"]=vo["[object DataView]"]=vo["[object Boolean]"]=vo["[object Date]"]=vo["[object Float32Array]"]=vo["[object Float64Array]"]=vo["[object Int8Array]"]=vo["[object Int16Array]"]=vo["[object Int32Array]"]=vo["[object Map]"]=vo["[object Number]"]=vo[ho]=vo["[object RegExp]"]=vo["[object Set]"]=vo["[object String]"]=vo["[object Symbol]"]=vo["[object Uint8Array]"]=vo["[object Uint8ClampedArray]"]=vo["[object Uint16Array]"]=vo["[object Uint32Array]"]=!0,vo["[object Error]"]=vo[po]=vo["[object WeakMap]"]=!1;const yo=function e(t,n,r,o,i,a){var s,l=1&n,u=2&n,c=4&n;if(r&&(s=i?r(t,o,i,a):r(t)),void 0!==s)return s;if(!p(t))return t;var d=P(t);if(d){if(s=Wr(t),!l)return hr(t,s)}else{var f=Br(t),m=f==po||"[object GeneratorFunction]"==f;if(On(t))return pr(t,l);if(f==ho||f==mo||m&&!i){if(s=u||m?{}:io(t),!l)return u?Fr(t,ur(s,t)):Nr(t,or(s,t))}else{if(!vo[f])return i?t:{};s=no(t,f,l)}}a||(a=new yn);var h=a.get(t);if(h)return h;a.set(t,s),fo(t)?t.forEach((function(o){s.add(e(o,n,r,o,t,a))})):lo(t)&&t.forEach((function(o,i){s.set(i,e(o,n,r,i,t,a))}));var v=d?void 0:(c?u?Tr:Dr:u?lr:rr)(t);return gn(v||t,(function(o,i){v&&(o=t[i=o]),Sn(s,i,e(o,n,r,i,t,a))})),s};const go=function(e){return yo(e,5)};var bo=c(47626),Io=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};const No=c(8547),So=n.React.memo((e=>{const t=n.hooks.useTranslation(K),{tableIndex:r,eventDS:o,eventLayer:i,fieldInfos:a,useAlias:s,collapable:l,isExpanded:u,onItemChecked:c,onUpdateItem:d,onUpdateAll:f,onFieldGrpUpdated:m,tableLabel:p,isReset:h}=e,[v,y]=n.React.useState(!1),[g,b]=n.React.useState(""),[I,N]=n.React.useState(null),[S,w]=n.React.useState(NaN),[R,F]=n.React.useState(NaN),[k,D]=n.React.useState(u),[T,x]=n.React.useState(-1),E=n.React.useRef([]),M=n.React.useMemo((()=>{if(re(o)){const e=null==o?void 0:o.layer;if(re(e)&&re(e.subtypes)&&(null==e?void 0:e.subtypes.length)>0)return y(!0),b(e.subtypeField),e.subtypes}return[]}),[o]);n.React.useEffect((()=>{x(-1),F(-1),Io(void 0,void 0,void 0,(function*(){let t;const n=null==o?void 0:o.layer,i=yield(0,bo.fetchEnterpriseFieldGroup)(n);if((null==i?void 0:i.length)>0){t=yield i.map((e=>({name:e.name,isEditingRestrictive:e.isEditingRestrictive,fields:e.fieldNames.names.map((e=>(0,bo.normalizeFieldName)(null==e?void 0:e.toLocaleUpperCase())))})));const o=yield(0,bo.fetchEnterpriseContingentValues)(n),s=(0,bo.setContingentValues)(o,t,n,S),l=(0,bo.validateContingencyConstraints)(-1,"",-1,a,s);if((null==l?void 0:l.length)>0){const t=[];for(let e=0;e<(null==l?void 0:l.length);e++){const n=l[e];t.push(null==n?void 0:n.fieldGroup)}e.onFieldGrpUpdated(t,r)}else e.onFieldGrpUpdated([],r);N(s)}else N([])}))}),[o]),n.React.useEffect((()=>{h&&(F(-1),x(-1))}),[h]),n.React.useEffect((()=>{if(re(a)&&v){const e=a.find((e=>e.name.toLowerCase()===g.toLowerCase()));e&&e.value!==S&&w(e.value)}T>-1&&re(E.current)&&(E.current[T].setFocus(),x(-1))}),[a]),n.React.useEffect((()=>{D(u)}),[u]),n.React.useEffect((()=>{if(!isNaN(S)&&re(M)){const e=M.findIndex((e=>e.code===S));if(e>-1){const t=M[e].defaultValues,n=go(a);let r;for(r in t){const e=n.findIndex((e=>e.name===r));e>-1&&(ut(n[e].type)?n[e].value=re(t[r])?new Date(t[r]):null:r.toLowerCase()===g.toLowerCase()?n[e].value=S:n[e].value=t[r],n[e].error="")}A(n)}}}),[S]);const L=(e,t,n)=>{const o=go(a);o[e].value=t,o[e].error=n,I.forEach((e=>{const t=null==e?void 0:e.fields;null==o||o.forEach((e=>{const n=null==e?void 0:e.name;t.includes(n)&&(e.error="",e.contingentValError=!1)}))}));const i=(0,bo.validateContingencyConstraints)(t,n,e,a,I);if((null==i?void 0:i.length)>0){const e=[];for(let t=0;t<(null==i?void 0:i.length);t++){const n=i[t];e.push(null==n?void 0:n.fieldGroup)}null==e||e.forEach((e=>{const t=null==e?void 0:e.fields;null==o||o.forEach((e=>{const n=null==e?void 0:e.name;t.includes(n)&&(e.error="contingentValueError",e.contingentValError=!0)}))})),m(e,r)}else m([],r);f(o,r)},j=(e,t,n)=>{if(v){a[n].name.toLowerCase()===g.toLowerCase()?w(e):(null==I?void 0:I.length)>0?L(n,e,t):d(e,t,n,r)}else(null==I?void 0:I.length)>0?L(n,e,t):d(e,t,n,r);x(n)},A=e=>{f(e,r)},O=e=>{const n=re(e.error)&&e.error.length,r=re(e.default)&&e.default.length>0,o=re(e.length)&&!isNaN(e.length);let i=e.type;return o&&(i=t("fieldTypeWithLength",{fieldType:e.type,length:e.length})),n?t("fieldInfoWithError",{name:e.name,alias:e.alias,type:i,nullable:e.nullable?t("trueKey"):t("falseKey"),default:r?e.default.toString():t("nullLabel"),editable:e.editable?t("trueKey"):t("falseKey"),error:"contingentValueError"===e.error?"Invalid contingent value in the field":t(e.error)}):t("fieldInfo",{name:e.name,alias:e.alias,type:i,nullable:e.nullable?t("trueKey"):t("falseKey"),editable:e.editable?t("trueKey"):t("falseKey"),default:r?e.default.toString():t("nullLabel")})},P=e=>{F(e),re(E.current)&&T>-1&&E.current[T].setFocus()},C=e=>{const t=[];if(!(0,bo.fieldsWithContingentValues)(I).has(e.name))return[];if(!I||0===I.length||!a||0===a.length)return[];const n=[];if((null==I?void 0:I.length)>0)for(const r of I){const o=null==r?void 0:r.contingencies,i=null==r?void 0:r.fields;if(o&&(null==i?void 0:i.includes(e.name)))for(const r of o){let o=null,i=!1;const s=Object.keys(r.values);null==s||s.forEach((t=>{const n=r.values[t];if(t===e.name)"code"===n.objectType&&(o=n.codedValue.code);else if("code"===n.objectType){const e=n.codedValue.code;a.some((n=>{if(n.name===t){const t=n.value;return(t===e||null===t)&&(i=!0),!0}return!1}))}})),null!==o&&(i?t.push(o):n.push(o))}}return t};return(0,n.jsx)("div",{className:"attributes-table w-100 pt-3 px-3",css:n.css`
  --calcite-color-brand: var(--sys-color-primary-main);
  --calcite-color-brand-press: var(--sys-color-primary-main);
  --calcite-color-brand-hover: var(--sys-color-action-hover);

    .event-layer-label {
      pointer-events: none;
      text: truncate;
      width: 100%;
      padding-top: 2px;
    }
    .event-layer-checkbox {
      pointer-events: auto;
    }
  `},l&&(0,n.jsx)(z.Label,{size:"sm",className:"event-layer-label",centric:!0,check:!0,style:{textOverflow:"ellipsis",fontWeight:500}},(0,n.jsx)(z.Checkbox,{checked:k,className:"event-layer-checkbox mr-2",onChange:(e,t)=>{c(t,r),D(t)}}),null==i?void 0:i.name),!l&&(0,n.jsx)(z.Label,{size:"sm",className:"text-truncate w-100 mb-0",centric:!0,style:{textOverflow:"ellipsis",fontWeight:500}},re(p)?p:null==i?void 0:i.name),(0,n.jsx)(B.CalciteTable,{caption:"Attribute Table",bordered:!0,className:"table-container",scale:"s",layout:"fixed",hidden:l&&!k},(0,n.jsx)(B.CalciteTableRow,{slot:"table-header"},(0,n.jsx)(B.CalciteTableHeader,{heading:t("attribute")}),(0,n.jsx)(B.CalciteTableHeader,{heading:t("value")})),re(a)&&a.map((e=>(0,n.jsx)(B.CalciteTableRow,{key:e.index},(0,n.jsx)(B.CalciteTableCell,{alignment:"center"},(0,n.jsx)("div",{className:"w-100 d-flex"},(0,n.jsx)(z.Label,{title:O(e),size:"sm",className:"text-truncate",style:{textOverflow:"ellipsis",marginBottom:0,alignItems:"center",textAlign:"left"}},s?e.alias:e.name),!e.editable&&(0,n.jsx)(z.Icon,{className:"ml-auto my-auto",icon:No,size:16,style:{alignItems:"center"}}))),(0,n.jsx)(B.CalciteTableCell,{alignment:"center",ref:t=>{E.current[e.index]=t},onKeyDown:t=>{((e,t)=>{"Enter"===e.key&&F(t)})(t,e.index)},style:{border:"2px solid red"}},(0,n.jsx)(yt,{validValues:C(e),contingentValues:(0,bo.getContingentOptions)(e.name,I),fieldGroups:I,eventDS:o,isSubtype:e.name.toLowerCase()===g.toLowerCase(),fieldInfo:e,useAlias:s,selected:R===e.index,onSelectionChange:P,onUpdateItem:j})))))))})),wo=(0,t.withTheme)((0,t.withStyles)(So,"AttributeTable")),Ro=n.React.memo((e=>{const{label:t,isDisabled:r,defaultItem:o,listItems:i,altItemDescriptions:a,onSelectionChanged:s}=e,[l,u]=n.React.useState(!1),c=n.React.useRef(null),d=n.React.useRef(null),[f,m]=n.React.useState(!1);n.React.useEffect((()=>{f&&(d.current&&(0,n.focusElementInKeyboardMode)(d.current,!0),c.current&&c.current.setFocus(),m(!1))}),[f]);return(0,n.jsx)("div",{className:"inline-editing-dropdown",css:Te()},t.length>0&&(0,n.jsx)(z.Label,{size:"sm",centric:!0,className:"text-truncate pb-0 mb-0 pt-3 px-3 w-100",style:{textOverflow:"ellipsis",fontWeight:500}},t),(!l||r)&&(0,n.jsx)("div",{className:"d-flex w-100 px-3"},(0,n.jsx)(z.Label,{size:"sm",centric:!0,className:"text-truncate d-flex pb-0 mb-0 w-100",style:{textOverflow:"ellipsis"}},(()=>{if(a){const e=i.findIndex((e=>e===o));return e>-1?a[e]:o}return o})()),(0,n.jsx)(B.CalciteButton,{ref:c,className:(0,n.classNames)("inline-editing-edit__action",{"d-none":1===i.length||r}),scale:"s",disabled:r||i.length<=1,iconStart:"pencil",appearance:"transparent",kind:"neutral",onClick:()=>{m(!0),u(!0)}})),l&&(0,n.jsx)("div",{className:"d-flex w-100 px-3"},(0,n.jsx)(z.Select,{ref:d,className:"w-100",size:"sm",value:o,onChange:e=>{var t;t=e.target.value,m(!0),u(!1),s(t)}},i.map(((e,t)=>(0,n.jsx)("option",{key:t,value:e}," ",((e,t)=>a&&(null==a?void 0:a.length)>0?a[e]:t)(t,e))))),(0,n.jsx)(B.CalciteButton,{scale:"s",iconStart:"x",appearance:"transparent",kind:"neutral",onClick:()=>{m(!0),u(!1)}})))})),Fo=(e,t)=>{var r,o,i,a,s,l,u,c,d,f,m,p,h,v,y;return n.css`
    & {
      width: ${n.polished.rem(null===(r=null==t?void 0:t.current)||void 0===r?void 0:r.clientWidth)};
      padding-top: 0;
      padding-bottom: 0;
      /* visibility: unset !important; */
    }
    &.hide-popper {
      border: none;
      outline: none;
      box-shadow: none;
      width: 0;
    }
    button {
      width: 100%;
      border: none;
      text-align: left;
      min-height: ${n.polished.rem(32)};
      border-radius: 0;
    }
    .result-list-content {
      position: relative;
      overflow: auto;
    }
    &.suggestion-list-con, .result-list-content {
      max-height: ${n.polished.rem(300)};
    }
    &.suggestion-list-con {
      overflow: auto;
    }
    &.result-list-con button {
      text-overflow: ellipsis;
      white-space: pre-wrap;
      &:focus-visible {
        background: var(--ref-palette-neutral-200);
      }
    }
    &.result-list-con :disabled, &.result-list-con button:disabled:hover {
      color: ${null===(i=null===(o=null==e?void 0:e.sys.color)||void 0===o?void 0:o.secondary)||void 0===i?void 0:i.dark};
      background-color: ${null===(s=null===(a=null==e?void 0:e.ref.palette)||void 0===a?void 0:a.neutral)||void 0===s?void 0:s[300]};
    }
    &.result-list-con button:hover {
      color: ${null===(l=null==e?void 0:e.ref.palette)||void 0===l?void 0:l.black};
      background-color: ${null===(c=null===(u=null==e?void 0:e.ref.palette)||void 0===u?void 0:u.neutral)||void 0===c?void 0:c[200]};
    }
    &.result-list-con button:focus-visible {
      color: ${null===(d=null==e?void 0:e.ref.palette)||void 0===d?void 0:d.black};
      background-color: ${null===(m=null===(f=null==e?void 0:e.ref.palette)||void 0===f?void 0:f.neutral)||void 0===m?void 0:m[200]};
    }
    &.result-list-con .jimu-dropdown-item-divider {
      margin-left: 0;
      margin-right: 0;
    }
    &.result-list-con button.active {
      background: ${null===(p=null==e?void 0:e.sys.color)||void 0===p?void 0:p.primary.main};
      color: ${null===(h=null==e?void 0:e.ref.palette)||void 0===h?void 0:h.white};
    }
    .show-result-button:active, &.result-list-con .show-result-button:hover {
      background-color: ${null===(v=null==e?void 0:e.ref.palette)||void 0===v?void 0:v.white};
    }
    &.result-list-con .show-result-button:focus-visible {
      background-color: ${null===(y=null==e?void 0:e.ref.palette)||void 0===y?void 0:y.white};
    }
    .dropdown-menu--inner {
      max-height: none;
    }
    .jimu-dropdown-item {
      min-height: ${n.polished.rem(32)};
    }
    .clear-recent-search-con {
      color: var(--sys-color-primary-main) !important;
      height: ${n.polished.rem(40)};
      margin-top: ${n.polished.rem(-4)};
    }
    .jimu-dropdown-item-divider {
      min-height: 0;
    }
    .item-p-l {
      padding-left: ${n.polished.rem(42)} !important;
    }
    .source-label-con {
      color: var(--ref-palette-black) !important;
      font-weight: bold !important;
    }
    .show-result-button-style2 {
      & {
        padding: 0;
        height: ${n.polished.rem(11)};
        min-height: ${n.polished.rem(11)};
        justify-content: center;
        align-items: center;
      }
      svg {
        margin-right: 0;
      }
    }
    &.result-list-con-compact-close {
      & {
        width: ${n.polished.rem(32)};
        border-top: 0;
        justify-content: center;
      }
      .show-result-button {
        & {
          border-radius: 0 0 0.25rem 0.25rem;
          padding: 0;
          height: ${n.polished.rem(8)};
          min-height: ${n.polished.rem(8)};
          justify-content: center;
          align-items: center;
        }
        svg {
          margin-right: 0;
          height: ${n.polished.rem(8)};
        }
      }
    }
    &.result-list-con-compact-open {
      .show-result-button-style2-con {
        position: -webkit-sticky;
        position: sticky;
        bottom: 0;
        left: 0;
        right: 0;
        background: var(--ref-palette-white);
      }
    }
  `},ko=[0,3],{useEffect:Do,useRef:To}=n.React,xo=e=>{const r=To(null),o=To(null),{children:i,isOpen:a,reference:s,searchInputRef:l,autoFocus:u,className:c,isFocusWidtSearchInput:d,id:f,offset:m,version:p,toggle:h}=e,v=(0,t.useTheme)(),y=n.ReactRedux.useSelector((e=>{var t;const n=null==e?void 0:e.widgetsRuntimeInfo;return null===(t=null==n?void 0:n[f])||void 0===t?void 0:t.state}));Do((()=>{var e;return(null==l?void 0:l.current)&&d&&(null===(e=l.current)||void 0===e||e.addEventListener("keydown",g,!0)),()=>{var e;d&&(null===(e=l.current)||void 0===e||e.removeEventListener("keydown",g,!0))}}),[]);const g=n.hooks.useEventCallback((e=>{if(!a)return!1;const t=N()||[],r=(null==t?void 0:t.length)-1;"ArrowUp"===e.key?o.current=setTimeout((()=>{(0,n.focusElementInKeyboardMode)(t[r],!0)})):"ArrowDown"===e.key&&(o.current=setTimeout((()=>{(0,n.focusElementInKeyboardMode)(t[0],!0)})))})),b=n.hooks.useEventCallback((e=>{if(!a)return;const t="button"===e.target.getAttribute("role");if(["Tab","ArrowUp","ArrowDown"].includes(e.key)&&((e.which>=48&&e.which<=90||"Tab"===e.key)&&e.preventDefault(),a&&t))if(clearTimeout(o.current),"Escape"===e.key)I(e);else if(["ArrowUp","ArrowDown"].includes(e.key)||["n","p"].includes(e.key)&&e.ctrlKey){const t=N();let i=t.indexOf(e.target),a=!1;"ArrowUp"===e.key||"p"===e.key&&e.ctrlKey?(i=0!==i?i-1:t.length-1,a=!0):("ArrowDown"===e.key||"n"===e.key&&e.ctrlKey)&&(a=!1,i=i===t.length-1?0:i+1);const s=0===i&&!a,u=i===t.length-1&&a;o.current=d&&(s||u)?setTimeout((()=>{(0,n.focusElementInKeyboardMode)(l.current,!0)})):setTimeout((()=>{(0,n.focusElementInKeyboardMode)(Array.prototype.slice.call(r.current.querySelectorAll(".popper-box"))[0],!0),(0,n.focusElementInKeyboardMode)(t[i],!0)}))}else if("End"===e.key){const e=N();o.current=setTimeout((()=>{(0,n.focusElementInKeyboardMode)(e[e.length-1],!0)}))}else if("Home"===e.key){const e=N();o.current=setTimeout((()=>{(0,n.focusElementInKeyboardMode)(e[0],!0)}))}else if(e.which>=48&&e.which<=90){const t=N(),r=String.fromCharCode(e.which).toLowerCase();for(let e=0;e<t.length;e+=1){if((t[e].textContent&&t[e].textContent[0].toLowerCase())===r){o.current=setTimeout((()=>{(0,n.focusElementInKeyboardMode)(t[e],!0)}));break}}}})),I=e=>{e.preventDefault(),S(e),(0,n.focusElementInKeyboardMode)(null==l?void 0:l.current)},N=()=>r?Array.prototype.slice.call(r.current.querySelectorAll('[role="button"]')).filter((e=>!e.disabled)):[],S=e=>{h(e)};return(0,n.jsx)("div",null,(0,n.jsx)(z.Popper,{autoFocus:u,placement:"bottom-start",open:a,toggle:S,css:Fo(v,s),reference:s,version:p,className:(0,n.classNames)("result-list-popper",c,{"hide-popper":y===n.WidgetState.Closed}),offsetOptions:m||ko,ref:r},(0,n.jsx)("div",{onKeyDown:b},i)))},{useRef:Eo}=n.React,Mo=new(0,n.esri.Sanitizer),Lo=n.React.memo((e=>{const r=n.hooks.useTranslation(K),{className:o,reference:i,searchSuggestion:a,isOpen:s,searchText:l,id:u,searchInputRef:c,toggel:d,onRecordItemClick:f}=e,m=(0,t.useTheme)(),p=Eo(!1),h=()=>{if((null==a?void 0:a.length)<2)return!1;let e=0,t=0;return null==a||a.forEach((n=>{var r;const o=null==n?void 0:n.icon;o&&(e+=1),(null===(r=n.suggestionItem)||void 0===r?void 0:r.length)>0&&o&&(t+=1)})),t>0&&e>0},v=(e,t=!1)=>{const r=null==e?void 0:e.suggestionItem;return null==r?void 0:r.map(((r,o)=>{const i=Mo.sanitize(r.suggestionHtml);return(0,n.jsx)(z.Button,{className:(0,n.classNames)("d-flex align-items-center py-2 jimu-outline-inside",{"item-p-l":t}),key:`${null==e?void 0:e.layer}${o}`,title:r.suggestion,role:"button",onClick:()=>{(e=>{f(e)})(r.suggestion)}},(0,n.jsx)("div",{className:"flex-grow-1",dangerouslySetInnerHTML:{__html:i}}))}))};return(0,n.jsx)("div",null,(0,n.jsx)(xo,{isOpen:s,autoFocus:!1,reference:i,searchInputRef:c,isFocusWidtSearchInput:!0,toggle:d,id:u,className:(0,n.classNames)("result-list-con suggestion-list-con",o)},(()=>{let e=[];a.forEach((t=>{const n=(null==t?void 0:t.suggestionItem)||[];e=e.concat(n)}));return l&&0===e.length})()&&(0,n.jsx)(z.Button,{role:"button",className:"text-center py-2",disabled:!0,title:r("noResult",{searchText:l})},r("noResult",{searchText:l})),(p.current=null,null==a?void 0:a.map(((e,t)=>{var r,o,i;const s=(null==a?void 0:a.length)>1&&(null===(r=null==e?void 0:e.suggestionItem)||void 0===r?void 0:r.length)>0;return(0,n.jsx)("div",{key:`${null==e?void 0:e.layer}-${t}`,role:"group","aria-label":null==e?void 0:e.layer},s&&(0,n.jsx)(z.Button,{role:"button",className:"source-label-con jimu-outline-inside",disabled:!0,title:null==e?void 0:e.layer},(null==e?void 0:e.icon)&&(0,n.jsx)(z.Icon,{className:"mr-2",color:null===(o=null==m?void 0:m.sys.color)||void 0===o?void 0:o.primary.main,size:16,icon:null===(i=null==e?void 0:e.icon)||void 0===i?void 0:i.svg}),null==e?void 0:e.layer),v(e,h()))})))))}));const jo=function(){return s.Date.now()};var Ao=Math.max,Oo=Math.min;const Po=function(e,t,n){var r,o,i,a,s,l,u=0,c=!1,d=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function m(t){var n=r,i=o;return r=o=void 0,u=t,a=e.apply(i,n)}function h(e){var n=e-l;return void 0===l||n>=t||n<0||d&&e-u>=i}function v(){var e=jo();if(h(e))return y(e);s=setTimeout(v,function(e){var n=t-(e-l);return d?Oo(n,i-(e-u)):n}(e))}function y(e){return s=void 0,f&&r?m(e):(r=o=void 0,a)}function g(){var e=jo(),n=h(e);if(r=arguments,o=this,l=e,n){if(void 0===s)return function(e){return u=e,s=setTimeout(v,t),c?m(e):a}(l);if(d)return clearTimeout(s),s=setTimeout(v,t),m(l)}return void 0===s&&(s=setTimeout(v,t)),a}return t=M(t)||0,p(n)&&(c=!!n.leading,i=(d="maxWait"in n)?Ao(M(n.maxWait)||0,t):i,f="trailing"in n?!!n.trailing:f),g.cancel=function(){void 0!==s&&clearTimeout(s),u=0,r=l=o=s=void 0},g.flush=function(){return void 0===s?a:y(jo())},g},Co=n.React.memo((e=>{const{reset:t,widgetId:r,fieldName:o,fieldType:i,dataSource:a,isDataSourceReady:s,onChange:l,onAccept:u}=e,c=n.hooks.useTranslation(K),d=n.React.useRef(null),f=n.React.useRef((e=>{})),m=n.React.useRef(null),p=n.React.useRef(null),h=n.React.useRef(null),v=n.React.useRef(null),y=n.React.useRef(!1),g=n.React.useRef(!1),[b,I]=n.React.useState(null),[N,S]=n.React.useState(!1),[w,R]=n.React.useState([]);n.React.useEffect((()=>{I(null),D(null),setTimeout((()=>{m.current=null,v.current=null,p.current.select(),(0,n.focusElementInKeyboardMode)(p.current,!0),p.current.blur()}),200)}),[t]),n.React.useEffect((()=>{f.current=Po(k,400)}),[]);const F=n.React.useMemo((()=>a),[a]),k=n.hooks.useEventCallback((e=>{const t=ce(o,e,a);Promise.all([t]).then((e=>{const t=null==e?void 0:e[0];t&&R(t),m.current&&S(!0)})).catch((e=>null))})),D=e=>{re(m)&&""!==m.current&&""===e&&setTimeout((()=>{p.current.select(),(0,n.focusElementInKeyboardMode)(p.current,!0),p.current.blur()}),200)},T=e=>{m.current=e,I(e)},x=()=>{(0,n.focusElementInKeyboardMode)(p.current),E(!0,!1)},E=(e=!1,t=!0)=>{e||(g.current=!1)};return(0,n.jsx)("div",{className:"route-input"},(0,n.jsx)("div",{ref:d,className:"d-flex w-100"},(0,n.jsx)(z.TextInput,{"aria-label":c("routeIdLabel"),type:"text",className:"w-100",size:"sm",allowClear:!!b,disabled:!s,onBlur:()=>{h.current=setTimeout((()=>{y.current||S(!1),g.current||E(!1)}),200)},value:b||"",ref:p,onChange:e=>{var t;v.current=null;const n=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,r=(null==n?void 0:n.length)>2;if(D(n),T(n),l(n),!r)return S(!1),!1;f.current(n)},checkValidityOnAccept:e=>new Promise((t=>{setTimeout((()=>{v.current&&(e=v.current);const r=F,a={};i===n.JimuFieldType.Number?a.where=`${o} LIKE ${e}`:a.where=`LOWER(${o}) LIKE LOWER('${e}')`;const s=r.queryCount(a).then((t=>0===t.count&&e.length>0?(u(e,!1),{valid:!1,msg:c("invalidRouteField")}):(u(e,!0),{valid:!0}))).catch((t=>(u(e,!1),{valid:!1})));t(s)}),200)}))}),b&&(0,n.jsx)(Lo,{isOpen:(N||(y.current=!1),N),reference:d,searchText:b,searchSuggestion:w,onRecordItemClick:(e,t)=>{if(t)return x(),!1;v.current=e,T(e)},id:r,searchInputRef:p})))}));var Vo,_o,Uo,$o,Go,qo,Bo=c(68972);!function(e){e.EsriSuccess="esriSuccess",e.EsriReconcileRequired="esriReconcileRequired",e.EsriWrongReconcileVersion="esriWrongReconcileVersion",e.EsriConflictsDuringReconcile="esriConflictsDuringReconcile",e.EsriCouldNotAcquireAllLocks="esriCouldNotAcquireAllLocks",e.EsriActiveEditSessionOnVersion="esriActiveEditSessionOnVersion"}(Vo||(Vo={})),function(e){e.EsriSuccess="esriSuccess",e.EsriPostRequired="esriPostRequired",e.EsriWrongPostVersion="esriWrongPostVersion",e.EsriCouldNotReleaseAllLocks="esriCouldNotReleaseAllLocks",e.EsriCouldNotReleaseAllLocksPostRequired="esriCouldNotReleaseAllLocksPostRequired",e.EsriCouldNotReleaseAllLocksOwnedByOtherUsers="esriCouldNotReleaseAllLocksOwnedByOtherUsers",e.EsriCouldNotReleaseAllLocksActiveEditSession="esriCouldNotReleaseAllLocksActiveEditSession",e.EsriCouldNotReleaseAllLocksNeedToRunAebGpToolOnDefault="esriCouldNotReleaseAllLocksNeedToRunAebGpToolOnDefault"}(_o||(_o={})),function(e){e.No="no",e.Yes="yes",e.OnPost="onPost",e.Undefined="undefined"}(Uo||(Uo={})),function(e){e[e.Acquire=0]="Acquire",e[e.Release=1]="Release",e[e.Query=2]="Query",e[e.Locks=3]="Locks"}($o||($o={})),function(e){e[e.Reconcile=0]="Reconcile",e[e.Versions=1]="Versions",e[e.StartRead=2]="StartRead",e[e.StopRead=3]="StopRead",e[e.StartEdit=4]="StartEdit",e[e.StopEdit=5]="StopEdit"}(Go||(Go={})),function(e){e[e.Query=0]="Query",e[e.QueryAndAcquire=1]="QueryAndAcquire",e[e.QueryAndRelease=2]="QueryAndRelease",e[e.Acquire=3]="Acquire",e[e.Release=4]="Release",e[e.Clear=5]="Clear",e[e.None=6]="None"}(qo||(qo={}));var zo=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function Wo(e,t,r){return zo(this,void 0,void 0,(function*(){if(!ai(t,e,!1))return t;const o=ve(e.url);return function(e){return zo(this,void 0,void 0,(function*(){var t;const r=ni(e,$o.Locks),o={f:"json",token:null===(t=n.SessionManager.getInstance().getMainSession())||void 0===t?void 0:t.token};return yield Ge({method:"GET",url:r,params:o}).then((e=>{var t;return(null===(t=null==e?void 0:e.lrs[0])||void 0===t?void 0:t.lockTableFields)||null}))}))}(e.url).then((n=>function(e,t,n,r,o){return zo(this,void 0,void 0,(function*(){const i=ni(e.url,$o.Query);let a=`${n.routeIdFieldName} IN ('${t.routeOrLineId.join("','")}')`;a+=` AND ${n.networkIdFieldName} IN (${t.networkId.toString()})`;return Ge({method:"GET",url:i,params:{f:"json",token:r.token,where:a,returnReleasableStatus:o}}).then((e=>e))}))}(e,t,n,o,r).then((e=>re(e)?(t.details=e.locks,t):(t.details=[],t)))))}))}function Ho(e,t){return zo(this,void 0,void 0,(function*(){const n={acquireStatus:Vo.EsriCouldNotAcquireAllLocks,acquiredLocks:[],unavailableLocks:[]};if(!ai(t,e,!0))return n;const r=ve(e.url),o=ye(e),i=ni(e.url,$o.Acquire),a=[];t.eventServiceLayerIds.forEach(((e,n)=>{t.isLine[n]?a.push({lineId:t.routeOrLineId[n],layerId:e}):a.push({routeId:t.routeOrLineId[n],layerId:e})}));return Ge({method:"GET",url:i,params:{f:"json",token:r.token,editVersion:o,acquireLocks:a}}).then((e=>e))}))}function Qo(e,t){return zo(this,void 0,void 0,(function*(){if(!ai(t,e,!0))return!1;if(ge(ye(e))){return(yield Jo(e,t)).releaseStatus===_o.EsriSuccess}}))}function Ko(e,t,n){return zo(this,void 0,void 0,(function*(){if(!re(t)||!re(n))return!1;const r=ve(e.url),o=ye(e);if(t.user===r.username&&t.versionName===o&&n.eventServiceLayerIds.includes(t.layerId))return!0;if(t.releasableStatus===Uo.Yes){const r={routeOrLineId:[t.routeId],eventServiceLayerIds:[t.layerId],isLine:[n.isLine[0]],networkId:[t.lrsNetworkId],status:n.status,details:[],routeInfo:n.routeInfo,lockAction:n.lockAction};return(yield Jo(e,r)).releaseStatus===_o.EsriSuccess}}))}function Jo(e,t){return zo(this,void 0,void 0,(function*(){if(!ai(t,e,!0))return null;const n=ni(e.url,$o.Release),r=ve(e.url),o=[];t.eventServiceLayerIds.forEach(((e,n)=>{t.isLine[n]?o.push({lineId:t.routeOrLineId[n],layerId:e}):o.push({routeId:t.routeOrLineId[n],layerId:e})}));return Ge({method:"GET",url:n,params:{f:"json",token:r.token,releaseLocks:o}}).then((e=>e))}))}function Yo(e){return zo(this,void 0,void 0,(function*(){const t=ve(e.url),r=yield Zo(e.url,ye(e));if(!re(r)||""===r)return!1;const o=r.replace("{","").replace("}",""),i=ri(e.url,Go.Reconcile,o);let a="{"+n.utils.getUUID()+"}";a=a.replace(/[_]/g,"-");const s={token:t.token,sessionId:a,abortIfConflicts:!0,conflictDetection:"byAttribute",withPost:!0,saveEdits:!0},l=ri(e.url,Go.StartRead,o),u=ri(e.url,Go.StartEdit,o),c=ri(e.url,Go.StopRead,o),d=ri(e.url,Go.StopEdit,o);let f=!1;return yield Ge({method:"POST",url:l,params:s}).then((e=>zo(this,void 0,void 0,(function*(){e.success&&(yield Ge({method:"POST",url:u,params:s}).then((e=>zo(this,void 0,void 0,(function*(){e.success&&(yield Ge({method:"POST",url:i,params:s}).then((e=>zo(this,void 0,void 0,(function*(){e.success&&(f=!0,yield Ge({method:"POST",url:d,params:s}).then((e=>zo(this,void 0,void 0,(function*(){e.success&&(yield Ge({method:"POST",url:c,params:s}).then((e=>null)))})))))})))))})))))})))),f}))}function Zo(e,t){return zo(this,void 0,void 0,(function*(){if(ge(t))return"";const n=ri(e,Go.Versions),r={f:"json",token:ve(e).token};return yield Ge({method:"GET",url:n,params:r}).then((e=>{let n="";return e.versions.forEach((e=>{e.versionName===t&&(n=e.versionGuid)})),n}))}))}function Xo(){return{routeInfo:null,networkId:[],routeOrLineId:[],eventServiceLayerIds:[],isLine:[],status:Vo.EsriSuccess,details:[],lockAction:qo.None}}function ei(e){return""!==e.routeId||""!==e.lineId}function ti(e,t){if(0===t.details.length)return!0;const n=ve(e.url),r=t.details.filter((e=>e.user===n.username));if(0===r.length)return!0;const o=ye(e),i=r.filter((e=>e.versionName===o));if(0===i.length)return!0;const a=Object.assign([],t.eventServiceLayerIds);for(let e=0;e<i.length;e++){if(""===i[e].eventFeatureClassName)return!1;re(a)&&a.includes(i[e].layerId)&&a.splice(a.indexOf(i[e].layerId),1)}return!re(a)||0!==a.length}function ni(e,t){let n=oi(e);if(""===n)return"";switch(n+="MapServer/exts/LRServer/",t){case $o.Acquire:n+="Locks/acquire";break;case $o.Release:n+="Locks/release";break;case $o.Query:n+="Locks/query";break;case $o.Locks:n+="locks"}return n}function ri(e,t,n){let r=oi(e);if(""===r)return"";switch(r+="VersionManagementServer/",t){case Go.Reconcile:r+=`versions/${n}/reconcile`;break;case Go.Versions:r+="versions";break;case Go.StartRead:r+=`versions/${n}/startReading`;break;case Go.StopRead:r+=`versions/${n}/stopReading`;break;case Go.StartEdit:r+=`versions/${n}/startEditing`;break;case Go.StopEdit:r+=`versions/${n}/stopEditing`}return r}function oi(e){return e.includes("MapServer")?e.substring(0,e.lastIndexOf("MapServer")):e.includes("FeatureServer")?e.substring(0,e.lastIndexOf("FeatureServer")):""}function ii(e){return zo(this,void 0,void 0,(function*(){var t;const r=ni(e,$o.Locks),o={f:"json",token:null===(t=n.SessionManager.getInstance().getMainSession())||void 0===t?void 0:t.token};return yield Ge({method:"GET",url:r,params:o}).then((e=>{var t;return(null===(t=null==e?void 0:e.lrs)||void 0===t?void 0:t[0].conflictPreventionEnabled)||!1}))}))}function ai(e,t,n){return!(!re(e)||!re(t))&&!(n&&!function(e){return e.eventServiceLayerIds.length===e.routeOrLineId.length&&e.eventServiceLayerIds.length===e.isLine.length}(e))}var si=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};class li extends Bo.default.PureComponent{constructor(e){super(e),this.state={lockInfo:null,toastMsg:"",toastMsgType:"warning",toastOpen:!1}}componentDidUpdate(e){return si(this,void 0,void 0,(function*(){if(this.props.conflictPreventionEnabled){if(this.hasNullProps())return void this.clearMessage();if(!this.didChange(e))return void this.clearMessage();if(this.doAction())switch(this.props.lockInfo.lockAction){case qo.Acquire:yield this.doAcquireLock();break;case qo.QueryAndAcquire:yield this.doQueryAndAcquireLock();break;case qo.QueryAndRelease:yield this.doQueryAndReleaseLock();break;case qo.Query:yield this.doQueryLock();break;case qo.Release:yield this.doReleaseLock();break;case qo.Clear:this.clearMessage();case qo.None:}else this.clearMessage()}}))}clearMessage(){re(this.props.lockInfo)&&this.props.lockInfo.lockAction===qo.Clear&&(this.setState({toastMsg:"",toastMsgType:"info",toastOpen:!1}),this.props.onMessageClear&&this.props.onMessageClear())}shouldClearMessageState(){return""===this.state.toastMsg||!(!re(this.props.lockInfo)||!re(this.state.lockInfo)||this.props.lockInfo.routeOrLineId===this.state.lockInfo.routeOrLineId||this.props.lockInfo.networkId===this.state.lockInfo.networkId||this.props.lockInfo.eventServiceLayerIds===this.state.lockInfo.eventServiceLayerIds)}hasNullProps(){var e;return!re(this.props.lockInfo)||(!re(null===(e=this.props.lockInfo)||void 0===e?void 0:e.routeInfo)||!re(this.props.featureDS))}didChange(e){return!(re(e.lockInfo)||!re(this.props.lockInfo))||(e.lockInfo.networkId.toString()!==this.props.lockInfo.networkId.toString()||(e.lockInfo.eventServiceLayerIds.toString()!==this.props.lockInfo.eventServiceLayerIds.toString()||(!(re(e.featureDS)||!re(this.props.featureDS))||(!(!re(e.featureDS)||!re(this.props.featureDS)||e.featureDS.id===this.props.featureDS.id)||(!(re(e.lockInfo.routeInfo)||!re(this.props.lockInfo.routeInfo))||(e.lockInfo.routeInfo.routeId!==this.props.lockInfo.routeInfo.routeId||(e.lockInfo.routeInfo.lineId!==this.props.lockInfo.routeInfo.lineId||e.lockInfo.lockAction!==this.props.lockInfo.lockAction)))))))}doAction(){return!!re(this.props.lockInfo.routeInfo)&&(!(!re(this.props.lockInfo.routeInfo.routeId)||""===this.props.lockInfo.routeInfo.routeId)&&(!(!re(this.props.lockInfo.networkId)||0===this.props.lockInfo.networkId.length)&&(!(!re(this.props.lockInfo.eventServiceLayerIds)||0===this.props.lockInfo.eventServiceLayerIds.length)&&!!re(this.props.featureDS))))}doQueryLock(){return si(this,void 0,void 0,(function*(){const e=this.createLockInfoFromParams(),t=yield Wo(this.props.featureDS,e,!0);this.setState({lockInfo:e}),this.props.onQueryComplete&&this.props.onQueryComplete(t,!0)}))}doQueryAndAcquireLock(){return si(this,void 0,void 0,(function*(){const e=this.createLockInfoFromParams(),t=yield Wo(this.props.featureDS,e,!1);if(ti(this.props.featureDS,t)){let n=yield Ho(this.props.featureDS,t);if(n.acquireStatus===Vo.EsriReconcileRequired){(yield Yo(this.props.featureDS))&&(n=yield Ho(this.props.featureDS,t))}this.props.showAlert&&this.setAlert(n,t,!0),this.setState({lockInfo:e}),this.props.onQueryAndAcquireComplete&&(n.acquireStatus===Vo.EsriSuccess?this.props.onQueryAndAcquireComplete(t,n,!0):this.props.onQueryAndAcquireComplete(t,n,!1))}else this.shouldClearMessageState()&&this.setState({toastMsg:"",toastMsgType:"info",toastOpen:!1}),this.setState({lockInfo:e}),this.props.onQueryAndAcquireComplete&&this.props.onQueryAndAcquireComplete(t,null,!0)}))}doQueryAndReleaseLock(){return si(this,void 0,void 0,(function*(){const e=this.createLockInfoFromParams(),t=yield Wo(this.props.featureDS,e,!0);for(let n=0;n<t.details.length;n++)yield Ko(this.props.featureDS,t.details[n],e);this.setState({lockInfo:e}),this.props.onQueryAndReleaseComplete&&this.props.onQueryAndReleaseComplete(t,!0)}))}doAcquireLock(){return si(this,void 0,void 0,(function*(){const e=this.createLockInfoFromParams();let t=yield Ho(this.props.featureDS,e);if(t.acquireStatus===Vo.EsriReconcileRequired){(yield Yo(this.props.featureDS))&&(t=yield Ho(this.props.featureDS,e))}this.props.showAlert&&this.setAlert(t,e,!0),this.setState({lockInfo:e}),this.props.onAcquireComplete&&(t.acquireStatus===Vo.EsriSuccess?this.props.onAcquireComplete(t,!0):this.props.onAcquireComplete(t,!1))}))}doReleaseLock(){return si(this,void 0,void 0,(function*(){const e=this.createLockInfoFromParams(),t=yield Jo(this.props.featureDS,e);this.setState({lockInfo:e}),this.props.onReleaseComplete&&(t.releaseStatus===_o.EsriSuccess?this.props.onReleaseComplete(t,!0):this.props.onReleaseComplete(t,!1))}))}createLockInfoFromParams(){const e=[],t=[];this.props.lockInfo.eventServiceLayerIds.forEach(((n,r)=>{const o=""!==this.props.lockInfo.routeInfo.lineId&&re(this.props.lockInfo.routeInfo.lineId);e.push(o?this.props.lockInfo.routeInfo.lineId:this.props.lockInfo.routeInfo.routeId),t.push(o)}));return{networkId:this.props.lockInfo.networkId,routeOrLineId:e,eventServiceLayerIds:this.props.lockInfo.eventServiceLayerIds,isLine:t,status:Vo.EsriSuccess,details:[],routeInfo:this.props.lockInfo.routeInfo,lockAction:qo.None}}getNameOrId(e){return""!==e.lineId&&""===e.lineName?e.lineId:""!==e.lineId&&""!==e.lineName?e.lineName:""!==e.routeName?e.routeName:e.routeId}getNameOrIdFromUnavailableLock(e){return re(e.routeName)&&""!==e.routeName?e.routeName:re(e.lineName)&&""!==e.lineName?e.lineName:re(e.routeId)&&""!==e.routeId?e.routeId:re(e.lineId)&&""!==e.lineId?e.lineId:void 0}setAlert(e,t,n){var r;let o="",i="info",a="";const s=(null===(r=null==t?void 0:t.details[0])||void 0===r?void 0:r.lrsNetworkName)||this.props.networkName,l=ye(this.props.featureDS);switch(e.acquireStatus){case Vo.EsriSuccess:a=this.getNameOrId(this.props.lockInfo.routeInfo),o=""!==this.props.lockInfo.routeInfo.lineId?Z(this.props.intl,"YouAcquiredLockOnLine",{nameOrId:a,networkName:s,version:l}):Z(this.props.intl,"YouAcquiredLockOnRoute",{nameOrId:a,networkName:s,version:l}),i="info";break;case Vo.EsriReconcileRequired:o=Z(this.props.intl,"ReconcileRequired"),i="error";break;case Vo.EsriCouldNotAcquireAllLocks:const t=e.unavailableLocks[0].versionName,r=e.unavailableLocks[0].user;a=this.getNameOrIdFromUnavailableLock(e.unavailableLocks[0]),o=""===t?""!==this.props.lockInfo.routeInfo.lineId?Z(this.props.intl,"UnavailableLockOnLineWithoutVersion",{nameOrId:a,networkName:s,lockUser:r}):Z(this.props.intl,"UnavailableLockOnRouteWithoutVersion",{nameOrId:a,networkName:s,lockUser:r}):""!==this.props.lockInfo.routeInfo.lineId?Z(this.props.intl,"UnavailableLockOnLine",{nameOrId:a,networkName:s,lockUser:r,version:t}):Z(this.props.intl,"UnavailableLockOnRoute",{nameOrId:a,networkName:s,lockUser:r,version:t}),i="error";break;default:o="",i="info",n=!1}this.setState({toastMsg:o,toastMsgType:i,toastOpen:n})}render(){const{conflictPreventionEnabled:e}=this.props;return e&&re(this.props.lockInfo)&&re(this.props.lockInfo.routeInfo)&&re(this.props.featureDS)&&this.props.showAlert&&""!==this.state.toastMsg?Bo.default.createElement(z.Alert,{className:"lock-manager-alert w-100",size:"small",type:this.state.toastMsgType,text:this.state.toastMsg,closable:!0,withIcon:!0,open:this.state.toastOpen,onClose:()=>{this.setState({toastOpen:!1})}}):null}}var ui=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function ci(e){const{disabled:t,networkDs:r,eventDataSources:i,jimuMapView:a,hoverGraphic:s,onAttributesCopied:l}=e,u=n.hooks.useTranslation(K),c=n.React.useRef(null),d=n.React.useRef(null),[f,m]=n.React.useState(null),p=n.React.useRef(!1),h=n.React.useRef(!1),[v,y]=n.React.useState(!1),[g,b]=n.React.useState();n.React.useEffect((()=>{if(re(r)){const e=r;re(null==e?void 0:e.layer)&&m(null==e?void 0:e.layer)}re(null==a?void 0:a.view)&&b(null==a?void 0:a.view.popupEnabled)}),[null==a?void 0:a.view,r]),n.React.useEffect((()=>{v?I():N()}),[v]);const I=()=>{c.current=null==a?void 0:a.view.on("pointer-move",F),d.current=null==a?void 0:a.view.on("pointer-down",k)},N=()=>{re(c.current)&&(c.current.remove(),c.current=null),re(d.current)&&(d.current.remove(),d.current=null),h.current&&(h.current=!1),p.current&&(p.current=!1)},S=()=>{re(s)&&s.removeAll()},w=e=>{S(),re(e)&&s.add(e)},R=(e,t)=>{const n=t.spatialReference,r=t.createQuery(),o="degrees"===n.unit?4:Math.max(3*n.metersPerUnit,3);return r.geometry=e,r.units="meters",r.returnGeometry=!0,r.returnM=!0,r.returnZ=!0,r.distance=(null==a?void 0:a.view.resolution)*o,r.spatialRelationship="intersects",r},F=e=>{re(f)&&!p.current&&(0,o.loadArcGISJSAPIModules)(["esri/geometry/operators/proximityOperator","esri/TimeExtent"]).then((t=>{let n=null,o=null;[n,o]=t,p.current=!0;const i=r.getCurrentQueryParams(),s=null==a?void 0:a.view.toMap(e),l=R(s,f);l.outFields=[],(null==i?void 0:i.time)&&(l.timeExtent=new o({start:i.time[0],end:i.time[1]})),l.gdbVersion=i.gdbVersion,f.queryFeatures(l).then((e=>ui(this,void 0,void 0,(function*(){if(e.features.length>0){const t=e.features[0].geometry,r=n.getNearestCoordinate(t,s),o=n.getNearestVertex(t,s);o.distance<3*l.distance&&(r.coordinate=o.coordinate),w(yield Pe(yield _e(r.coordinate))),p.current=!1}p.current&&(w(null),p.current=!1)}))))}))},k=e=>(re(f)&&!h.current&&(e.stopPropagation(),(0,o.loadArcGISJSAPIModules)(["esri/TimeExtent"]).then((t=>ui(this,void 0,void 0,(function*(){let n=null;[n]=t,a.view.popupEnabled=!1,h.current=!0;const r=null==a?void 0:a.view.toMap(e),o=[];yield Promise.all(i.map((e=>ui(this,void 0,void 0,(function*(){const t=e,i=R(r,null==t?void 0:t.layer);i.outFields=["*"];const a=t.getCurrentQueryParams();(null==a?void 0:a.time)&&(i.timeExtent=new n({start:a.time[0],end:a.time[1]})),i.gdbVersion=a.gdbVersion;const s=yield null==t?void 0:t.layer.queryFeatures(i).then((e=>{const t=[];if(e.features.length>0){const n=e.features[0].attributes;for(const e in n){const r={name:e,value:n[e]};t.push(r)}}return t})),l={layerId:t.layerId,fieldValuePair:s};o.push(l)}))))).then((()=>{o.length>0&&l(o)})).finally((()=>{D()})).catch((()=>{D()}))}))))),Promise.resolve()),D=()=>{y(!1),N(),h.current=!1,setTimeout((()=>{a.view.popupEnabled=g,a.clearSelectedFeatures()}),800),S()};return(0,n.jsx)(z.Tooltip,{title:u("copyAttributes")},(0,n.jsx)(B.CalciteButton,{scale:"s",css:Te(),iconStart:"eyedropper",appearance:v?"solid":"outline",kind:"brand",disabled:!!t||void 0,tabIndex:-1,onClick:()=>{y(!v)}}))}var di=c(48993),fi=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function mi(e,t,n,r,i){return fi(this,void 0,void 0,(function*(){const a=(yield(0,o.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer"]))[0],s=i+r.id,l=r.view.map.findLayerById(s);re(l)&&r.view.map.remove(l);const u=new a({id:s,listMode:n,legendEnabled:!1,title:s,geometryType:t,source:[],objectIdField:"OBJECTID",elevationInfo:{mode:di.DrawingElevationMode3D.RelativeToGround},hasZ:!0,hasM:!0,popupEnabled:!1,popupTemplate:null,outFields:["*"],labelsVisible:!1,spatialReference:r.view.spatialReference,screenSizePerspectiveEnabled:!1,fields:e});return r.view.map.add(u),u}))}function pi(e){return fi(this,void 0,void 0,(function*(){const t=n.DataSourceManager.getInstance().getDataSource(e.dataSourceId);if(re(t)){const e=t;return(null==e?void 0:e.layer)||(yield e.createJSAPILayerByDataSource())}return null}))}function hi(e,t){const n=e.find((e=>e.type===t));return re(n)?n.clone():null}function vi(e,t){const n=e.find((e=>e.name===t));return re(n)?n.clone():null}function yi(e,t){let n=t.replace(/[^a-zA-Z0-9_]+/g,""),r=0,o=!0;for(;o;){const i=n.toUpperCase();o=e.includes(i),o&&(r++,n=t.replace(/[^a-zA-Z0-9_]+/g,"")+"_"+r.toString())}return n}function gi(e,t){return e.filter((e=>t.includes(e.name)))}function bi(){return["SHAPE_LENGTH","SHAPE_LEN","SHAPELENGTH","SHAPELEN","SHAPE__LENGTH","SHAPE__LENGTH__","SE_LENGTH","ST_LENGTH","STLENGTH","DB2GSEST_LENGTH","DB2GSESDELENGTH","SDELENGTH","SHAPESTLENGTH","SDO_GEOMSDO_LENGTH"]}function Ii(e,t,n,r){return fi(this,void 0,void 0,(function*(){const i=new(0,(yield(0,o.loadArcGISJSAPIModules)(["esri/layers/support/Field"]))[0]);return i.name=e,i.alias=t,i.type=n,i.editable=r,i.defaultValue=null,i}))}var Ni=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function Si(e){return Ni(this,void 0,void 0,(function*(){return new Promise((function(t,r){const o={params:e.params,httpMethod:e.method};n.esri.restRequest.request(e.url,o).then((e=>{t(e)})).catch((e=>{t(e)}))}))}))}function wi(e){return Ni(this,void 0,void 0,(function*(){if(!e)return[];const t=e.url,r=e.layerId,o=n.SessionManager.getInstance().getSessionByUrl(t),i=o&&o.token?o.token:"";return Si({method:"POST",url:`${t}/queryDataElements`,params:{f:"json",layers:JSON.stringify([r]),token:i}}).then((e=>{var t,n;return null!==(n=null===(t=e.layerDataElements)||void 0===t?void 0:t[0].dataElement.fieldGroups)&&void 0!==n?n:[]}))}))}function Ri(e){return Ni(this,void 0,void 0,(function*(){if(!e)return[];const t=e.url,r=e.layerId,o=n.SessionManager.getInstance().getSessionByUrl(t),i=o&&o.token?o.token:"";return Si({method:"POST",url:t+"/queryContingentValues",params:{f:"json",layers:JSON.stringify([r]),token:i}}).then((e=>e))}))}function Fi(e,t,n,r,o,i,a){const s={};if(re(r))if(-1===e&&-1===n)r.forEach((e=>{s[e.name]=e.value}));else{const t=r[n];r.forEach((n=>{s[n.name]=n.value,n.name===t.name&&(s[n.name]=e)}))}else a.forEach((e=>{const t=i.attributes[e.name],n=e.alias.split(".")[1];s[n]=t}));const l=[];for(const e of o){const t=e.isEditingRestrictive?"error":"warning";let n=!1;const r=e.contingencies.filter((e=>!e.isRetired));if(!r||0===r.length)return[];for(const e of r){let t=!0;for(const n in e.values){const r=e.values[n];if("any"!==r.objectType)if("null"===r.objectType){if(null!=s[n]){t=!1;break}}else if("code"===r.objectType){if(null!=r.codedValue&&s[n]!==r.codedValue.code){t=!1;break}}else if("range"===r.objectType){const e=s[n];if(null!=r.minValue&&null!=r.maxValue&&(e<r.minValue||e>r.maxValue)){t=!1;break}}}if(t){n=!0;break}}n||l.push({fieldGroup:e,type:t})}return l}function ki(e,t,n){const r=e&&!Number.isNaN(e)?function(e,t){const n=e.domains;if(n)return n[t]||null;return null}(e,t):n.getFieldDomain(t);return"inherited"===(null==r?void 0:r.type)?n.getFieldDomain(t):r}function Di(e){return null!=e&&("string"===e.type||"esriFieldTypeString"===e.type)}function Ti(e){return null!=e&&("date"===e.type||"esriFieldTypeDate"===e.type)}function xi(e,t,n,r){const o=null==e?void 0:e.contingentValueSets;if(!o)return[];const i=null==o?void 0:o[0].fieldGroups;if(!i||0===(null==i?void 0:i.length))return[];return t.map((e=>{const t=i.find((t=>t.name===e.name));if(t){const i=t.contingencies.map((t=>{var i;const a=t.id,s=t.isRetired||!1,l=function(e,t){const n=null==t?void 0:t.sourceJSON;let r;n.subtypes&&(r=n.subtypes.find((t=>t.code===e)));return r||null}(t.subtypeCode,n);if(Number.isNaN(r)||(null==l?void 0:l.code)===r){const r={};for(let a=0;a<e.fields.length;a++){const s=e.fields[a];let u=t.values[a];if("number"==typeof u||"string"==typeof u){const e=ki(l,s,n),t=n.getField(s);if(Di(t))u=o[0].stringDictionary[u];else if(Ti(t)){const e=new Date(`${u}+00:00`);u=e.getTime()}const a={codedValue:null===(i=null==e?void 0:e.codedValues)||void 0===i?void 0:i.find((e=>e.code===u)),objectType:"code"};r[s]=a}else if("object"==typeof u){const e={minValue:u.minValue,maxValue:u.maxValue,objectType:"range"};r[s]=e}else if(u){const e={objectType:"any"};r[s]=e}else{const e={objectType:"null"};r[s]=e}}return{id:a,isRetired:s,subtype:l,values:r}}return null})),a=[];return null==i||i.forEach((e=>{null!==e&&a.push(e)})),{name:e.name,isEditingRestrictive:e.isEditingRestrictive,fields:e.fields,contingencies:a}}return[]}))}function Ei(e){if(null==e)return null;const t=e.trim();let n="";for(let e=0;e<t.length;e++){const r=t.charCodeAt(e);n+=r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||95===r||r>=128&&r<=65535?t[e]:"_"}return(n[0]>="0"&&n[0]<="9"||"_"===n[0])&&(n="F"+n),n||null}const Mi=e=>{const t=[];if(null==e||0===(null==e?void 0:e.length))return[];for(const n of e){const e=[],{contingencies:r,fields:o,name:i}=n;for(const t of r)t.isRetired||e.push({values:t.values});e.length>0&&t.push({name:i,fields:o,contingencies:e})}return t};function Li(e,t){const n=new Map;if(!re(t))return[...n.values()];const r=Mi(t).slice();if(r)for(const t of r){const r=null==t?void 0:t.contingencies;for(const t of r){const r=null==t?void 0:t.values[e];if("code"===(null==r?void 0:r.objectType)||"null"===(null==r?void 0:r.objectType)){const{code:e,name:t}=r.codedValue&&"null"!==r.objectType?r.codedValue:{code:"",name:"No value"};n.has(e)||n.set(e,{name:t,code:e})}}}return[...n.values()]}function ji(e){if(!e)return new Set;const t=e.flatMap((e=>e.fields));return new Set(t)}var Ai=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function Oi(e,t){const n=t+e.id,r=e.view.map.findLayerById(n);re(r)&&e.view.map.remove(r)}function Pi(e,t,r,o,i,a){return Ai(this,void 0,void 0,(function*(){const s=(yield(0,n.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer"]))[0],l=o+t.id,u=t.view.map.findLayerById(l);re(u)&&t.view.map.remove(u);const c={type:"text",color:i||[0,0,0],haloColor:[255,255,255,.8],haloSize:1,font:{size:a||12}},d=new s({id:l,listMode:"hide",legendEnabled:!1,title:l,geometryType:"point",source:[],objectIdField:"OBJECTID",elevationInfo:{mode:di.DrawingElevationMode3D.RelativeToGround},hasZ:!0,hasM:!0,popupEnabled:!1,popupTemplate:null,outFields:["*"],labelsVisible:!0,screenSizePerspectiveEnabled:!1,fields:e,labelingInfo:[{labelExpressionInfo:{expression:r},symbol:c}]});return t.view.map.add(d),d}))}function Ci(e){return Ai(this,void 0,void 0,(function*(){if(!e||!(null==e?void 0:e.paths)||0===e.paths.length)return null;const t=yield(0,n.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/operators/lengthOperator"]),r=t[0],o=t[1].execute(e)/2;if(0<e.paths.length){const t=e.paths[0];let n,i,a,s,l,u,c,d,f,m=0;if(0===o)return e.getPoint(0,0);if(o>0)for(let p=1;p<t.length;p++){if(n=t[p-1][0],s=t[p-1][1],i=t[p][0],l=t[p][1],c=Vi(n,s,i,l),m+=c,m===o)return e.getPoint(0,p);if(m>o)return d=c-(m-o),f=Math.atan2(l-s,i-n),a=d*Math.cos(f),u=d*Math.sin(f),new r({x:n+a,y:s+u,spatialReference:{wkid:e.spatialReference.wkid}})}}return null}))}function Vi(e,t,n,r){return Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2))}var _i,Ui,$i=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function Gi(e,t,n,r){return $i(this,void 0,void 0,(function*(){const o=ie(t),i=t.useRouteName?r.attributes[o.routeNameFieldName]:"",a=r.attributes[o.routeIdFieldName],s=r.attributes[o.fromDateFieldName],l=r.attributes[o.toDateFieldName],u=r.geometry,c=r.attributes[o.lineIdFieldName],d=r.attributes[o.lineNameFieldName];let f=new Date(Date.now());re(l)&&f>l?f=Fe(s,n):f.setHours(0,0,0,0);let m=new Date(Date.now());if(re(l)&&m>l?m=Fe(l,n):m.setHours(0,0,0,0),re(l)||(m=null),!re(u))return Object.assign(Object.assign({},e),{routeName:i,routeId:a,fromDate:re(s)?Fe(s,n):null,toDate:re(l)?Fe(l,n):null,selectedPolyline:null,fromMeasure:null,toMeasure:null,validRoute:!1,selectedFromDate:f,selectedToDate:m,lineName:d,lineId:c});const p=oe(u);try{return yield He(n,t,p,s,a).then((r=>{const o=Math.min(...r),p=Math.max(...r);return Object.assign(Object.assign({},e),{routeName:i,routeId:a,fromDate:re(s)?Fe(s,n):null,toDate:re(l)?Fe(l,n):null,selectedPolyline:u,fromMeasure:q(o,t.measurePrecision),toMeasure:q(p,t.measurePrecision),validRoute:!0,selectedFromDate:f,selectedToDate:m,lineName:d,lineId:c})}))}catch(t){return Object.assign(Object.assign({},e),{routeName:i,routeId:a,fromDate:re(s)?Fe(s,n):null,toDate:re(l)?Fe(l,n):null,selectedPolyline:u,fromMeasure:null,toMeasure:null,validRoute:!1,selectedFromDate:f,selectedToDate:m,lineName:d,lineId:c})}}))}function qi(e,t,n){return $i(this,void 0,void 0,(function*(){let r=null;const o=t.networkInfo.useRouteName?e.routeName:e.routeId,i={fromMeasure:null,toRouteToMeasure:null};if(!o||0===o.trim().length)return i;const a=ie(t.networkInfo),s=a.fromDateFieldName,l=a.toDateFieldName;return re(t.networkInfo)&&(yield ue(o.trim(),t.networkInfo,n,!1,!0,"",e.fromDate).then((o=>$i(this,void 0,void 0,(function*(){if(re(o)&&(yield Promise.all(o.features.map((t=>{var n,o,i,a;const u=null===(n=null==t?void 0:t.attributes)||void 0===n?void 0:n[s],c=null===(o=null==t?void 0:t.attributes)||void 0===o?void 0:o[l],d=null===(i=e.fromDate)||void 0===i?void 0:i.getTime(),f=null===(a=e.toDate)||void 0===a?void 0:a.getTime();return u===d&&(c&&f&&c===f?r=t.geometry:c||e.toDate||(r=t.geometry)),t}))),re(r))){const o=oe(r);if(re(o)){const r=yield He(n,t.networkInfo,o,e.fromDate,e.routeId),a=Math.min(...r),s=Math.max(...r);i.fromMeasure=q(a,t.networkInfo.measurePrecision),i.toRouteToMeasure=q(s,t.networkInfo.measurePrecision)}}})))).catch((()=>i))),i}))}!function(e){e.network="NETWORK",e.event="EVENT",e.intersection="INTERSECTION",e.nonLrs="NONLRS"}(_i||(_i={})),function(e){e.Measure="ROUTEANDMEASURE",e.Coordinate="COORDINATE",e.LocationOffset="LOCATIONOFFSET",e.Referent="REFERENT",e.LineAndMeasure="LINEANDMEASURE"}(Ui||(Ui={}));var Bi=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function zi(e){var t,r,o,i,a;let s=[];if(!e)return s;const l=(null===(t=null===window||void 0===window?void 0:window.jimuConfig)||void 0===t?void 0:t.isBuilder)?null===(o=null===(r=(0,n.getAppStore)().getState())||void 0===r?void 0:r.appStateInBuilder)||void 0===o?void 0:o.appConfig:null===(i=(0,n.getAppStore)().getState())||void 0===i?void 0:i.appConfig;if(!l)return s;const u=null===(a=l.widgets[e])||void 0===a?void 0:a.useDataSources;if(void 0!==u){u.map((e=>e.dataSourceId)).forEach((e=>{const t=n.DataSourceManager.getInstance().getDataSource(e),r=null==t?void 0:t.getDataSourcesByType(n.DataSourceTypes.FeatureLayer);r&&(s=s.concat(r))}))}return s}function Wi(e){let t=e;if(t.includes("FeatureServer"))t=t.substring(0,t.indexOf("FeatureServer"));else{if(!t.includes("MapServer"))return"";t=t.substring(0,t.indexOf("MapServer"))}return t+"MapServer/exts/LRServer"}function Hi(e){const t=zi(e),n=[];return t.forEach((e=>{var t;const r=Wi(null===(t=null==e?void 0:e.getDataSourceJson())||void 0===t?void 0:t.url);n.includes(r)||n.push(r)})),n}function Qi(e,t,n){const r={},o=(null==n?void 0:n.fields)?Object.values(null==n?void 0:n.fields):[];r.networkUrl=t,r.datasetName=e.datasetName;const i=e.routeIdFieldName;r.routeIdFieldSchema=o.find((e=>i===e.name));const a=e.routeNameFieldName;r.routeNameFieldSchema=o.find((e=>a===e.name));const s=e.fromDateFieldName;r.fromDateFieldSchema=o.find((e=>s===e.name));const l=e.toDateFieldName;if(r.toDateFieldSchema=o.find((e=>l===e.name)),r.supportsLines=e.supportsLines,r.supportsLines){const t=null==e?void 0:e.lineIdFieldName;r.lineIdFieldSchema=o.find((e=>t===e.name));const n=null==e?void 0:e.lineNameFieldName;r.lineNameFieldSchema=o.find((e=>n===e.name));const i=null==e?void 0:e.lineOrderFieldName;r.lineOrderFieldSchema=o.find((e=>i===e.name))}r.useRouteName=e.supportsLines,re(a)&&i.length&&(r.useRouteName=!0),r.measurePrecision=e.measurePrecision,r.unitsOfMeasure=e.unitsOfMeasure,r.mTolerance=e.spatialReferenceInfo.mTolerance,r.xyTolerance=e.spatialReferenceInfo.xyTolerance,r.lrsNetworkId=e.lrsNetworkId;const u=[],c=e.eventLayers;c&&c.length>0&&c.forEach((e=>{u.push(e.name)})),r.eventLayers=u;const d=[],f=e.intersectionLayers;return f&&f.length>0&&f.forEach((e=>{d.push(e.name)})),r.intersectionLayers=d,r}function Ki(e,t,n,r){const o={},i=(null==n?void 0:n.fields)?Object.values(null==n?void 0:n.fields):[];o.datasetName=e.datasetName,o.eventUrl=t,o.fromDateFieldName=e.fromDateFieldName,o.toDateFieldName=e.toDateFieldName,o.derivedFromMeasureFieldName=e.derivedFromMeasureFieldName,o.derivedRouteIdFieldName=e.derivedRouteIdFieldName,o.derivedRouteNameFieldName=e.derivedRouteNameFieldName,o.derivedToMeasureFieldName=e.derivedToMeasureFieldName,o.fromReferentLocationFieldName=e.fromReferentLocationFieldName,o.fromReferentMethodFieldName=e.fromReferentMethodFieldName,o.fromReferentOffsetFieldName=e.fromReferentOffsetFieldName,o.toReferentLocationFieldName=e.toReferentLocationFieldName,o.toReferentMethodFieldName=e.toReferentMethodFieldName,o.toReferentOffsetFieldName=e.toReferentOffsetFieldName,o.locErrorFieldName=e.locErrorFieldName,o.eventIdFieldName=e.eventIdFieldName,o.routeIdFieldName=e.routeIdFieldName,o.routeNameFieldName=e.routeNameFieldName,o.fromMeasureFieldName=e.fromMeasureFieldName,o.toRouteIdFieldName=e.toRouteIdFieldName,o.toRouteNameFieldName=e.toRouteNameFieldName,o.toMeasureFieldName=e.toMeasureFieldName;const a=e.type;o.isPointEvent="esriLRSPointEventLayer"===a;const s=[o.fromDateFieldName,o.toDateFieldName,o.derivedFromMeasureFieldName,o.derivedRouteIdFieldName,o.derivedRouteNameFieldName,o.derivedToMeasureFieldName,o.fromReferentLocationFieldName,o.fromReferentMethodFieldName,o.fromReferentOffsetFieldName,o.toReferentLocationFieldName,o.toReferentMethodFieldName,o.toReferentOffsetFieldName,o.locErrorFieldName,o.eventIdFieldName,o.routeIdFieldName,o.routeNameFieldName,o.fromMeasureFieldName,o.toRouteIdFieldName,o.toRouteNameFieldName,o.toMeasureFieldName],l=null==r?void 0:r.objectIdField,u=null==r?void 0:r.globalIdField,c=null==r?void 0:r.editFieldsInfo,d=[l,u];c&&(d.push(c.creationDateField),d.push(c.creatorField),d.push(c.editDateField),d.push(c.editorField));const f=s.map((e=>re(e)?e.toLowerCase():e)),m=d.map((e=>re(e)?e.toLowerCase():e));o.lrsFields=i.filter((e=>f.includes(e.name.toLowerCase())));const p=i.filter((e=>!f.includes(e.name.toLowerCase())&&!m.includes(e.name.toLowerCase()))),h=[];return p.forEach((e=>{const t={field:e,enabled:!0,editable:!0,description:""};h.push(t)})),o.attributeFields=h,o.parentNetworkId=e.lrsNetworkId,o}function Ji(e,t){return Bi(this,void 0,void 0,(function*(){const r=e+"/attributeSets";let o=null;const i=n.SessionManager.getInstance().getSessionByUrl(t),a=i&&i.token?i.token:"";o=a?{f:"json",token:a}:{f:"json"};const s={attributeSet:[]};return yield Ge({method:"GET",url:r,params:o}).then((e=>{const t=e.attributeSets;return re(t)&&t.forEach((e=>{const t={title:e.title,isDefault:e.isDefault,isPoint:e.isPoint,defaultSettings:e.defaultSettings,layers:e.layers};s.attributeSet.push(t)})),s})).catch((e=>null))}))}function Yi(e,t){if(!re(t))return!1;const n=t.at(e);return!re(n)||!re(n.eventInfo)||n.layerType!==_i.event||t.findIndex((e=>re(e.networkInfo)&&e.networkInfo.lrsNetworkId===n.eventInfo.parentNetworkId))>-1}(0,t.registerStyles)("widgets/shared-code/lrs/ui",e)})(),d})())}}}));