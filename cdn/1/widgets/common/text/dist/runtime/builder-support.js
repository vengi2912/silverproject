System.register(["jimu-core","jimu-ui/advanced/rich-text-editor","jimu-ui","jimu-theme","jimu-for-builder"],(function(e,t){var r={},o={},n={},i={},a={};return{setters:[function(e){r.ArcadeContentCapability=e.ArcadeContentCapability,r.BrowserSizeMode=e.BrowserSizeMode,r.DataSourceManager=e.DataSourceManager,r.DynamicStyleType=e.DynamicStyleType,r.Immutable=e.Immutable,r.React=e.React,r.ReactRedux=e.ReactRedux,r.appActions=e.appActions,r.appConfigUtils=e.appConfigUtils,r.arcadeContentUtils=e.arcadeContentUtils,r.dataSourceUtils=e.dataSourceUtils,r.focusElementInKeyboardMode=e.focusElementInKeyboardMode,r.getAppStore=e.getAppStore,r.hooks=e.hooks,r.jsx=e.jsx},function(e){o.Bubble=e.Bubble,o.RichExpressionBuilderPopper=e.RichExpressionBuilderPopper,o.RichTextEditor=e.RichTextEditor,o.richTextEditorUtils=e.richTextEditorUtils},function(e){n.ModalOverlayIdContext=e.ModalOverlayIdContext,n.defaultMessages=e.defaultMessages,n.richTextUtils=e.richTextUtils,n.sanitizer=e.sanitizer},function(e){i.ThemeSwitchComponent=e.ThemeSwitchComponent},function(e){a.appBuilderSync=e.appBuilderSync}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=i},4108:e=>{"use strict";e.exports=a},14321:e=>{"use strict";e.exports=n},33949:e=>{"use strict";e.exports=o},79244:e=>{"use strict";e.exports=r}},t={};function l(r){var o=t[r];if(void 0!==o)return o.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,l),n.exports}l.d=(e,t)=>{for(var r in t)l.o(t,r)&&!l.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="";var s={};return l.p=window.jimuConfig.baseUrl,(()=>{"use strict";l.r(s),l.d(s,{default:()=>Q});var e={};l.r(e),l.d(e,{DATA_SOURCE_ID_REGEXP:()=>C,canAddArcadeContent:()=>D,getDefaultValue:()=>x,getExpressionParts:()=>a,getInvalidDataSourceIds:()=>w,getMainDataSourceIds:()=>T,getOtherArcadeContentCount:()=>O,getUseDataSourceIds:()=>I,sanitizeHTML:()=>A,shouldShowPlaceholder:()=>v});var t=l(79244),r=l(33949),o=l(14321);const n=(e,t)=>{const r=o.richTextUtils.getHTMLTextContent(e);return e.replace(null==r?void 0:r.trim(),t)},i=(e,t)=>(t.forEach((e=>{var t;const r=null===(t=null==e?void 0:e.attributes)||void 0===t?void 0:t.linespace;r&&isNaN(Number(r))&&(e.attributes.linespace=1.5)})),t),a=e=>{let t=[];for(const r in e){const o=e[r];null!=(null==o?void 0:o.parts)&&(t=t.concat(null==o?void 0:o.parts))}return t};var c,d,u,p,h,g,f,S,m;!function(e){e.Small="SMALL",e.Medium="MEDIUM",e.Large="LARGE"}(c||(c={})),function(e){e.String="STRING",e.Number="NUMBER",e.Date="DATE",e.DateOnly="DATE_ONLY",e.TimeOnly="TIME_ONLY"}(d||(d={})),function(e){e.BigInteger="esriFieldTypeBigInteger",e.Blob="esriFieldTypeBlob",e.Date="esriFieldTypeDate",e.DateOnly="esriFieldTypeDateOnly",e.TimeOnly="esriFieldTypeTimeOnly",e.Double="esriFieldTypeDouble",e.Geometry="esriFieldTypeGeometry",e.GlobalID="esriFieldTypeGlobalID",e.GUID="esriFieldTypeGUID",e.Integer="esriFieldTypeInteger",e.OID="esriFieldTypeOID",e.Raster="esriFieldTypeRaster",e.Single="esriFieldTypeSingle",e.SmallInteger="esriFieldTypeSmallInteger",e.String="esriFieldTypeString",e.XML="esriFieldTypeXML"}(u||(u={})),function(e){e.Fetching="FETCHING",e.Success="SUCCESS",e.Error="ERROR"}(p||(p={})),function(e){e.Design="DESIGN",e.Run="RUN",e.Express="EXPRESS"}(h||(h={})),function(e){e.Opened="OPENED",e.Active="ACTIVE",e.Closed="CLOSED",e.Hidden="HIDDEN"}(g||(g={})),function(e){e.None="NONE",e.Page="PAGE",e.Dialog="DIALOG",e.View="VIEW",e.WebAddress="WEB_ADDRESS",e.Block="BLOCK",e.Screen="SCREEN",e.PageTop="PAGE_TOP",e.PrintPreview="PRINT_PREVIEW",e.CookieBanner="COOKIE_BANNER"}(f||(f={})),function(e){e.CurrentWindow="_self",e.TopWindow="_top",e.NewWindow="_blank"}(S||(S={})),function(e){e.Normal="NORMAL",e.Layout="LAYOUT"}(m||(m={}));var E,b;!function(e){e.Header="HEADER",e.Footer="FOOTER",e.Body="BODY"}(E||(E={})),function(e){e.Http="http:",e.Https="https:"}(b||(b={}));var _,y;!function(e){e.Image="IMAGE",e.Config="CONFIG"}(_||(_={})),function(e){e.EXB_DATA_SOURCE_ID_SET_TO_CREATED_JS_API_LAYER="_exb_data_source_id_set_to_created_js_api_layer",e.EXB_OID="_exb_oid",e.EXB_NOT_EDITABLE="_exb_not_editable",e.EXB_DATA_SOURCE="__exb_data_source",e.EXB_DATA_SET="__exb_data_set",e.EXB_LAYER_VIEW_IGNORE_SPATIAL_FILTER="__exb_layer_view_ignore_spatial_filter",e.EXB_LAYER_FROM_RUNTIME="__exb_layer_from_runtime",e.EXB_DATA_SOURCE_ID="__exb_data_source_id",e.EXB_JIMU_LAYER_VIEW_ID="__exb_jimu_layer_view_id",e.EXB_PREDEFINED_RENDERER="__exb_predefined_renderer"}(y||(y={}));const R={};R[c.Large]=[{width:1024,height:768},{width:1280,height:800},{width:1280,height:1024},{width:1366,height:768},{width:1440,height:900},{width:1536,height:864},{width:1600,height:900},{width:1920,height:1080}],R[c.Medium]=[{width:601,height:962},{width:600,height:1024},{width:768,height:1024},{width:800,height:1280},{width:834,height:1112}],R[c.Small]=[{width:360,height:640},{width:360,height:720},{width:360,height:740},{width:375,height:667},{width:414,height:736}];const C=/data-dsid=\"(((?![\=|\>|\"]).)*)[\"\>|"\s)]/gm,T=(e=(0,t.Immutable)([]))=>e.map((e=>{return r=null==e?void 0:e.dataSourceId,null!=t.DataSourceManager.getInstance().getDataSource(r)?null==e?void 0:e.mainDataSourceId:null;var r})).filter((e=>null!=e)),I=e=>{const t=C;let r,o=[];for(;null!==(r=t.exec(e));){let e=r[1];e.indexOf(",")>0?(e=e.split(","),o=o.concat(e)):o.push(e)}return o},w=(e,r)=>{const o=I(e);if(null==o||!o.length)return;let n=o.map((e=>t.dataSourceUtils.getMainDataSourceId(e))).filter((e=>null!=e));n=Array.from(new Set(n));const i=T(r);return n.filter((e=>!i.includes(e)))},v=(e,t,r)=>{const n=o.richTextUtils.isBlankRichText(e)&&!!t;return void 0!==r?!r&&n:n},A=(e="")=>""!==e?o.sanitizer.sanitize(e):e,x=(e,t,r="")=>{let o=t;const i=v(t,r);return e?i&&(o=n(r,"\ufeff")):o=i?r:t,A(o)},O=(e,r)=>{const n=o.richTextUtils.getArcades(e),i=Object.keys(n).length,a=t.arcadeContentUtils.getWidgetRestAvailableArcadeContentCount(r);if(a===1/0)return 1/0;return 10-a-i},D=(e,r,n)=>{if(e===1/0)return(0,t.getAppStore)().dispatch(t.appActions.widgetStatePropChange(n,"canAddArcadeContent",!0)),void(0,t.getAppStore)().dispatch(t.appActions.widgetToolbarStateChange(n,["text-arcade"]));const i=o.richTextUtils.getArcades(r),a=10-e-Object.keys(i).length>0;(0,t.getAppStore)().dispatch(t.appActions.widgetStatePropChange(n,"canAddArcadeContent",a)),(0,t.getAppStore)().dispatch(t.appActions.widgetToolbarStateChange(n,["text-arcade"]))};var M=function(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(r[o[n]]=e[o[n]])}return r};const{useEffect:B,useRef:U,useState:P,useMemo:j}=t.React,N={toolbar:!1,autoformat:{link:{trigger:/[\s]/,find:/https?:\/\/[\S]+|(www\.[\S]+)/gi,transform:function(e,t){return t?"http://"+e:e},format:"link"}},clipboard:{matchers:[["p",i],["li",i],["h1",i],["h2",i],["h3",i],["h4",i],["h5",i],["h6",i]]}},F=/(?!^\n$)[\n]/gm,L=(e,t)=>(t.forEach((e=>{"string"==typeof e.insert&&(e.insert=e.insert.replace(F," "))})),t),k=e=>{e.clipboard.addMatcher("*",L)},G=(e,t)=>{if(null==e)return;const o=(e=>{const t=e.clipboard.matchers;let r=-1;if(t.some((([e,t],o)=>"*"===e&&t===L&&(r=o,!0))),r>-1)return e.clipboard.matchers.splice(r,1),!0})(e);t=A(t);const n=e.clipboard.convert({html:t});e.setContents(n,"silent"),r.richTextEditorUtils.setEditorCursorEnd(e,"silent"),o&&k(e)},z=e=>{const{editorRef:i,value:a,placeholder:l,enabled:s,widgetId:c,onChange:d,onComplete:u}=e,p=M(e,["editorRef","value","placeholder","enabled","widgetId","onChange","onComplete"]),h=t.React.useContext(o.ModalOverlayIdContext),g=t.React.useMemo((()=>Object.assign(Object.assign({},N),{imageResize:{modalId:h}})),[h]),[f,S]=t.hooks.useForwardRef(i),[m,E]=P(a),[b,_]=P(l),y=((e,t,r,o,n)=>{const i=U({enabled:e,value:t,placeholder:r,onChange:o,onComplete:n});return B((()=>{i.current={enabled:e,value:t,placeholder:r,onChange:o,onComplete:n}}),[e,t,r,o,n]),i})(s,m,b,d,u),[R,C]=P(),T=j((()=>x(s,m,b)),[]);B((()=>{const e=O(a,c);C(e),D(e,a,c)}),[a,c]);const I=t.hooks.useEventCallback(((e,t,r)=>{"silent"!==r&&(v(m,b,s)?_(e):(E(e),null==d||d(e)),D(R,e,c))}));return t.hooks.useUpdateEffect((()=>{if(_(l),v(m,l)){const e=f.current;G(e,l)}}),[l]),t.hooks.useUpdateEffect((()=>{const{value:e,placeholder:r,onComplete:o}=y.current,i=f.current;if(s){const o=f.current;if(v(e,r)){const e=n(r,"\ufeff");G(o,e),(0,t.focusElementInKeyboardMode)(o,!0)}}else v(e,r)&&G(i,r),null==o||o(e,r)}),[s]),B((()=>{const e=f.current;null!=e&&k(e)}),[f]),t.hooks.useUnmount((()=>{const{value:e,placeholder:t,enabled:r,onComplete:o}=y.current;r&&(null==o||o(e,t))})),t.React.createElement(r.RichTextEditor,Object.assign({autoFocus:!0,enabled:s,editorRef:S,onChange:I,defaultValue:T,modules:g},p))};var H=l(1888),X=l(4108);const W=[t.ArcadeContentCapability.Value,t.ArcadeContentCapability.Style],V=(0,t.Immutable)([t.DynamicStyleType.Text]),Y=e=>{const{editor:n,formats:i,selection:a,useDataSources:l,widgetId:s,enabled:c,onInitResizeHandler:d}=e,u=t.ReactRedux.useSelector((e=>{var t;return!!(null===(t=e.widgetsState[s])||void 0===t?void 0:t.showExpression)})),p=t.ReactRedux.useSelector((e=>{var t;return!!(null===(t=e.widgetsState[s])||void 0===t?void 0:t.showArcade)})),h=t.ReactRedux.useSelector((e=>e.browserSizeMode)),g=t.ReactRedux.useSelector((e=>{var t;return null===(t=e.appConfig.widgets[s])||void 0===t?void 0:t.uri})),f=t.hooks.useTranslation(o.defaultMessages),[S,m]=t.React.useState(0),[E,b]=t.React.useState(0),_=t.React.useRef(null);t.React.useEffect((()=>{null==d||d((()=>{var e;m((e=>e+1)),null===(e=_.current)||void 0===e||e.classList.add("d-none")}),null,(()=>{var e;b((e=>e+1)),null===(e=_.current)||void 0===e||e.classList.remove("d-none")}))}),[d]);const y=t.React.useMemo((()=>({title:f("dynamicContent"),onClose:()=>{(0,t.getAppStore)().dispatch(t.appActions.widgetStatePropChange(s,"showExpression",!1)),(0,t.getAppStore)().dispatch(t.appActions.widgetToolbarStateChange(s,["text-expression"]))}})),[s,f]);return h===t.BrowserSizeMode.Small&&u&&X.appBuilderSync.publishSidePanelToApp({type:"textExpression",widgetId:s,uri:g,editor:n,formats:i,selection:a,useDataSources:l,active:u}),p&&X.appBuilderSync.publishShowTextArcadePanelBuilder({widgetId:s,editor:n,formats:i,selection:a,useDataSources:l,useTitle:!0,useIcons:!1,dynamicStyleTypes:V,capabilities:W,onModalClose:()=>{X.appBuilderSync.publishShowTextArcadePanelBuilder(null),(0,t.getAppStore)().dispatch(t.appActions.widgetStatePropChange(s,"showArcade",!1)),(0,t.getAppStore)().dispatch(t.appActions.widgetToolbarStateChange(s,["text-arcade"]))}}),t.hooks.useUpdateEffect((()=>{m((e=>e+1))}),[c]),t.React.createElement(H.ThemeSwitchComponent,{useTheme2:!0},t.React.createElement(r.Bubble,{editor:n,formats:i,selection:a,source:"user",version:S}),h!==t.BrowserSizeMode.Small&&u&&t.React.createElement(r.RichExpressionBuilderPopper,{ref:_,version:E,source:"user",editor:n,formats:i,selection:a,open:u,useDataSources:l,header:y,widgetId:s}))};var K=function(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(r[o[n]]=e[o[n]])}return r};const{useMemo:J,useCallback:$}=t.React,q={opacity:.5,background:"var(--sys-color-error-main)",outline:"1px solid white"},Q={Editor:e=>{const{value:r,widgetId:o,useDataSources:n,onComplete:i,onCreate:a,onDestroy:l,onInitResizeHandler:s,enabled:c}=e,d=K(e,["value","widgetId","useDataSources","onComplete","onCreate","onDestroy","onInitResizeHandler","enabled"]),[u,p]=t.React.useState(r),h=((e,t)=>$((r=>null!=r?null==e?void 0:e(r):null==t?void 0:t()),[e,t]))(a,l),g=((e,r,o,n)=>t.React.useMemo((()=>({editor:i,selection:a,formats:l})=>(0,t.jsx)(Y,{editor:i,selection:a,formats:l,widgetId:e,useDataSources:r,enabled:o,onInitResizeHandler:n})),[o,n,r,e]))(o,n,c,s),f=((e,t)=>J((()=>{const r=w(e,t),o={".ql-editor":{lineHeight:1.42}};return null==r||r.forEach((e=>{o[`exp[data-dsid*="${e}"]`]=q})),o}),[e,t]))(u,n);return(0,t.jsx)(z,Object.assign({editorRef:h,css:f,value:r,plugin:g,onChange:p,onComplete:(e,r)=>{const o=t.appConfigUtils.restoreResourceUrl(e);null==i||i(o,r)},enabled:c,widgetId:o},d))},builderUtils:e}})(),s})())}}}));