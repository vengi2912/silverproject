System.register(["jimu-core","jimu-arcgis"],(function(e,t){var r={},i={};return{setters:[function(e){r.AbstractDataAction=e.AbstractDataAction,r.DataLevel=e.DataLevel,r.ExBAddedJSAPIProperties=e.ExBAddedJSAPIProperties},function(e){i.MapViewManager=e.MapViewManager,i.featureUtils=e.featureUtils}],execute:function(){e((()=>{var e={62686:e=>{"use strict";e.exports=i},79244:e=>{"use strict";e.exports=r},88217:e=>{e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAABsklEQVRYCe2WP0vDUBTFz2sLuggZHASX4ORYd4eIi07WybVuOhTrF5BXv0CHIrjVUae2U12EDO7t6CRdBAeHgBR0aJ/vJkUi5OXlplOxB9qG++/8cptXCvx3CdYCZMuDKh4BUw9QLiCcqF8F+noIFIYQkx5kzY/i9vdsALLtQI07epxnH0kV4g6i0IA8H9nqC7aCMK/GA/3pZaqNGqpQkw5kc7Yhc6cdQN5UdbtrHmHMlDEt1Y3ZWcIOoNSFbYgxL4R+XtJlBwDK6SNSs9beUmq7Iek6a2hX9lHeWIezuoLuyysuH58xCj4NHeZwlg386SbzwdkJPHczNKdkZXsrjFGOKzZA82D31zhuRpugrXDFBqC7NYm+Eq7YAMHXt9GDtsAVG2D4/mH06OmHkSs2wGn3CUlboFhdnwSu2AB01HZuH8KjR2Zk7I/ewlieY5jrd4CMju/73JtNrGdvIHHKHMElwHIDC7ABoRq5H3Jl7y1ah/t9H3uH+s+r8Ky18QIyv67JeCjp2g5AXVyIjOY0OhsAB4JhzgPIAsE05wOkQeQwzweQBJHTnEbNJ9mSuNKvRdYP0GGJ/zuVb/EAAAAASUVORK5CYII="}},t={};function o(r){var i=t[r];if(void 0!==i)return i.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,o),n.exports}o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="";var n={};return o.p=window.jimuConfig.baseUrl,(()=>{"use strict";o.r(n),o.d(n,{default:()=>i});var e=o(79244),t=o(62686);o(88217);var r=function(e,t,r,i){return new(r||(r=Promise))((function(o,n){function A(e){try{a(i.next(e))}catch(e){n(e)}}function u(e){try{a(i.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(A,u)}a((i=i.apply(e,t||[])).next())}))};class i extends e.AbstractDataAction{isSupported(t,i,o){return r(this,void 0,void 0,(function*(){var r,o;if(1!==t.length||i!==e.DataLevel.Records)return!1;const n=t[0],A=null===(r=null==n?void 0:n.dataSource)||void 0===r?void 0:r.id,u=null==n?void 0:n.records;if(!n||!A||!u||0===u.length)return!1;const a=this._getActiveJimuMapView();if(!a||a.isDestroyed()||a.isCached())return!1;if(!a.view||!a.view.popupEnabled)return!1;const s=a.getJimuLayerViewByDataSourceId(A);return!(!s||!s.isLayerVisible()||!1===(null===(o=s.layer)||void 0===o?void 0:o.popupEnabled))}))}onExecute(i,o,n){return r(this,void 0,void 0,(function*(){const r=i[0],o=null==r?void 0:r.dataSource,n=null==o?void 0:o.id,A=this._getActiveJimuMapView(),u=null==A?void 0:A.view;if(u){const i=yield t.featureUtils.convertDataRecordSetToFeatureSet(r);let a=(null==i?void 0:i.features)||[];a=a.filter((e=>!!e)),yield this.queryGeometries(o,a),a=a.filter((e=>!!e.geometry)),a.length>0&&(a.forEach((t=>{t[e.ExBAddedJSAPIProperties.EXB_DATA_SOURCE_ID]=n})),yield this._panTo(u,a,o),A.openPopup(a))}return!0}))}_getActiveJimuMapView(){return function(e,r){let i=null;const o=t.MapViewManager.getInstance();if(e){const t=o.getJimuMapViewGroup(e);if(t&&t.jimuMapViews){const e=Object.values(t.jimuMapViews).filter((e=>!!e));e.length>0&&(i=e.find((e=>e.isActive))),!i&&r&&(i=e[0])}}return i}(this.widgetId,!0)}queryGeometries(e,i){return r(this,void 0,void 0,(function*(){const r=i.filter((e=>!e.geometry));if(e&&r.length>0){const i={},o=[];if(r.forEach((e=>{const t=e.getObjectId();if("number"==typeof t){const r=t.toString();o.push(r),i[t]=e}})),o.length>0){const r={outFields:[],objectIds:o,returnGeometry:!0},n=yield e.queryAll(r),A=null==n?void 0:n.records;if((null==A?void 0:A.length)>0){const r=yield t.featureUtils.convertDataRecordSetToFeatureSet({name:"",dataSource:e,records:A}),o=null==r?void 0:r.features;(null==o?void 0:o.length)>0&&o.forEach((e=>{if(e){const t=e.getObjectId(),r=e.geometry;if("number"==typeof t&&r){const e=i[t];e&&(e.geometry=r)}}}))}}}}))}_panTo(e,t,i){return r(this,void 0,void 0,(function*(){let r=null;const i=t.find((e=>e.geometry)),o=null==i?void 0:i.geometry;o&&(o.extent?r=o.extent.center:"esri.geometry.Point"===o.declaredClass&&(r=o)),r&&(yield e.goTo(r))}))}}})(),n})())}}}));