System.register(["jimu-core","jimu-for-builder","jimu-theme","jimu-ui","jimu-ui/basic/color-picker","jimu-ui/basic/list-tree","jimu-ui/basic/sql-expression-runtime"],(function(e,t){var n={},o={},a={},s={},i={},l={},r={};return{setters:[function(e){n.AdvancedExpressionPartType=e.AdvancedExpressionPartType,n.ArcadeContentCapability=e.ArcadeContentCapability,n.ArcadeProfileContextProvider=e.ArcadeProfileContextProvider,n.ArcadeProfileType=e.ArcadeProfileType,n.CONSTANTS=e.CONSTANTS,n.DataSourceManager=e.DataSourceManager,n.DynamicIconPosition=e.DynamicIconPosition,n.DynamicStyleConditionOperator=e.DynamicStyleConditionOperator,n.DynamicStyleConditionSourceType=e.DynamicStyleConditionSourceType,n.DynamicStyleCustomExpressionSourceType=e.DynamicStyleCustomExpressionSourceType,n.DynamicStyleReferenceValueSourceType=e.DynamicStyleReferenceValueSourceType,n.DynamicStyleSourceType=e.DynamicStyleSourceType,n.DynamicStyleType=e.DynamicStyleType,n.EsriFieldType=e.EsriFieldType,n.ExpressionPartType=e.ExpressionPartType,n.Immutable=e.Immutable,n.JimuFieldType=e.JimuFieldType,n.React=e.React,n.arcadeContentUtils=e.arcadeContentUtils,n.classNames=e.classNames,n.css=e.css,n.dynamicStyleUtils=e.dynamicStyleUtils,n.getAppStore=e.getAppStore,n.hooks=e.hooks,n.indexedDBUtils=e.indexedDBUtils,n.injectIntl=e.injectIntl,n.jsx=e.jsx,n.loadArcGISJSAPIModule=e.loadArcGISJSAPIModule,n.lodash=e.lodash,n.moduleLoader=e.moduleLoader,n.urlUtils=e.urlUtils,n.utils=e.utils,n.uuidv1=e.uuidv1},function(e){o.builderAppSync=e.builderAppSync,o.helpUtils=e.helpUtils},function(e){a.Global=e.Global,a.useTheme=e.useTheme,a.useTheme2=e.useTheme2,a.withTheme=e.withTheme},function(e){s.Alert=e.Alert,s.AlertPopup=e.AlertPopup,s.Button=e.Button,s.DistanceUnits=e.DistanceUnits,s.Dropdown=e.Dropdown,s.DropdownButton=e.DropdownButton,s.DropdownItem=e.DropdownItem,s.DropdownMenu=e.DropdownMenu,s.Icon=e.Icon,s.Label=e.Label,s.Loading=e.Loading,s.LoadingType=e.LoadingType,s.Modal=e.Modal,s.ModalBody=e.ModalBody,s.ModalFooter=e.ModalFooter,s.ModalHeader=e.ModalHeader,s.Option=e.Option,s.Popper=e.Popper,s.Radio=e.Radio,s.Select=e.Select,s.Switch=e.Switch,s.Tab=e.Tab,s.Tabs=e.Tabs,s.TextArea=e.TextArea,s.TextInput=e.TextInput,s.Tooltip=e.Tooltip,s.defaultMessages=e.defaultMessages},function(e){i.ThemeColorPicker=e.ThemeColorPicker},function(e){l.List=e.List,l.TreeStyle=e.TreeStyle},function(e){r.ClauseInputEditor=e.ClauseInputEditor}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=a},4108:e=>{"use strict";e.exports=o},5286:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 14"><path fill="#FFF" fill-rule="nonzero" d="M10.056 3.165V2.063H2.892l4.215 4.534A.73.73 0 0 1 7.1 7.602L2.93 11.937h7.125v-.666a.732.732 0 0 1 1.463 0v1.397a.733.733 0 0 1-.732.732H1.213a.73.73 0 0 1-.528-1.239l4.88-5.074L.677 1.83A.732.732 0 0 1 1.213.6h9.574c.404 0 .732.328.732.732v1.833a.733.733 0 0 1-1.463 0"></path></svg>'},9869:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1.5 11a.5.5 0 0 0 .5-.5V2h8.5a.5.5 0 0 0 0-1H2a1 1 0 0 0-1 1v8.5a.5.5 0 0 0 .5.5M5 4h9a1 1 0 0 1 1 1v9a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1m0 1v9h9V5z" clip-rule="evenodd"></path></svg>'},14321:e=>{"use strict";e.exports=s},16428:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M15 2H1v5h14zm-1 1v3H2V3zM5 4H3v1h2zM1 9h14v5H1zm13 4v-3H2v3zm-9-2H3v1h2z" clip-rule="evenodd"></path></svg>'},21935:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.986 1a6.99 6.99 0 0 1 5.723 2.969l-2.551-.938a.5.5 0 1 0-.345.938l4.228 1.555.163-.944.013-.005-.009-.019.6-3.471a.5.5 0 1 0-.985-.17l-.403 2.33A8 8 0 0 0 0 7.5c-.016.277.21.501.486.501a.53.53 0 0 0 .517-.5A7 7 0 0 1 7.986 1M8.015 15a6.99 6.99 0 0 1-5.724-2.969l2.551.938a.497.497 0 0 0 .642-.296.5.5 0 0 0-.297-.642L.96 10.476l-.163.944-.013.005.009.019-.6 3.471a.5.5 0 1 0 .985.17l.403-2.33A8 8 0 0 0 16 8.5a.477.477 0 0 0-.485-.501.53.53 0 0 0-.518.5A7 7 0 0 1 8.015 15"></path></svg>'},23662:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.5 0a.5.5 0 0 0-.5.5V7H.5a.5.5 0 0 0 0 1H7v6.5a.5.5 0 0 0 1 0V8h6.5a.5.5 0 0 0 0-1H8V.5a.5.5 0 0 0-.5-.5"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},30655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},42018:(e,t,n)=>{"use strict";n.d(t,{ArcadeContentBuilder:()=>Y});var o=n(79244),a=n(14321),s=n(1888),i=n(4108),l=n(28996),r=n.n(l),c=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(n[o[a]]=e[o[a]])}return n};const u=e=>{const t=window.SVG,{className:n}=e,a=c(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",n);return t?o.React.createElement(t,Object.assign({className:s,src:r()},a)):o.React.createElement("svg",Object.assign({className:s},a))};var d=n(98657),p=n.n(d),m=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(n[o[a]]=e[o[a]])}return n};const y=e=>{const t=window.SVG,{className:n}=e,a=m(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",n);return t?o.React.createElement(t,Object.assign({className:s,src:p()},a)):o.React.createElement("svg",Object.assign({className:s},a))};var f=n(45508),g=n.n(f),b=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(n[o[a]]=e[o[a]])}return n};const v=e=>{const t=window.SVG,{className:n}=e,a=b(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",n);return t?o.React.createElement(t,Object.assign({className:s,src:g()},a)):o.React.createElement("svg",Object.assign({className:s},a))};var h=n(23662),S=n.n(h),x=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(n[o[a]]=e[o[a]])}return n};const C=e=>{const t=window.SVG,{className:n}=e,a=x(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",n);return t?o.React.createElement(t,Object.assign({className:s,src:S()},a)):o.React.createElement("svg",Object.assign({className:s},a))};var j=n(94064),w=n.n(j),T=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(n[o[a]]=e[o[a]])}return n};const R=e=>{const t=window.SVG,{className:n}=e,a=T(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",n);return t?o.React.createElement(t,Object.assign({className:s,src:w()},a)):o.React.createElement("svg",Object.assign({className:s},a))};var O=n(30655),I=n.n(O),N=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(n[o[a]]=e[o[a]])}return n};const D=e=>{const t=window.SVG,{className:n}=e,a=N(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",n);return t?o.React.createElement(t,Object.assign({className:s,src:I()},a)):o.React.createElement("svg",Object.assign({className:s},a))};var k=n(62838),M=n.n(k),E=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(n[o[a]]=e[o[a]])}return n};const A=e=>{const t=window.SVG,{className:n}=e,a=E(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",n);return t?o.React.createElement(t,Object.assign({className:s,src:M()},a)):o.React.createElement("svg",Object.assign({className:s},a))};var P=n(72259),F=n.n(P),V=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(n[o[a]]=e[o[a]])}return n};const B=e=>{const t=window.SVG,{className:n}=e,a=V(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",n);return t?o.React.createElement(t,Object.assign({className:s,src:F()},a)):o.React.createElement("svg",Object.assign({className:s},a))},L=o.css`
  display: flex;
  flex-direction: column;
  .icons-body {
    overflow: auto;
  }

  .text-input-and-icon-picker {
    width: calc(100% - 16px);
  }
`;const _=(0,s.withTheme)((0,o.injectIntl)((function(e){const t=e.inModal,n=e.expand,s=e.icons,i=o.React.useMemo((()=>{let e=null;return e=(null==s?void 0:s.length)>0?s:(0,o.Immutable)([]),e=e.filter((e=>!!e)),e}),[s]),l=e.onExpandChange,r=e.onClose,c=e.onIconsChange,[u,d]=o.hooks.useLoadedModule("jimu-ui/advanced/setting-components"),p=u&&d?d.SettingRow:null,[m,y]=o.hooks.useLoadedModule("jimu-ui/advanced/resource-selector"),f=y?y.IconPicker:null,g=u&&p&&m&&f,b=o.hooks.useTranslation(a.defaultMessages),v=b("icons"),h=b("add"),S=b("collapse"),x=b("expand"),j=b("close"),w=b("name"),T=b("icon"),O=b("remove"),I=b("duplicatedLabel"),N=o.React.useCallback((e=>{c&&c(e)}),[c]),k=o.React.useCallback((()=>{const e=i.asMutable({deep:!0}),t=function(e){let t="",n=0;function o(e){const t=/^Icon\s+([1-9]\d*)$/,n=e.match(t);return n?Number(n[1]):null}const a=[];(null==e?void 0:e.length)>0&&e.forEach((e=>{const t=null==e?void 0:e.name;t&&a.push(t)}));a.forEach((e=>{const t=o(e);"number"==typeof t&&t>0&&(n=Math.max(n,t))}));let s=n+1;for(;t=`Icon ${s}`,a.includes(t);)s++;return t}(i)||"",n={name:t,data:null};e.push(n);const a=(0,o.Immutable)(e);N(a)}),[i,N]),M=o.React.useCallback((()=>{l&&l(!n)}),[n,l]),E=o.React.useCallback((()=>{r&&r()}),[r]),P=o.React.useRef(i),F=o.React.useCallback((()=>{P.current=(0,o.Immutable)(i.asMutable({deep:!0}))}),[i]),V=o.React.useCallback(((e,t)=>{if(t&&(null==i?void 0:i.length)>0){if(i.find(((n,o)=>(null==n?void 0:n.name)===t&&o!==e)))return{valid:!1,msg:I}}return{valid:!0}}),[I,i]),_=o.React.useCallback((e=>({valid:!0})),[]),U=o.React.useCallback(((e,t)=>{const n=i.map(((n,o)=>{if(o===e){return n.set("name",t)}return n}));N(n)}),[i,N]),z=o.React.useCallback(((e,t)=>{var n;const o=(null===(n=null==t?void 0:t.target)||void 0===n?void 0:n.value)||"";U(e,o)}),[U]),q=o.React.useCallback(((e,t)=>{var n;let o=(null===(n=null==t?void 0:t.target)||void 0===n?void 0:n.value)||"";o=o.trim();if(!(o&&V(e,o).valid)){const t=P.current,n=t&&e<=t.length-1?t[e]:null,o=null==n?void 0:n.name;o&&U(e,o)}}),[U,V]),H=o.React.useCallback(((e,t)=>{const n=i.map(((n,o)=>{if(o===e){return n.set("data",t)}return n}));N(n)}),[i,N]),J=o.React.useCallback((e=>{const t=i.filter(((t,n)=>n!==e));N(t)}),[i,N]),K=!(!t&&!n);return(0,o.jsx)("div",{className:(0,o.classNames)("icons-selector h-100 p-3",e.className),css:L},g&&(0,o.jsx)(o.React.Fragment,null,(0,o.jsx)(p,null,(0,o.jsx)(a.Label,{className:"w-100 d-inline"},v),K&&(0,o.jsx)(a.Button,{className:"add-icon-btn mr-2",icon:!0,size:"sm",type:"tertiary",title:h,"aria-label":h,onClick:k},(0,o.jsx)(C,null)),!t&&(0,o.jsx)(a.Button,{className:"collapse-icon-btn",icon:!0,size:"sm",type:"tertiary",title:n?S:x,"aria-label":n?S:x,onClick:M},n?(0,o.jsx)(R,null):(0,o.jsx)(D,null)),t&&(0,o.jsx)(a.Button,{className:"close-btn",icon:!0,size:"sm",type:"tertiary",title:j,"aria-label":j,onClick:E},(0,o.jsx)(A,null))),K&&(0,o.jsx)("div",{className:"icons-body h-100"},(null==i?void 0:i.length)>0&&(0,o.jsx)(p,{className:"mt-2"},(0,o.jsx)(a.Label,{className:"d-inline",style:{width:"70px"}},w),(0,o.jsx)(a.Label,{className:"d-inline ml-3"},T)),null==i?void 0:i.map(((e,t)=>(0,o.jsx)(p,{key:t},(0,o.jsx)("div",{className:"text-input-and-icon-picker d-flex"},(0,o.jsx)(a.TextInput,{required:!0,size:"sm",style:{width:"70px"},value:(null==e?void 0:e.name)||"",onFocus:F,checkValidityOnChange:e=>V(t,e),checkValidityOnAccept:_,onChange:e=>{z(t,e)},onBlur:e=>{q(t,e)}}),(0,o.jsx)(f,{className:"ml-3",icon:null==e?void 0:e.data,configurableOption:"none",onChange:e=>{H(t,e)},"aria-label":T,setButtonUseColor:!1})),(0,o.jsx)(a.Button,{icon:!0,size:"sm",type:"tertiary",title:O,"aria-label":O,onClick:()=>{J(t)}},(0,o.jsx)(B,null))))))))})));function U(e){var t;if(!e)return null;const n=function(){const e=(0,o.getAppStore)().getState(),t=window.jimuConfig.isBuilder?null==e?void 0:e.appStateInBuilder:e;return null==t?void 0:t.appConfig}();return null===(t=null==n?void 0:n.widgets)||void 0===t?void 0:t[e]}var z=function(e,t,n,o){return new(n||(n=Promise))((function(a,s){function i(e){try{r(o.next(e))}catch(e){s(e)}}function l(e){try{r(o.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}r((o=o.apply(e,t||[])).next())}))};let q=0;const H=o.css`
position: relative;
flex-direction: column;

.hidden {
  visibility: hidden;
}

.script-section {
  position: relative;
  display: flex;
  flex-direction: column;

  .text-area-container {
    position: relative;

    .jimu-input-area {
      textarea {
        height: 100%;
        resize: none;
      }
    }

    .copy-script-btn {
      position: absolute;
      right: 0;
      top: 0;
      cursor: pointer;
    }
  }
}

.arcade-script-stored-locally-tip {
  color: var(--sys-color-surface-overlay-hint, #DCDCDC);
  line-height: 20px;
}

.modal-arcgis-arcade-editor-container {
  position: relative;
  height: 600px;
  max-height: calc(100vh - 298px);

  .modal-arcgis-arcade-editor-overlay {
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
  }
}

.invalid-msg {
  white-space: nowrap;
  align-items: center;
}

arcgis-arcade-editor {
  --arcgis-coding-components-border: 1px solid var(--sys-color-divider-secondary, #585858);
  border-color: var(--sys-color-divider-secondary, #585858);

  calcite-action-bar.main-action-bar,
  arcgis-editor-variables.side-panel,
  arcgis-language-api-panel.side-panel,
  arcgis-arcade-suggestions.side-panel,
  calcite-action-bar.side-action-bar {
    border-color: var(--sys-color-divider-secondary, #585858);
  }
}

.arcade-content-builder-loading {
  background-color: var(--ref-palette-custom1-300);
}

.modal-icons-section {
  height: 40px;
  border: 1px solid var(--sys-color-divider-secondary, #585858);
  border-top: none;
}
`;function J(e){const t=e.invalidMessage,n=e.invalidKeys,s=e.unsupportedReturnTypeLabel;if(t){const i=(0,o.jsx)("div",{className:(0,o.classNames)("invalid-msg d-flex",e.className)},(0,o.jsx)(u,{size:16,color:"var(--sys-color-error-main)"}),(0,o.jsx)(a.Label,{className:"mb-0 ml-1"},t));let l="";return(null==n?void 0:n.length)>0&&(l=s+": "+n.join(", ")),l?(0,o.jsx)(a.Tooltip,{title:l,showArrow:!0,placement:"top"},i):i}return null}function K(e){let t=null;if(null==e||"number"==typeof e||"string"==typeof e||"boolean"==typeof e||e instanceof Date)t=e;else if(e&&"esri.arcade.Dictionary"===e.declaredClass){t={};const n=e.attributes;n&&Object.keys(n).forEach((e=>{t[e]=K(n[e])}))}else G(e)||$(e)?t=e.toString():Array.isArray(e)&&(t=e.map((e=>K(e))));return t}function G(e){return"esri.core.sql.dateonly"===(null==e?void 0:e.declaredRootClass)}function $(e){return"esri.core.sql.timeonly"===(null==e?void 0:e.declaredRootClass)}function W(e,t){if(e&&t){const{profile:n,profileVariableInstances:o,timeZone:a}=t;e.profile=n,e.testData={profileVariableInstances:o,timeZone:a||"system"}}}function X(e,t,n,a,s,i){const l={id:e,title:t,scriptContent:n,valueType:a,icons:s};(null==i?void 0:i.length)>0&&(l.useDataSources=i);return(0,o.Immutable)(l)}function Z(e){return`${o.arcadeContentUtils.doesWidgetHaveRepeatDataSource(e)?o.CONSTANTS.FEATURE_PROFILE_ARCADE_CONTENT_ID_PREFIX:o.CONSTANTS.DATA_SOURCES_PROFILE_ARCADE_CONTENT_ID_PREFIX}${(0,o.uuidv1)()}`}const Y=(0,s.withTheme)((0,o.injectIntl)((function(e){const t=e.onChange,n=e.capabilities,s=o.React.useMemo((()=>(null==n?void 0:n.length)>0?n:[o.ArcadeContentCapability.Value,o.ArcadeContentCapability.Style]),[n]),l=e.useTitle,r=e.widgetId,c=o.React.useRef(r);c.current=r;const u=e.config,d=null==u?void 0:u.id,p=o.React.useMemo((()=>{let e=u;if(e){if(!e.id){const t=Z(r);e=e.set("id",t)}}else{e=X(Z(r),"","",null,[],null)}return e}),[u,r]),m=p.id,f=o.React.useRef(m);f.current=m;const g=e.useDataSources,b=e.dynamicStyleTypes,h=e.modalOnly,S=e.insertMode,x=e.onModalClose,[C,j]=o.React.useState(!1),w=o.React.useRef(null);w.current=g,o.React.useEffect((()=>{const e=w.current;(null==e?void 0:e.length)>0&&function(e){return z(this,void 0,void 0,(function*(){if((null==e?void 0:e.length)>0){const t=o.DataSourceManager.getInstance(),n=e.map((e=>z(this,void 0,void 0,(function*(){try{yield t.createDataSourceByUseDataSource(e)}catch(t){console.error("dsManager.createDataSourceByUseDataSource() error",e,t)}}))));yield Promise.all(n)}}))}(e).then((()=>{j(!0)}))}),[]);const[T,R]=o.hooks.useArcgisArcadeEditor(),O=o.React.useMemo((()=>{if(!d&&m&&m.includes(o.CONSTANTS.DATA_SOURCES_PROFILE_ARCADE_CONTENT_ID_PREFIX)){return!o.arcadeContentUtils.canAddNewDataSourcesProfileArcadeContent(r)}return!1}),[m,d,r]),I=p.title||"",N=p.scriptContent||"",D=p.icons,k=s.includes(o.ArcadeContentCapability.Value),M=s.includes(o.ArcadeContentCapability.Style),E=e.useIcons,A=o.React.useMemo((()=>!!s.includes(o.ArcadeContentCapability.Style)&&!("boolean"==typeof E&&!E)),[s,E]),[P,F]=o.React.useState(!1),V=P||h,B=o.React.useRef(0),[L,Y]=o.React.useState(null),Q=o.React.useRef(null);Q.current=L;const ee=o.React.useRef(!1),[te,ne]=o.React.useState(null),oe=!!te,ae=o.React.useRef(null),[se,ie]=o.React.useState(!1),le=!C||!se||!oe,[re,ce]=o.React.useState(!1),ue=o.React.useRef(null),[de,pe]=o.React.useState(!1),me=!C||!de||!oe,[ye,fe]=o.React.useState(I),ge=o.React.useRef(I),[be,ve]=o.React.useState(N),[he,Se]=o.React.useState(""),[xe,Ce]=o.React.useState([]),[je,we]=o.React.useState(D),Te=o.React.useRef(null),[Re,Oe]=o.React.useState(!1),[Ie,Ne]=o.React.useState(!1),De=o.React.useRef(),[ke,Me]=o.React.useState(!1),Ee=ke?De.current:null,Ae=o.hooks.useTranslation(a.defaultMessages),Pe=Ae("editScriptInArcadeEditor"),Fe=Ae("arcadeEditor"),Ve=Ae("dataSourcesArcadeContentCountLimit"),Be=Ae("scriptInUse"),Le=Ae("addScriptFirst"),_e=Ae("copyToClipboard"),Ue=Ae("scriptCopied"),ze=Ae("arcadeScriptStoredLocally"),qe=Ae("reset"),He=Ae("invalidArcadeScript"),Je=Ae("unsupportedReturnType"),Ke=Ae(S?"insert":"apply"),Ge=Ae("close"),$e=Ae("arcadeScript"),We=Ae("icons");o.React.useEffect((()=>{!function(){z(this,void 0,void 0,(function*(){let e="",t="";try{if(e=yield i.helpUtils.getWidgetHelpLink("advanced-formatting"),e||(e=""),e)try{t=yield o.urlUtils.createShortUrl(e),t||(t="")}catch(e){console.error("can not create short link for Arcade content help url",e),t=""}}catch(e){console.error("get Arcade content help doc url error",e)}ne({url:t||e||""})}))}()}),[]),o.React.useEffect((()=>(function(e){return z(this,void 0,void 0,(function*(){var t;let n=null;try{if(e){const a=U(e),s=(null===(t=null==a?void 0:a.manifest)||void 0===t?void 0:t.name)||e;n=new o.indexedDBUtils.IndexedDBCache(e,s,"arcade"),yield n.init()}}catch(t){console.error("initialize arcade db error",e,t),n=null}return n&&!n.initialized()&&(n=null),n}))}(c.current).then((e=>{De.current=e,Me(!0);const t=f.current;e&&t&&e.get(t).then((e=>{console.log("get Arcade script from indexedDB",t),"string"==typeof e&&e&&ve(e)})).catch((e=>{console.error("get Arcade script from indexedDB error",t,e)}))})),()=>{De.current&&De.current.close()})),[]);const Xe=o.React.useCallback((e=>{t&&(ee.current=!0,t(e))}),[t]),Ze=o.React.useCallback((()=>{const e=Q.current;if(!d&&!N&&!be&&e&&te){const t=function(e,t,n,a,s){var i;let l="";t&&(l=`// Documentation: ${t}\n\n`);let r="";if((null==e?void 0:e.type)===o.ArcadeProfileType.DataSourcesProfile){const d="function getFilteredFeatureSet(ds) {\n  var result = ds.layer;\n  var queryParams = ds.queryParams;\n\n  if (!IsEmpty(queryParams.where)) {\n    result = Filter(result, queryParams.where);\n  }\n\n  if (!IsEmpty(queryParams.geometry)) {\n    result = Intersects(result, queryParams.geometry);\n  }\n\n  return result;\n}\n\n",p=e,m=null===(i=null==p?void 0:p.profileVariableInstances)||void 0===i?void 0:i.$dataSources,y=[];if(m){const f=o.DataSourceManager.getInstance();Object.keys(m).forEach(((e,t)=>{const n=t+1,o=f.getDataSource(e);if(o){const t=`\n// ${o.getLabel()||e}\n// The filteredFeatureSet${n} has already been filtered using spatial filters and attribute filters.\n// var filteredFeatureSet${n} = getFilteredFeatureSet($dataSources["${e}"]);\n// selectedFeatures${n} is the selection view of data source.\n// var selectedFeatures${n} = $dataSources["${e}"].selectedFeatures;\n\n`;y.push(t)}}))}r=d+y.join("")}let c="";if(a&&(null==s?void 0:s.length)>0){function g(e,t){let n=e;const o=`[placeholder_${t}_start]`,a=`[placeholder_${t}_end]`,s=e.indexOf(o),i=e.indexOf(a);if(s>=0&&i>=0){const t=i+a.length;n=e.slice(0,s)+e.slice(t)}return n}c="\nreturn {\n  [placeholder_value_start]value: '',[placeholder_value_end]\n  [placeholder_background_start]background: {\n    // color: 'green',\n    // fillType: 'fill', // 'fit', 'fill', 'center', 'tile', 'stretch'\n    // image: ''\n  },[placeholder_background_end]\n  [placeholder_text_start]text: {\n    // size: 14,\n    // color: 'rgb(0, 0, 255)',\n    // bold: true,\n    // italic: false,\n    // underline: false,\n    // strike: false\n  },[placeholder_text_end]\n  [placeholder_border_start]border: {\n    // border: {\n    //   type: 'dashed', // 'solid', 'dashed', 'dotted', 'double'\n    //   color: 'red',\n    //   width: 1\n    // }\n  },[placeholder_border_end]\n  [placeholder_borderRadius_start]borderRadius: {\n    // unit: 'px', // 'px', 'rem', 'em', 'vw', '%'\n    // number: [5, 5, 5, 5]\n  },[placeholder_borderRadius_end]\n  [placeholder_icon_start]icon: {\n    // name: '',\n    // position: 'LEFT', // 'LEFT', 'RIGHT'\n    // size: 30,\n    // color: 'green'\n  }[placeholder_icon_end]\n};\n  ",n||(c=g(c,"value")),s.includes(o.DynamicStyleType.Background)||(c=g(c,"background")),s.includes(o.DynamicStyleType.Text)||(c=g(c,"text")),s.includes(o.DynamicStyleType.Border)||(c=g(c,"border")),s.includes(o.DynamicStyleType.BorderRadius)||(c=g(c,"borderRadius")),s.includes(o.DynamicStyleType.Icon)||(c=g(c,"icon"));const b=/\[placeholder_\w+_(?:start|end)\]/g;c=c.replace(b,"");const v=/^\s*$(?:\r\n?|\n)/gm;c=c.replace(v,""),c="\n"+c}else c=n?'return "";':"return {};";const u=l+r+c;return u}(e,te.url,k,M,b);t&&t!==N&&ve(t)}}),[d,b,te,be,N,M,k]),Ye=o.React.useRef();Ye.current=Ze;const Qe=o.React.useCallback((e=>{Q.current=e,Y(e),W(ae.current,e),W(ue.current,e),!L&&e&&Ye.current()}),[L]);o.React.useEffect((()=>{te&&Ye.current()}),[te]);const et=o.React.useRef(!1);et.current=l&&!I;const tt=o.React.useRef(!1),nt=o.React.useRef("");nt.current=Ae("arcade"),o.React.useEffect((()=>{if(et.current){q++,tt.current=!0;const e=`${nt.current} ${q}`;fe(e)}return()=>{tt.current&&!ee.current&&q--}}),[]);const ot=o.React.useCallback((()=>{O||(Se(""),Ce([]),Ne(!1),F(!0))}),[O]),at=o.React.useCallback((()=>{!function(){z(this,void 0,void 0,(function*(){try{yield navigator.clipboard.writeText(N),ce(!0)}catch(e){console.error("copy Arcade script error",e)}finally{setTimeout((()=>{ce(!1)}),2e3)}}))}()}),[N]),st=o.React.useCallback((e=>{e&&e.componentOnReady().then((()=>{ie(!0)})).catch((e=>{console.error("ArcgisArcadeEditor componentOnReady error",e)})),ae.current=e,W(e,L)}),[L]),it=Ie||l&&!ye||!be||ye===I&&be===N&&je===D,lt=be!==N&&!(!d&&S),rt=o.React.useCallback((e=>{var t;const n=(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value)||"";fe(n)}),[]),ct=o.React.useCallback((e=>{var t;const n=(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value)||"";ge.current=n}),[]),ut=o.React.useCallback((e=>{var t;!((null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value)||"")&&ge.current&&fe(ge.current)}),[]),dt=o.React.useCallback((()=>{ve(N)}),[N]),pt=o.React.useCallback((e=>{e&&e.componentOnReady().then((()=>{pe(!0)})).catch((e=>{console.error("ArcgisArcadeEditor componentOnReady error",e)})),ue.current=e,W(e,L)}),[L]),mt=o.React.useCallback((e=>{const t=e.detail||"";ve(t)}),[]),yt=o.React.useCallback((()=>{Oe(!Re)}),[Re]),ft=o.React.useCallback((()=>{Oe(!1)}),[]),gt=o.React.useCallback((()=>{Oe(!1)}),[]),bt=o.React.useCallback((e=>{we(e)}),[]),vt=o.React.useCallback((()=>{const e=ue.current;if(!e)return;B.current++,Ne(!0);const t=B.current;(function(e,t,n,a,s){return z(this,void 0,void 0,(function*(){let i=null;const l={valueType:null,errorMsg:s,invalidKeys:[]},r={valueType:null,errorMsg:a,invalidKeys:[]},c=(null==t?void 0:t.script)||"",u=null==t?void 0:t.profile;let d=[];try{const a=t.getTestResult(),p=function(e,t,n){return z(this,void 0,void 0,(function*(){var a,s;let i=[];try{if(1===(null===(a=n.variables)||void 0===a?void 0:a.length)){const a=n.variables[0];if("$feature"===(null==a?void 0:a.name)&&1===(null==e?void 0:e.length)&&e[0]){const a=yield(0,o.loadArcGISJSAPIModule)("esri/arcade"),l=yield a.createArcadeExecutor(t,n);if((null===(s=null==l?void 0:l.fieldsUsed)||void 0===s?void 0:s.length)>0){const t=l.fieldsUsed.slice().map((e=>e.toLocaleLowerCase())),n=e[0].asMutable({deep:!0}),a=o.DataSourceManager.getInstance().getDataSource(n.dataSourceId);if(a){const e=a.getSchema(),o=null==e?void 0:e.fields;if(o){const e=Object.keys(o).filter((e=>t.includes(e.toLocaleLowerCase())));e.length>0&&(delete n.useFieldsInPopupInfo,delete n.useFieldsInSymbol,n.fields=e,i=[n])}}}}}}catch(e){console.error("getArcadeUseDataSources() error",e),i=[]}return i}))}(e,c,u),[m,y]=yield Promise.all([a,p]);if(d=y,m){const e=m.type;if("error"===e)return i=r,i;if("number"===e)i={valueType:o.JimuFieldType.Number,errorMsg:"",invalidKeys:[]};else if("text"===e)i={valueType:o.JimuFieldType.String,errorMsg:"",invalidKeys:[]};else if("date"===e)i={valueType:o.JimuFieldType.Date,errorMsg:"",invalidKeys:[]};else if("dateOnly"===e)i={valueType:o.JimuFieldType.DateOnly,errorMsg:"",invalidKeys:[]};else if("time"===e)i={valueType:o.JimuFieldType.TimeOnly,errorMsg:"",invalidKeys:[]};else if("dictionary"===e){const e=m.value;if(e&&"esri.arcade.Dictionary"===e.declaredClass){const t=e.attributes;if(t){const a=t.value;G(a)?i={valueType:o.JimuFieldType.DateOnly,errorMsg:"",invalidKeys:[]}:$(a)?i={valueType:o.JimuFieldType.TimeOnly,errorMsg:"",invalidKeys:[]}:"number"==typeof a?i={valueType:o.JimuFieldType.Number,errorMsg:"",invalidKeys:[]}:"string"==typeof a?i={valueType:o.JimuFieldType.String,errorMsg:"",invalidKeys:[]}:a instanceof Date?i={valueType:o.JimuFieldType.Date,errorMsg:"",invalidKeys:[]}:null==a&&(i=n?{valueType:null,errorMsg:s,invalidKeys:["value"]}:{valueType:null,errorMsg:"",invalidKeys:[]}),i||(i={valueType:null,errorMsg:s,invalidKeys:["value"]}),i.invalidKeys||(i.invalidKeys=[]);const l=K(e);if(l){delete l.value;const e=o.arcadeContentUtils.validateArcadeScriptResult(l);e.valid||(i.errorMsg=s),i.invalidKeys.push(...e.invalidKeys)}}}}i||(i=l)}}catch(e){console.error("ArcadeEditor can not get test result",e),i=r}return i&&n&&!i.valueType&&!i.errorMsg&&(i=r),i||(i=r),i.invalidKeys||(i.invalidKeys=[]),(null==d?void 0:d.length)>0&&(i.arcadeUseDataSources=d),i}))})(g,e,k,He,Je).then((e=>z(this,void 0,void 0,(function*(){if(B.current!==t)return;Ne(!1);const{valueType:n,errorMsg:o,invalidKeys:a,arcadeUseDataSources:s}=e;if(o)Se(o||He),Ce(a);else{const e=X(m,ye,be,n,je,s);if(Xe(e),Se(""),Ce([]),F(!1),Ee&&m)try{yield Ee.delete(m),console.log("delete Arcade script from indexedDB",m)}catch(e){console.error("delete Arcade script from indexedDB error",m,e)}x&&x()}}))))}),[m,Ee,He,be,je,ye,x,Je,Xe,g,k]),ht=o.React.useCallback((()=>{if(B.current++,F(!1),Ne(!1),!S){let e=p;ye&&ye!==I&&(e=e.set("title",ye)),je!==D&&(e=e.set("icons",je));const t=!d&&e.id&&lt;(t||d&&e!==p)&&Xe(e);Ee&&m&&(t||d)&&Ee.put(m,be).then((()=>{console.log("save Arcade script into indexedDB",m)})).catch((e=>{console.error("save Arcade script into indexedDB error",m,e)}))}x&&x()}),[m,d,p,D,Ee,S,be,je,ye,x,lt,I,Xe]),St=h?"d-none":"d-flex";return(0,o.jsx)("div",{className:(0,o.classNames)("arcade-style-builder p-4 h-100",St,e.className),css:H},!h&&(0,o.jsx)(o.React.Fragment,null,(0,o.jsx)("div",{className:"mb-4","aria-label":Pe},Pe),(0,o.jsx)(a.Button,{className:"mb-4",color:"primary","aria-label":Fe,disabled:O,onClick:ot},Fe),O&&(0,o.jsx)(a.Alert,{className:"w-100 mt-2",form:"basic",text:Ve,type:"warning",withIcon:!0}),!O&&(0,o.jsx)(o.React.Fragment,null,(0,o.jsx)("div",{className:"mb-4","aria-label":Be},Be),(0,o.jsx)("div",{className:"script-section h-100"},(0,o.jsx)("div",{className:"text-area-container h-100"},(0,o.jsx)(a.TextArea,{className:"h-100",disabled:!0,value:N,placeholder:Le}),N&&(0,o.jsx)(a.Tooltip,{title:Ue,open:re,disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0},(0,o.jsx)(a.Button,{className:"copy-script-btn",size:"sm",icon:!0,type:"tertiary",target:"_blank",disableHoverEffect:!0,disableRipple:!0,title:_e,"aria-label":_e,onClick:at},(0,o.jsx)(y,null)))))),T&&R&&(0,o.jsx)(R,{className:"hidden-arcgis-arcade-editor d-none",ref:st,editorOptions:{theme:"vs-dark"},script:be}),le&&(0,o.jsx)(a.Loading,{className:"arcade-content-builder-loading",type:a.LoadingType.Secondary})),(0,o.jsx)(o.ArcadeProfileContextProvider,{usedForArcadeEditor:!0,widgetId:r,useDataSources:g,onProfileContextChange:Qe}),V&&!O&&(0,o.jsx)(a.Modal,{className:(0,o.classNames)("arcade-editor-modal",e.className),css:H,style:{maxWidth:1120,flexDirection:"row"},centered:!0,contentClassName:"border-0 h-100",isOpen:!0,keyboard:!0},(0,o.jsx)(a.ModalHeader,{className:"d-flex justify-content-between align-items-center",toggle:ht},$e),(0,o.jsx)(a.ModalBody,{className:"w-auto pt-2"},l&&(0,o.jsx)("div",{className:"mb-2"},(0,o.jsx)(a.Label,null,Ae("name")),(0,o.jsx)(a.TextInput,{disabled:Ie,value:ye,onChange:rt,onFocus:ct,onBlur:ut})),(0,o.jsx)("div",{className:(0,o.classNames)(["arcade-script-stored-locally-tip-container d-flex align-items-center",{hidden:!lt}])},(0,o.jsx)(v,{color:"var(--sys-color-info-main)"}),(0,o.jsx)("div",{className:"arcade-script-stored-locally-tip ml-2","aria-label":ze},ze),(0,o.jsx)(a.Button,{className:"ml-2",size:"sm",onClick:dt},qe)),T&&R&&(0,o.jsx)("div",{className:"modal-arcgis-arcade-editor-container mt-2"},(0,o.jsx)(R,{className:"modal-arcgis-arcade-editor h-100",ref:pt,editorOptions:{theme:"vs-dark"},script:be,onArcgisScriptChange:mt}),Ie&&(0,o.jsx)("div",{className:"modal-arcgis-arcade-editor-overlay"})),A&&(0,o.jsx)("div",{className:"modal-icons-section d-flex align-items-center w-100"},(0,o.jsx)(a.Button,{className:"ml-2",type:"default",size:"sm","aria-label":We,ref:Te,onClick:yt},We),Re&&(0,o.jsx)(a.Popper,{open:Re,placement:"top-start",reference:Te,toggle:ft,offsetOptions:[0,8]},(0,o.jsx)("div",{className:"modal-icons-selector-container",style:{minWidth:"230px",height:"246px"}},(0,o.jsx)(_,{inModal:!0,expand:!1,icons:je,onClose:gt,onIconsChange:bt})))),me&&(0,o.jsx)(a.Loading,{className:"arcade-content-builder-loading",type:a.LoadingType.Secondary})),(0,o.jsx)(a.ModalFooter,{className:"d-flex flex-column pb-30"},(0,o.jsx)("div",{className:"w-100 d-flex justify-content-between"},(0,o.jsx)(J,{className:"modal-invalid-msg mr-2",invalidMessage:he,invalidKeys:xe,unsupportedReturnTypeLabel:Je}),(0,o.jsx)(a.Button,{type:"primary",className:"ml-auto mr-2",style:{minWidth:"64px",minHeight:"32px"},"aria-label":Ke,disabled:it,onClick:vt},Ie&&(0,o.jsx)(a.Loading,{type:a.LoadingType.Donut,height:20,width:20}),!Ie&&Ke),!S&&(0,o.jsx)(a.Button,{type:"secondary",style:{minWidth:"64px",minHeight:"32px"},"aria-label":Ge,onClick:ht},Ge)))))})));class Q extends o.React.PureComponent{constructor(e){super(e),this.overflowYStyle={overflow:"hidden"},this.__unmount=!1,this.state={SidePopper:null}}componentDidMount(){this.__unmount=!1,o.moduleLoader.loadModule("jimu-ui/advanced/setting-components").then((e=>{!this.__unmount&&this.setState({SidePopper:e.SidePopper})}))}componentWillUnmount(){this.__unmount=!0}render(){const e=this.state.SidePopper,t=this.props.intl.formatMessage({id:"arcade",defaultMessage:a.defaultMessages.arcade});return(0,o.jsx)("div",{className:"arcade-content-builder-popup w-100 h-100"},e&&(0,o.jsx)(e,{isOpen:this.props.isOpen&&!o.urlUtils.getAppIdPageIdFromUrl().pageId,position:"right",toggle:this.props.onClose,trigger:this.props.trigger,backToFocusNode:this.props.backToFocusNode,title:t},(0,o.jsx)("div",{className:"h-100 bg-default border-color-gray-400 component-arcade-content-builder-popup"},(0,o.jsx)("div",{className:"w-100 h-100 arcade-popup"},(0,o.jsx)("div",{style:this.overflowYStyle,className:"h-100"},(0,o.jsx)(Y,Object.assign({},this.props)))))))}}(0,s.withTheme)((0,o.injectIntl)(Q))},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},54337:e=>{"use strict";e.exports=i},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},72259:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M14 8A6 6 0 1 1 2 8a6 6 0 0 1 12 0m1 0A7 7 0 1 1 1 8a7 7 0 0 1 14 0M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8" clip-rule="evenodd"></path></svg>'},76117:e=>{"use strict";e.exports=r},79244:e=>{"use strict";e.exports=n},93303:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M9.438.994c.213 0 .397.146.44.35q.227 1.084.316 1.852.562.242 1.048.599l1.728-.676a.455.455 0 0 1 .556.188l1.42 2.394a.43.43 0 0 1-.091.547 22 22 0 0 1-1.49 1.194q.03.27.03.552 0 .32-.038.63l1.465 1.12a.43.43 0 0 1 .111.563l-1.42 2.394a.454.454 0 0 1-.53.197 23 23 0 0 1-1.807-.66q-.49.35-1.055.586l-.263 1.794a.446.446 0 0 1-.445.376H6.574a.446.446 0 0 1-.44-.35 21 21 0 0 1-.317-1.853 5.3 5.3 0 0 1-1.047-.598l-1.728.675a.455.455 0 0 1-.556-.187l-1.42-2.395a.43.43 0 0 1 .091-.546q.85-.735 1.49-1.194a5.167 5.167 0 0 1 .008-1.183L1.19 6.243a.43.43 0 0 1-.112-.562l1.42-2.395a.455.455 0 0 1 .531-.196q1.078.35 1.807.66c.324-.233.679-.43 1.056-.587l.262-1.794A.446.446 0 0 1 6.6.994zm-.365 1H6.985l-.28 1.866-.467.19q-.353.144-.672.34l-.207.136-.42.293-.476-.197q-.492-.205-1.169-.433l-.221-.074-1.045 1.719L3.59 6.999l-.06.479a4 4 0 0 0-.021.816l.014.144.058.492-.419.294q-.433.304-.979.746l-.177.145 1.043 1.72 1.845-.703.406.29q.307.219.645.384l.228.103.474.199.059.49q.06.507.19 1.177l.043.219h2.088l.282-1.867.466-.19q.354-.144.672-.34l.207-.136.419-.293.476.198q.495.204 1.17.433l.22.072 1.044-1.718-1.56-1.165.06-.479a4 4 0 0 0 .02-.815l-.013-.144-.06-.492.42-.295a18 18 0 0 0 .98-.746l.176-.146-1.043-1.72-1.844.705-.406-.29a4.5 4.5 0 0 0-.646-.385l-.228-.103-.474-.199-.058-.49q-.049-.405-.14-.916zm-1.067 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6m0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4" clip-rule="evenodd"></path></svg>'},93689:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 12"><path fill="#FFF" fill-rule="nonzero" d="M3.333 0C2.597 0 2 .597 2 1.333V4c0 .736-.597 1.333-1.333 1.333H0v1.334h.667A1.333 1.333 0 0 1 2 8v2.667C2 11.403 2.597 12 3.333 12h1.334v-1.333H3.333V7.333C3.333 6.597 2.736 6 2 6c.736 0 1.333-.597 1.333-1.333V1.333h1.334V0m4 0C9.403 0 10 .597 10 1.333V4a1.333 1.333 0 0 0 1.333 1.333H12v1.334h-.667A1.333 1.333 0 0 0 10 8v2.667C10 11.403 9.403 12 8.667 12H7.333v-1.333h1.334V7.333C8.667 6.597 9.264 6 10 6a1.333 1.333 0 0 1-1.333-1.333V1.333H7.333V0z"></path></svg>'},94064:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .54.54 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.54.54 0 0 1 0 .738" clip-rule="evenodd"></path></svg>'},98640:e=>{"use strict";e.exports=l},98657:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11 2v10H3V4.414L5.414 2zM2 4.414a1 1 0 0 1 .293-.707l2.414-2.414A1 1 0 0 1 5.414 1H11a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1zM13.048 3v10.56c0 .265-.214.48-.477.48H4V15h8.571c.79 0 1.429-.645 1.429-1.44V3z" clip-rule="evenodd"></path></svg>'}},t={};function c(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,c),a.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var n in t)c.o(t,n)&&!c.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var u={};return(()=>{"use strict";c.r(u),c.d(u,{DynamicStyleBuilder:()=>ke,DynamicStyleBuilderSwitch:()=>Ae});var e=c(79244),t=c(14321),n=c(1888),o=c(4108),a=c(98640),s=c(23662),i=c.n(s),l=c(62838),r=c.n(l),d=c(9869),p=c.n(d),m=c(93303),y=c.n(m),f=c(28996),g=c.n(f);function b(e){let t=e;return e&&e.asMutable&&(t=e.asMutable({deep:!0})),t}function v(e){return b(e)}function h(e){return null==e||""===e}function S(e){if(!e)return!0;const t=Object.keys(e);return!(t.length>0&&t.some((t=>!h(e[t]))))}function x(){const t={refValueInfo:void 0,items:[]};return(0,e.Immutable)(t)}var C=c(21935),j=c.n(C),w=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(n[o[a]]=e[o[a]])}return n};const T=t=>{const n=window.SVG,{className:o}=t,a=w(t,["className"]),s=(0,e.classNames)("jimu-icon jimu-icon-component",o);return n?e.React.createElement(n,Object.assign({className:s,src:j()},a)):e.React.createElement("svg",Object.assign({className:s},a))};function R(t,n){let o=!1;const a=O(t),s=O(n);return a&&s&&(o=e.utils.isDeepEqual(a,s)),o}function O(e){let t=null;return e&&(t=e.asMutable?e.asMutable({deep:!0}):e),t}function I(t){let n="";if(t)if(e.dynamicStyleUtils.isArcadeExpression(t))n=t.name;else{const e=t.parts;if((null==e?void 0:e.length)>0){n=e.map((e=>(null==e?void 0:e.exp)||"")).join("")}}return n||(n=""),n}const N=e.css`
  .expression-detail {
    position: relative;
    background: var(--sys-color-action-disabled-disabled, #4B4B4B);
    padding: 8px;

    .expression-detail-text {
      color: var(--sys-color-surface-paper-hint, #BDBDBD);
    }

    .refresh-icon {
      position: absolute;
      right: 8px;
      bottom: 8px;
      cursor: pointer;
    }
  }

  .expression-detail.show-refresh-icon {
    .expression-detail-text {
      width: calc(100% - 20px);
    }
  }
`;const D=(0,n.withTheme)((0,e.injectIntl)((function(n){const o=n.onChange,a=n.widgetDynamicContentCapability,s=n.expressions,i=n.selectedExpression||null,l=e.React.useMemo((()=>{const e=(null==s?void 0:s.length)>=0?v(s):[],t=i?b(i):null,n={finalExpressions:e,selectedIndex:-1,expressionRemoved:!1};if(t)if(e.length>0){const o=e.findIndex((e=>R(e,t)));if(o>=0){const a=e.slice();a[o]=t,n.finalExpressions=a,n.selectedIndex=o,n.expressionRemoved=!1}else n.finalExpressions=[t,...e],n.selectedIndex=0,n.expressionRemoved=!0}else n.finalExpressions=[t],n.selectedIndex=0,n.expressionRemoved=!0;else n.finalExpressions=e,n.selectedIndex=-1,n.expressionRemoved=!1;return n}),[s,i]),r=e.React.useCallback((e=>{if(o){let t=null;const n=e.target.value;if("string"==typeof n||"number"==typeof n){const e=parseInt(n,10);e>=0&&(t=l.finalExpressions[e])}o(t)}}),[l.finalExpressions,o]),c=e.React.useMemo((()=>I(i)),[i]),u=e.React.useMemo((()=>{if("single"===a){const t=i||null,n=(null==s?void 0:s.length)>0&&s[0]||null;if(n){if(e.dynamicStyleUtils.getExpressionReturnType(n)){return!R(t,n)}}}return!1}),[s,i,a]),d=e.React.useCallback((()=>{const e=(null==s?void 0:s.length)>0&&s[0]||null;if(o){const t=b(e);o(t)}}),[s,o]),p=e.hooks.useTranslation(t.defaultMessages),m=p("useLatestExpression"),y=e.React.useMemo((()=>{let e="";return"single"===a?e=p("expressionChangedWarning"):"multiple"===a&&(e=p("expressionRemovedWarning")),e}),[p,a]);return(0,e.jsx)("div",{className:"expression-selector w-100",css:N},"multiple"===a&&(0,e.jsx)(t.Select,{className:"expression-list-select mb-2",size:"sm",value:l.selectedIndex,onChange:r},l.finalExpressions.map(((n,o)=>{const a=n.name||I(n);return(0,e.jsx)(t.Option,{key:o,value:o},a)}))),i&&(0,e.jsx)("div",{className:(0,e.classNames)(["expression-detail",{"show-refresh-icon":u}])},(0,e.jsx)("div",{className:"expression-detail-text"},c),u&&(0,e.jsx)(t.Tooltip,{title:m},(0,e.jsx)(t.Button,{className:"refresh-icon",size:"sm",icon:!0,type:"tertiary",target:"_blank",disableHoverEffect:!0,disableRipple:!0,onClick:d},(0,e.jsx)(T,{size:16})))),l.expressionRemoved&&(0,e.jsx)(t.Alert,{className:"w-100 mt-2",form:"basic",text:y,type:"warning",withIcon:!0}))})));var k=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(n[o[a]]=e[o[a]])}return n};const M=e.css`
  .jimu-dropdown-button {
    background-color: var(--ref-palette-neutral-300, #181818) !important;
    border-color: transparent;
  }

  .jimu-dropdown-button:hover:not([aria-expanded="true"]) {
    border-color: transparent;
  }
`,E=e.css`
  .expression-builder-tab.attribute-tab.hide-ds-view-selector {
    .ds-name {
      padding-bottom: 0 !important;
    }

    .main-data-and-view-selector {
      display: none !important;
    }
  }
`;function A(t){let n=null;const o=null==t?void 0:t.parts;if(1===(null==o?void 0:o.length)){const t=o[0];t&&t.type===e.ExpressionPartType.Field&&(n=t.jimuFieldName)}return n||(n=null),n}const P=(0,n.withTheme)((0,e.injectIntl)((function(o){const a=o.onChange,s=o.expression,i=o.hideDsViewSelector,[l,r]=e.React.useState(!1),c=e.React.useCallback((()=>{r((e=>!e))}),[r]),[u,d]=e.hooks.useLoadedModuleComponent("jimu-ui/advanced/expression-builder","AttributeTab"),p=o.expression,m=(null==p?void 0:p.name)||"",y=e.React.useCallback((e=>{const t=A(s)||null;(A(e)||null)!==t&&r(!1),a&&a(e)}),[s,a]),{className:f}=o,g=k(o,["className"]);return(0,e.jsx)(t.Dropdown,{className:(0,e.classNames)(["attribute-dropdown",f]),css:M,activeIcon:!0,size:"sm",menuRole:"dialog",isOpen:l,toggle:c},(0,e.jsx)(n.Global,{styles:E}),(0,e.jsx)(t.DropdownButton,null,m),(0,e.jsx)(t.DropdownMenu,{alignment:"start",offsetOptions:[0,4]},u&&(0,e.jsx)(d,Object.assign({},g,{className:(0,e.classNames)({"hide-ds-view-selector":i}),onChange:y}))))})));var F=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(n[o[a]]=e[o[a]])}return n};const V=e.css`
  .jimu-dropdown-button {
    background-color: var(--ref-palette-neutral-300, #181818) !important;
    border-color: transparent;
  }

  .jimu-dropdown-button:hover:not([aria-expanded="true"]) {
    border-color: transparent;
  }
`,B=e.css`
  .dynamic-style-builder-statistics-dropdown-menu {
    .statistics-tab {
      .main-data-and-view-selector {
        padding-left: 0 !important;
        padding-right: 0 !important;
        padding-top: 0 !important;
      }

      .expression-name {
        display: none;
      }
    }
  }
`;const L=(0,n.withTheme)((0,e.injectIntl)((function(o){const a=o.onChange,[s,i]=e.React.useState(!1),l=e.React.useCallback((()=>{i((e=>!e))}),[i]),[r,c]=e.hooks.useLoadedModuleComponent("jimu-ui/advanced/expression-builder","StatisticsTab"),u=o.expression,d=(null==u?void 0:u.name)||"",p=e.React.useCallback((e=>{i(!1),a&&a(e)}),[a]),{className:m}=o,y=F(o,["className"]);return(0,e.jsx)(t.Dropdown,{className:(0,e.classNames)("statistics-dropdown",m),css:V,activeIcon:!0,size:"sm",menuRole:"dialog",isOpen:s,toggle:l},(0,e.jsx)(n.Global,{styles:B}),(0,e.jsx)(t.DropdownButton,null,d),(0,e.jsx)(t.DropdownMenu,{alignment:"start",offsetOptions:[0,4],className:"p-4 dynamic-style-builder-statistics-dropdown-menu",style:{width:"205px"}},r&&(0,e.jsx)(c,Object.assign({},y,{onChange:p}))))})));var _=c(93689),U=c.n(_),z=c(5286),q=c.n(z);const H=(0,e.Immutable)([e.JimuFieldType.String,e.JimuFieldType.Number]),J=e.css`
  .expression-icon-dropdown-btn {
    border-right: none !important;
    border-color: none !important;
    border-top-right-radius: 0 !important;
    border-bottom-right-radius: 0 !important;
  }

  .attribute-dropdown .jimu-dropdown-button,
  .statistics-dropdown .jimu-dropdown-button {
    border-top-left-radius: 0 !important;
    border-bottom-left-radius: 0 !important;
  }

  .jimu-dropdown-button.expression-icon-dropdown-btn {
    padding-left: 3px !important;
    padding-right: 4px !important;
  }

  .custom-expression-type-dropdown {
    height: 26px;
  }
`;const K=(0,n.withTheme)((0,e.injectIntl)((function(n){const o=n.onChange,a=n.widgetId,s=n.useDataSources,i=n.hideConditionIndicatorCustomAttributeDsViewSelector,l=n.hideConditionIndicatorCustomStatistics,r=n.expression,c=n.sourceType,u=e.hooks.useTranslation(t.defaultMessages),d=e.React.useMemo((()=>{let t=c;return c?t=c:r&&(e.dynamicStyleUtils.isAttributeExpression(r)?t=e.DynamicStyleCustomExpressionSourceType.CustomAttribute:e.dynamicStyleUtils.isStatisticsExpression(r)&&(t=e.DynamicStyleCustomExpressionSourceType.CustomStatistics)),t||(t=e.DynamicStyleCustomExpressionSourceType.CustomAttribute),t}),[r,c]),p=d===e.DynamicStyleCustomExpressionSourceType.CustomAttribute,m=d===e.DynamicStyleCustomExpressionSourceType.CustomStatistics,y=e.React.useMemo((()=>({[e.DynamicStyleCustomExpressionSourceType.CustomAttribute]:{svg:U(),label:u("attribute")},[e.DynamicStyleCustomExpressionSourceType.CustomStatistics]:{svg:q(),label:u("statistics")}})),[u]),f=d&&y[d],g=null==f?void 0:f.svg,[b,v]=e.React.useState(!1),h=e.React.useCallback((()=>{v((e=>!e))}),[v]),S=e.React.useCallback(((e,t)=>{o&&o(e,t)}),[o]),x=e.React.useCallback((e=>{if(e!==d){S(e,null)}}),[S,d]),C=e.React.useCallback((e=>{S(d,e)}),[S,d]),j=e.React.useCallback((e=>{S(d,e)}),[S,d]),w=l?[e.DynamicStyleCustomExpressionSourceType.CustomAttribute]:[e.DynamicStyleCustomExpressionSourceType.CustomAttribute,e.DynamicStyleCustomExpressionSourceType.CustomStatistics];return(0,e.jsx)("div",{className:"custom-expression d-flex align-items-center w-100",css:J},(0,e.jsx)(t.Dropdown,{isOpen:b,toggle:h,className:"custom-expression-type-dropdown"},(0,e.jsx)(t.DropdownButton,{size:"sm",arrow:!1,dot:!0,icon:!0,className:"expression-icon-dropdown-btn text-truncate d-flex justify-content-center align-items-center trigger-dropdown-toggle p-0 jimu-outline-inside"},g&&(0,e.jsx)(t.Icon,{icon:g,className:"m-0 p-0",size:13})),(0,e.jsx)(t.DropdownMenu,{appendToBody:!1,strategy:"fixed"},w.map((n=>{const o=y[n],a=o.svg,s=o.label;return(0,e.jsx)(t.DropdownItem,{key:n,className:"text-default",a11yFocusBack:!1,onClick:()=>{x(n)}},(0,e.jsx)(t.Icon,{icon:a,className:"mr-2",size:13}),(0,e.jsx)("span",null,s))})))),(0,e.jsx)("div",{className:"attribute-statistics-dropdown-container w-100"},p&&(0,e.jsx)(P,{className:"w-100",useDataSources:s,expression:r,widgetId:a,types:H,hideDsViewSelector:i,onChange:C}),m&&(0,e.jsx)(L,{className:"w-100",useDataSources:s,expression:r,widgetId:a,onChange:j})))}))),G=e.css`

`;function $(t,n,o){const a={refValueSourceType:t,expression:n,expressionReturnType:o};return(0,e.Immutable)(a)}const W=(0,n.withTheme)((0,e.injectIntl)((function(n){const o=n.onChange,a=n.widgetId,s=n.useDataSources,i=n.widgetDynamicContentCapability,l=n.hideConditionIndicatorCustomAttributeDsViewSelector,r=n.hideConditionIndicatorCustomStatistics,c=n.configuredExpressionsLabel,u=n.expressions,d=n.refValueInfo,p=d||$(e.DynamicStyleReferenceValueSourceType.CustomAttribute,null,null),m=p.refValueSourceType,y=p.expression,[f,g]=e.hooks.useLoadedModule("jimu-ui/advanced/setting-components"),b=f&&g?g.SettingSection:null,v=f&&g?g.SettingRow:null,h=b&&v,S=e.hooks.useTranslation(t.defaultMessages),x=S("selectConditionIndicator"),C=S("useAttributeStatistics"),j=c||S("useDynamicContentConfigured"),w=m===e.DynamicStyleReferenceValueSourceType.ImportFromDynamicContent,T=m===e.DynamicStyleReferenceValueSourceType.CustomAttribute,R=m===e.DynamicStyleReferenceValueSourceType.CustomStatistics,O=i&&w,I=T||R,N=!((null==u?void 0:u.length)>0||O&&y),k=e.React.useCallback((e=>{o&&o(e)}),[o]);e.React.useEffect((()=>{if(void 0===d){let t=null;if((null==u?void 0:u.length)>0)if("single"===i){const n=u[0];if(n){const o=e.dynamicStyleUtils.getExpressionReturnType(n);o!==e.JimuFieldType.String&&o!==e.JimuFieldType.Number||(t=$(e.DynamicStyleReferenceValueSourceType.ImportFromDynamicContent,n,o))}}else"multiple"===i&&(t=$(e.DynamicStyleReferenceValueSourceType.ImportFromDynamicContent,null,null));k(t)}}),[u,k,d,i]);const M=e.React.useCallback((()=>{let t=null;if("single"===i&&(null==u?void 0:u.length)>0){const n=u[0];if(n){const o=e.dynamicStyleUtils.getExpressionReturnType(n);o!==e.JimuFieldType.String&&o!==e.JimuFieldType.Number||(t=$(e.DynamicStyleReferenceValueSourceType.ImportFromDynamicContent,n,o))}}t||(t=$(e.DynamicStyleReferenceValueSourceType.ImportFromDynamicContent,null,null)),k(t)}),[u,k,i]),E=e.React.useCallback((()=>{const t=$(e.DynamicStyleReferenceValueSourceType.CustomAttribute,null,null);k(t)}),[k]),A=e.React.useCallback(((t,n)=>{const o=n?(0,e.Immutable)(n):null,a=n&&e.dynamicStyleUtils.getExpressionReturnType(n)||null;if(a===e.JimuFieldType.String||a===e.JimuFieldType.Number||!n){const e=p.set("refValueSourceType",t).set("expression",o).set("expressionReturnType",a);k(e)}}),[k,p]),P=e.React.useCallback((t=>{A(e.DynamicStyleReferenceValueSourceType.ImportFromDynamicContent,t)}),[A]),F=e.React.useCallback(((e,t)=>{A(e,t)}),[A]);return h&&(0,e.jsx)(b,{title:x,className:"select-reference-value",css:G},("single"===i||"multiple"===i)&&(0,e.jsx)(v,null,(0,e.jsx)("div",{className:"select-reference-value-radios"},(0,e.jsx)("div",{className:"select-reference-value-radio d-flex"},(0,e.jsx)(t.Radio,{id:"select-reference-value-dynamic-content-radio",name:"select-reference-value",disabled:N,checked:O,className:"dynamic-content-radio",onChange:M}),(0,e.jsx)(t.Label,{for:"select-reference-value-dynamic-content-radio",className:"ml-1 dynamic-content-label","aria-label":j},j)),(0,e.jsx)("div",{className:"select-reference-value-radio d-flex mt-3"},(0,e.jsx)(t.Radio,{id:"select-reference-value-custom-radio",name:"select-reference-value",checked:I,className:"custom-radio",onChange:E}),(0,e.jsx)(t.Label,{for:"select-reference-value-custom-radio",className:"ml-1 custom-label","aria-label":C},C)))),O&&(0,e.jsx)(v,{className:"mt-2"},(0,e.jsx)(D,{widgetDynamicContentCapability:i,expressions:u,selectedExpression:y,onChange:P})),I&&(0,e.jsx)(v,{className:"mt-2"},(0,e.jsx)(K,{widgetId:a,useDataSources:s,sourceType:m,hideConditionIndicatorCustomAttributeDsViewSelector:l,hideConditionIndicatorCustomStatistics:r,expression:y,onChange:F})))})));var X=c(16428),Z=c.n(X),Y=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(n[o[a]]=e[o[a]])}return n};const Q=t=>{const n=window.SVG,{className:o}=t,a=Y(t,["className"]),s=(0,e.classNames)("jimu-icon jimu-icon-component",o);return n?e.React.createElement(n,Object.assign({className:s,src:Z()},a)):e.React.createElement("svg",Object.assign({className:s},a))};const ee=(0,n.withTheme)((0,e.injectIntl)((function(n){var o;const a=n.supportedConditionSourceTypes||[],s=null===(o=n.conditionInfo)||void 0===o?void 0:o.sourceType,i=n.onChange,[l,r]=e.React.useState(!1),c=e.React.useCallback((()=>{r((e=>!e))}),[r]),u=e.React.useCallback((e=>{e!==s&&i&&i(e)}),[i,s]),d=e.hooks.useTranslation(t.defaultMessages),p=d("sourceType"),m=e.React.useMemo((()=>({[e.DynamicStyleConditionSourceType.UserInput]:d("userInput"),[e.DynamicStyleConditionSourceType.Field]:d("field"),[e.DynamicStyleConditionSourceType.Unique]:d("unique"),[e.DynamicStyleConditionSourceType.Statistics]:d("statistics")})),[d]);return(0,e.jsx)("div",{className:"condition-source-type-selector mr-2"},(0,e.jsx)(t.Dropdown,{menuRole:"listbox",activeIcon:!0,isOpen:l,toggle:c,"aria-label":p},(0,e.jsx)(t.DropdownButton,{icon:!0,arrow:!1,dot:!0,size:"sm",type:"primary","data-toggle":"dropdown",title:p},(0,e.jsx)(Q,{className:"text-default dropdown-icon"})),(0,e.jsx)(t.DropdownMenu,{showArrow:!0,strategy:"fixed",alignment:"start",appendToBody:!0},(0,e.jsx)(t.DropdownItem,{header:!0},p),a.map((n=>{const o=m[n]||n;return(0,e.jsx)(t.DropdownItem,{key:n,onClick:()=>{u(n)},active:n===s},o)})))))})));var te=c(76117);const ne=e.css`
  /* override css of InputEditorRender */
  .input-editor > * {
    width: 100% !important;
  }
`,oe=(0,e.Immutable)([e.JimuFieldType.String]),ae=(0,e.Immutable)([e.JimuFieldType.Number]);(0,e.Immutable)([e.JimuFieldType.String,e.JimuFieldType.Number]);const se=(0,n.withTheme)((0,e.injectIntl)((function(t){const n=t.onChange,o=t.widgetId,a=t.useDataSources,s=t.expressionReturnType,i=t.refValueSchemaInfo,l=t.conditionInfo,r=l.sourceType,c=l.valueOptions||((u=null)||(u=null),(d=null)||(d=null),(0,e.Immutable)({value:u,expression:d}));var u,d;const p=(null==c?void 0:c.value)||null,m=(null==c?void 0:c.expression)||null,y=e.React.useMemo((()=>{let e=null;return p&&(e=v(p)),e}),[p]),f=e.React.useMemo((()=>{let t=null;return s===e.JimuFieldType.String?t=oe:s===e.JimuFieldType.Number&&(t=ae),t||(t=(0,e.Immutable)([])),t}),[s]),g=r===e.DynamicStyleConditionSourceType.UserInput||r===e.DynamicStyleConditionSourceType.Unique,b=r===e.DynamicStyleConditionSourceType.Field,h=r===e.DynamicStyleConditionSourceType.Statistics,S=e.React.useCallback((e=>{n&&n(e)}),[n]),x=e.React.useCallback((t=>{const n=(null==t?void 0:t.value)||null,o=c.value;if(!e.utils.isDeepEqual(o,n)){const e=c.set("value",n);S(e)}}),[c,S]),C=e.React.useMemo((()=>{let t=null;if(g&&i){const n=i.jimuFieldName,o=i.dataSourceForSqlInputEditorRender,a=i.fieldSchema,c=i.codedValues,u=!!n&&(null==c?void 0:c.length)>0,d=function(t,n,o){if(!t||!n)return null;let a=null;return t===e.DynamicStyleConditionOperator.StringOperatorIs||t===e.DynamicStyleConditionOperator.StringOperatorIsNot||t===e.DynamicStyleConditionOperator.NumberOperatorIs||t===e.DynamicStyleConditionOperator.NumberOperatorIsNot||t===e.DynamicStyleConditionOperator.NumberOperatorIsGreaterThan||t===e.DynamicStyleConditionOperator.NumberOperatorIsLessThan?n===e.DynamicStyleConditionSourceType.UserInput?a=o?te.ClauseInputEditor.SimpleSelect:te.ClauseInputEditor.TextInput:n===e.DynamicStyleConditionSourceType.Unique&&(a=te.ClauseInputEditor.SimpleSelect):t===e.DynamicStyleConditionOperator.StringOperatorContains?n===e.DynamicStyleConditionSourceType.UserInput&&(a=o?te.ClauseInputEditor.SimpleSelect:te.ClauseInputEditor.TextInput):t===e.DynamicStyleConditionOperator.StringOperatorIsBlank||t===e.DynamicStyleConditionOperator.StringOperatorIsNotBlank?a=te.ClauseInputEditor.BlankSelector:t===e.DynamicStyleConditionOperator.NumberOperatorIsBetween&&(a=te.ClauseInputEditor.DoubleNumberSelector),a}(l.operator,l.sourceType,u);if(d){const i={sourceType:r,inputEditor:d,value:y},l={isEmptyOptionHidden:!0};if(n)o&&a&&(t={runtime:!1,fieldObj:a,dataSource:o,codedValues:c,valueOptions:i,customProps:l,onChange:x});else if(d===te.ClauseInputEditor.TextInput||d===te.ClauseInputEditor.DoubleNumberSelector){const n=function(t){let n=null;const o="test_field";t===e.JimuFieldType.String?n={jimuName:o,name:o,alias:o,type:t,esriType:e.EsriFieldType.String}:t===e.JimuFieldType.Number&&(n={jimuName:o,name:o,alias:o,type:t,esriType:e.EsriFieldType.String,format:null});let a=null;return n&&(a=(0,e.Immutable)(n)),a}(s);n&&(t={runtime:!1,fieldObj:n,dataSource:null,codedValues:null,valueOptions:i,customProps:l,onChange:x})}}}return t}),[l.operator,l.sourceType,r,s,y,x,i,g]),[j,w]=e.hooks.useLoadedModuleComponent("jimu-ui/basic/sql-expression-runtime","InputEditorRender"),T=e.React.useCallback((e=>{const t=c.set("expression",e);S(t)}),[c,S]),R=e.React.useCallback((e=>{const t=c.set("expression",e);S(t)}),[c,S]);return(0,e.jsx)("div",{className:"condition-value-editor",css:ne},g&&j&&w&&C&&(0,e.jsx)(w,Object.assign({},C)),b&&(0,e.jsx)(P,{className:"w-100",useDataSources:a,expression:m,widgetId:o,types:f,onChange:T}),h&&(0,e.jsx)(L,{className:"w-100",useDataSources:a,expression:m,widgetId:o,onChange:R}))}))),ie=e.css`
  position: relative;

  .condition-editor-first-row {
    .if-value-label {
      min-width: 30%;
      max-width: 50%;
      white-space: break-spaces;
      word-break: break-word;
    }

    .condition-editor-operators {
      min-width: 50%;
    }
  }

  .condition-editor-second-row {
    /* When the scroll bar appears, the right side of the condition style builder is cut off. Thew following css is used to fix this issue. */
    .condition-value-editor {
      width: calc(100% - 34px);
    }
  }
`;function le(t){if(t){if(!e.dynamicStyleUtils.validateConditionValueOptions(t.operator,t.sourceType,t.valueOptions)){const e=re(null,null);t=t.set("valueOptions",e)}}return t}function re(t,n){return t||(t=null),n||(n=null),(0,e.Immutable)({value:t,expression:n})}const ce=(0,n.withTheme)((0,e.injectIntl)((function(n){const o=n.onChange,a=n.widgetId,s=n.className,i=n.useDataSources,l=n.refValueInfo,r=n.refValueSchemaInfo,c=null==l?void 0:l.expression,u=(null==l?void 0:l.expressionReturnType)||null,d=n.conditionInfo,p=e.React.useMemo((()=>{let t=null;return t=d?(0,e.Immutable)(d):(0,e.Immutable)({operator:null,sourceType:null,valueOptions:null}),t}),[d]),m=e.React.useMemo((()=>{let t=[];return u===e.JimuFieldType.String?t=[e.DynamicStyleConditionOperator.StringOperatorIs,e.DynamicStyleConditionOperator.StringOperatorIsNot,e.DynamicStyleConditionOperator.StringOperatorContains,e.DynamicStyleConditionOperator.StringOperatorIsBlank,e.DynamicStyleConditionOperator.StringOperatorIsNotBlank]:u===e.JimuFieldType.Number&&(t=[e.DynamicStyleConditionOperator.NumberOperatorIs,e.DynamicStyleConditionOperator.NumberOperatorIsNot,e.DynamicStyleConditionOperator.NumberOperatorIsGreaterThan,e.DynamicStyleConditionOperator.NumberOperatorIsLessThan,e.DynamicStyleConditionOperator.NumberOperatorIsBetween]),t}),[u]),y=p.operator,f=e.React.useMemo((()=>e.dynamicStyleUtils.getSupportedConditionSourceTypesByRefValueExpressionAndOperator(c,y)),[c,y]),g=e.hooks.useTranslation(t.defaultMessages),b=g("ifValue"),v=e.React.useMemo((()=>({[e.DynamicStyleConditionOperator.StringOperatorIs]:g("stringOperatorIs"),[e.DynamicStyleConditionOperator.StringOperatorIsNot]:g("stringOperatorIsNot"),[e.DynamicStyleConditionOperator.StringOperatorContains]:g("stringOperatorContains"),[e.DynamicStyleConditionOperator.StringOperatorIsBlank]:g("stringOperatorIsBlank"),[e.DynamicStyleConditionOperator.StringOperatorIsNotBlank]:g("stringOperatorIsNotBlank"),[e.DynamicStyleConditionOperator.NumberOperatorIs]:g("numberOperatorIs"),[e.DynamicStyleConditionOperator.NumberOperatorIsNot]:g("numberOperatorIsNot"),[e.DynamicStyleConditionOperator.NumberOperatorIsGreaterThan]:g("numberOperatorIsGreaterThan"),[e.DynamicStyleConditionOperator.NumberOperatorIsLessThan]:g("numberOperatorIsLessThan"),[e.DynamicStyleConditionOperator.NumberOperatorIsBetween]:g("numberOperatorIsBetween")})),[g]),h=e.React.useCallback((e=>{o&&o(e)}),[o]),S=e.React.useCallback((t=>{const n=t.target.value;let o=p.set("operator",n);o=function(t,n){if(n){let{operator:o,sourceType:a}=n;a=a||null;let s=a;const i=e.dynamicStyleUtils.getSupportedConditionSourceTypesByRefValueExpressionAndOperator(t,o);i.includes(a)||(s=i.length>0?i[0]:null),s!==a&&(n=n.set("sourceType",s))}return n}(c,o),o=le(o),h(o)}),[p,c,h]),x=e.React.useCallback((t=>{const n=p.sourceType===e.DynamicStyleConditionSourceType.UserInput&&t===e.DynamicStyleConditionSourceType.Unique;let o=p.set("sourceType",t);if(o=le(o),n){const e=re(null,null);o=o.set("valueOptions",e)}h(o)}),[p,h]),C=e.React.useCallback((e=>{const t=p.set("valueOptions",e);h(t)}),[p,h]);return(0,e.jsx)("div",{className:(0,e.classNames)(["condition-editor",s]),css:ie},(0,e.jsx)("div",{className:"condition-editor-first-row d-flex align-items-center"},(0,e.jsx)(t.Label,{className:"if-value-label mr-2 mb-0"},b),(0,e.jsx)(t.Select,{className:"condition-editor-operators",size:"sm",value:y,onChange:S},m.map((n=>{const o=v[n]||n;return(0,e.jsx)(t.Option,{key:n,value:n},o)})))),f.length>0&&(0,e.jsx)("div",{className:"condition-editor-second-row d-flex align-items-center mt-2"},(0,e.jsx)(ee,{supportedConditionSourceTypes:f,conditionInfo:p,onChange:x}),(0,e.jsx)(se,{widgetId:a,useDataSources:i,expressionReturnType:u,refValueSchemaInfo:r,conditionInfo:p,onChange:C})))}))),ue=e.css`
  .background-image, .background-image-fill-type {
    display: none !important;
  }
`;function de(e){if(!e)return!0;return h(e.color)&&S(e.image)}const pe=(0,n.withTheme)((0,e.injectIntl)((function(n){const o=n.SettingComponentsModule,a=n.StyleSettingComponentsModule,s=n.config,i=s||(0,e.Immutable)({}),l=n.onChange,r=o?o.CollapsableResetPanel:null,c=a?a.BackgroundSetting:null,u=r&&c,d=e.React.useCallback((e=>{l&&l(e)}),[l]),p=e.React.useCallback((()=>{d(null)}),[d]),m=e.React.useCallback((e=>{if(!e)return;let t=i;for(const n in e)switch(n){case"fillType":t.fillType!==e[n]&&(t=t.set("fillType",e[n]));break;case"color":t=t.set("color",e[n]);break;case"image":t=t.set("image",e[n])}d(t)}),[i,d]),y=e.hooks.useTranslation(t.defaultMessages);return(0,e.jsx)("div",{className:"background-editor w-100",css:ue},u&&(0,e.jsx)(r,{label:y("background"),isEmpty:de(s),bottomLine:!0,keepMount:!0,onReset:p},(0,e.jsx)(c,{background:s,applyDefaultValue:!1,onChange:m})))}))),me=e.css`
`;const ye=(0,n.withTheme)((0,e.injectIntl)((function(n){const o=n.SettingComponentsModule,a=n.StyleSettingComponentsModule,s=n.config,i=n.config||(0,e.Immutable)({}),l=n.onChange,r=o?o.CollapsableResetPanel:null,c=a?a.TextStyle:null,u=r&&c,d=e.React.useCallback((e=>{l&&l(e)}),[l]),p=e.React.useCallback((()=>{d(null)}),[d]),m=e.React.useCallback(((e,t)=>{const n=i.set(e,t);d(n)}),[i,d]),y=e.hooks.useTranslation(t.defaultMessages);return(0,e.jsx)("div",{className:"simple-text-style-editor w-100",css:me},u&&(0,e.jsx)(r,{label:y("textFormat"),isEmpty:S(s),bottomLine:!0,keepMount:!0,onReset:p},(0,e.jsx)(c,Object.assign({},s,{applyDefaultValue:!1,onChange:m}))))})));var fe=c(54337);const ge=e.css`
.icon-position-select {
  width: 40%;
  flex-shrink: 1;
}
`;function be(e){if(!e)return!0;return h(e.data)&&h(e.position)}const ve=(0,n.withTheme)((0,e.injectIntl)((function(o){const a=o.SettingComponentsModule,s=o.StyleSettingComponentsModule,i=(0,n.useTheme)(),l=(0,n.useTheme2)(),r=o.config,c=r||(0,e.Immutable)({}),u=(null==r?void 0:r.data)||null,d=(null==r?void 0:r.position)||null,p=null==r?void 0:r.size,m=isNaN(p)?void 0:p+"px",y=null==r?void 0:r.color,f=o.onChange,g=a?a.CollapsableResetPanel:null,b=a?a.SettingRow:null,v=s?s.InputUnit:null,[h,S]=e.hooks.useLoadedModule("jimu-ui/advanced/resource-selector"),x=S?S.IconPicker:null,C=g&&b&&h&&x,j=e.React.useCallback((e=>{f&&f(e)}),[f]),w=e.React.useCallback((()=>{j(null)}),[j]),T=e.React.useCallback((e=>{const t=c.set("data",e);j(t)}),[c,j]),R=e.React.useCallback((e=>{const t=e.target.value,n=c.set("position",t);j(n)}),[c,j]),O=e.React.useCallback((e=>{const t=null==e?void 0:e.distance,n=c.set("size",t);j(n)}),[c,j]),I=e.React.useCallback((e=>{const t=c.set("color",e);j(t)}),[c,j]),N=e.hooks.useTranslation(t.defaultMessages),D=N("icon"),k=N("position");return(0,e.jsx)("div",{className:"icon-editor w-100",css:ge},C&&(0,e.jsx)(g,{label:D,isEmpty:be(r),bottomLine:!0,keepMount:!0,onReset:w},(0,e.jsx)(b,{label:D},(0,e.jsx)(x,{icon:u,configurableOption:"none",onChange:T,"aria-label":D,setButtonUseColor:!1})),(0,e.jsx)(b,{label:k},(0,e.jsx)(t.Select,{className:"icon-position-select","aria-label":k,size:"sm",value:d,onChange:R},[e.DynamicIconPosition.Left,e.DynamicIconPosition.Right].map((n=>(0,e.jsx)(t.Option,{key:n,value:n},N(n.toLowerCase())))))),(0,e.jsx)(b,null,(0,e.jsx)(v,{className:"pr-1",units:[t.DistanceUnits.PIXEL],value:m,applyDefaultValue:!1,placeholder:"##",onChange:O}),(0,e.jsx)(fe.ThemeColorPicker,{specificTheme:l||i,value:y,onChange:I}))))}))),he=e.css`
.style-setting--border-setting {
  > .sides {
    width: 46px;
    height: 46px;
    margin-right: 4px !important;

    .jimu-btn.top, .jimu-btn.bottom {
      width: auto;
      left: 11px;
      right: 11px;
    }

    .jimu-btn.left, .jimu-btn.right {
      height: auto;
      top: 11px;
      bottom: 11px;
    }
  }
}
`;function Se(e){return!e||S(e.border)&&S(e.borderTop)&&S(e.borderLeft)&&S(e.borderRight)&&S(e.borderBottom)}const xe=(0,n.withTheme)((0,e.injectIntl)((function(n){const o=n.SettingComponentsModule,a=n.StyleSettingComponentsModule,s=n.config,i=s||(0,e.Immutable)({}),l=n.onChange,r=o?o.CollapsableResetPanel:null,c=a?a.BorderSetting:null,u=r&&c,d=e.React.useCallback((e=>{l&&l(e)}),[l]),p=e.React.useCallback((()=>{d(null)}),[d]),m=e.React.useCallback((e=>{const t=i.set("border",e).without("borderLeft").without("borderRight").without("borderTop").without("borderBottom");d(t)}),[i,d]),y=e.React.useCallback(((t,n)=>{const o=i.set(e.lodash.camelCase(`border-${t}`),n).without("border");d(o)}),[i,d]),f=e.hooks.useTranslation(t.defaultMessages);return(0,e.jsx)("div",{className:"border-editor w-100",css:he},u&&(0,e.jsx)(r,{label:f("border"),isEmpty:Se(s),bottomLine:!0,keepMount:!0,onReset:p},(0,e.jsx)(c,{applyDefaultValue:!1,value:null==s?void 0:s.border,left:null==s?void 0:s.borderLeft,right:null==s?void 0:s.borderRight,top:null==s?void 0:s.borderTop,bottom:null==s?void 0:s.borderBottom,onChange:m,onSideChange:y})))}))),Ce=e.css`
.style-editor-setting-row:last-child .dividing-line {
  display: none;
}
`;const je=(0,n.withTheme)((0,e.injectIntl)((function(t){const n=t.onChange,o=t.className,a=t.dynamicStyleTypes,s=e.React.useMemo((()=>{const t=Object.values(e.DynamicStyleType),n=[];return(null==a?void 0:a.length)>0&&a.forEach((e=>{e&&t.includes(e)&&!n.includes(e)&&n.push(e)})),(0,e.Immutable)(n)}),[a]),i=t.dynamicStyle||(0,e.Immutable)({}),[l,r]=e.hooks.useLoadedModule("jimu-ui/advanced/setting-components"),c=l&&r?r.SettingRow:null,[u,d]=e.hooks.useLoadedModule("jimu-ui/advanced/style-setting-components"),p=l&&r&&u&&d,m=e.React.useCallback(((e,t)=>{let o=i;o=t?o.set(e,t):o.without(e),n&&n(o)}),[i,n]),y=e.React.useCallback((e=>{m("background",e)}),[m]),f=e.React.useCallback((e=>{m("text",e)}),[m]),g=e.React.useCallback((e=>{m("icon",e)}),[m]),b=e.React.useCallback((e=>{m("border",e)}),[m]);return(0,e.jsx)("div",{className:(0,e.classNames)(["style-editor",o]),css:Ce},p&&(null==s?void 0:s.length)>0&&s.map((t=>{let n=null;return t===e.DynamicStyleType.Background?n=(0,e.jsx)(pe,{SettingComponentsModule:r,StyleSettingComponentsModule:d,config:i.background,onChange:y}):t===e.DynamicStyleType.Text?n=(0,e.jsx)(ye,{SettingComponentsModule:r,StyleSettingComponentsModule:d,config:i.text,onChange:f}):t===e.DynamicStyleType.Icon?n=(0,e.jsx)(ve,{SettingComponentsModule:r,StyleSettingComponentsModule:d,config:i.icon,onChange:g}):t===e.DynamicStyleType.Border&&(n=(0,e.jsx)(xe,{SettingComponentsModule:r,StyleSettingComponentsModule:d,config:i.border,onChange:b})),(0,e.jsx)(c,{key:t,className:"style-editor-setting-row"},n)})))})));var we=function(e,t,n,o){return new(n||(n=Promise))((function(a,s){function i(e){try{r(o.next(e))}catch(e){s(e)}}function l(e){try{r(o.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}r((o=o.apply(e,t||[])).next())}))};function Te(){return(0,e.Immutable)({styleSettingsVisible:!1})}function Re(e,t){const n=[],o=function(e){const t=e.map((e=>e.id));return t.length>0?Math.max(...t):null}(e);"number"==typeof o&&n.push(o),"number"==typeof t&&n.push(t);let a=null;return a=n.length>0?Math.max(...n)+1:1,Oe(a)||(a=null),a}function Oe(e){return"number"==typeof e&&e>0&&isFinite(e)&&!isNaN(e)&&Number.isInteger(e)}const Ie=(0,n.withTheme)((0,e.injectIntl)((function(n){var s,l,c,u;const d=n.onChange,m=n.widgetId,f=n.config||x(),b=n.useDataSources,v=n.widgetDynamicContentCapability,S=n.hideConditionIndicatorCustomAttributeDsViewSelector,C=n.hideConditionIndicatorCustomStatistics,j=n.configuredExpressionsLabel,w=n.expressions,T=n.dynamicStyleTypes,R=f.refValueInfo,O=null==R?void 0:R.expression,I=(null==R?void 0:R.expressionReturnType)||null,N=f.items,D=e.React.useMemo((()=>N||(0,e.Immutable)([])),[N]),k=e.React.useRef(null),[M,E]=e.React.useState(!1),A=e.React.useRef(null);A.current=b,e.React.useEffect((()=>{const t=A.current;(null==t?void 0:t.length)>0&&function(t){return we(this,void 0,void 0,(function*(){if((null==t?void 0:t.length)>0){const n=e.DataSourceManager.getInstance(),o=t.map((e=>we(this,void 0,void 0,(function*(){try{yield n.createDataSourceByUseDataSource(e)}catch(t){console.error("dsManager.createDataSourceByUseDataSource() error",e,t)}}))));yield Promise.all(o)}}))}(t).then((()=>{E(!0)}))}),[]);const P=e.React.useMemo((()=>"single"===v||"multiple"===v?v:"none"),[v]),F=e.React.useMemo((()=>{let t=null;return(null==w?void 0:w.length)>0&&(t=w.filter((t=>{if(t&&function(t){const n=null==t?void 0:t.parts;if((null==n?void 0:n.length)>0)return n.some((t=>{if(t){const n=t.type;if(n===e.ExpressionPartType.Field||n===e.ExpressionPartType.Function||n===e.AdvancedExpressionPartType.Arcade)return!0}return!1}));return!1}(t)){const n=e.dynamicStyleUtils.getExpressionReturnType(t);if(n===e.JimuFieldType.String||n===e.JimuFieldType.Number)return!0}return!1}))),t||(t=[]),t}),[w]),[V,B]=e.hooks.useLoadedModule("jimu-ui/advanced/setting-components"),L=V&&B?B.SettingSection:null,_=V&&B?B.SettingRow:null,U=L&&_,z=e.hooks.useTranslation(t.defaultMessages),q=z("changeIndicatorTypeTitle"),H=z("changeIndicatorTypeDescription"),J=z("styleConditions"),K=e.React.useCallback((e=>{d&&d(e)}),[d]),G=e.React.useMemo((()=>function(t){const n={dataSource:null,dataSourceForSqlInputEditorRender:null,jimuFieldName:null,fieldSchema:null,codedValues:null};if(t&&e.dynamicStyleUtils.isAttributeExpression(t)){const o=t.parts||[];if(1===(null==o?void 0:o.length)){const t=o[0];if(t){const o=t.dataSourceId,a=t.jimuFieldName||null;if(n.jimuFieldName=a,a&&o){const t=e.DataSourceManager.getInstance().getDataSource(o);if(t){if(n.dataSource=t,n.dataSourceForSqlInputEditorRender=t,t.isSelectionView&&t.isSelectionView()){const e=t.getMainDataSource();e&&(n.dataSourceForSqlInputEditorRender=e)}if(n.dataSourceForSqlInputEditorRender||(n.dataSourceForSqlInputEditorRender=t),a){const e=t.getSchema();if(e&&e.fields){const t=e.fields,o=(null==t?void 0:t[a])||null;n.fieldSchema=o}const o=n.dataSourceForSqlInputEditorRender;o.getFieldCodedValueList&&(n.codedValues=o.getFieldCodedValueList(a)||null)}}}}}}return n}(O)),[O]),$=e.React.useMemo((()=>{let t=null;return(null==T?void 0:T.length)>0&&(t=T),t||(t=(0,e.Immutable)([])),t}),[T]),[X,Z]=e.React.useState(null),Y=e.React.useCallback(((e,t)=>{let n=f.set("refValueInfo",e);t&&(n=n.set("items",[])),K(n)}),[f,K]),Q=e.React.useCallback((e=>{const t=(null==e?void 0:e.expressionReturnType)||null;if(I&&I!==t&&D.length>0)Z(e);else{Y(e,!1)}}),[I,D.length,Y]),ee=e.React.useCallback((()=>{if(X){Y(X,!0),Z(null)}}),[X,Y]),te=e.React.useCallback((()=>{Z(null)}),[]),ne=e.React.useRef(),[oe,ae]=e.React.useState(null);e.React.useEffect((()=>{m&&o.builderAppSync.publishChangeDynamicStyleStateToApp(m,{conditionId:oe})}),[m,oe]),e.hooks.useUnmount((()=>{m&&o.builderAppSync.publishChangeDynamicStyleStateToApp(m,null)}));const[se,ie]=e.React.useState((0,e.Immutable)({})),le=e.React.useCallback(((e,t)=>{const n=se.set(e,t);ie(n)}),[se]),re=e.React.useCallback(((e,t)=>{if("number"==typeof e){const n=D.map((n=>n.id===e?t:n)),o=f.set("items",n);K(o)}}),[f,D,K]),ue=e.React.useMemo((()=>function(t){let n=null;return t===e.JimuFieldType.String?n={operator:e.DynamicStyleConditionOperator.StringOperatorIs,sourceType:e.DynamicStyleConditionSourceType.UserInput,valueOptions:{value:null,expression:null}}:t===e.JimuFieldType.Number&&(n={operator:e.DynamicStyleConditionOperator.NumberOperatorIs,sourceType:e.DynamicStyleConditionSourceType.UserInput,valueOptions:{value:null,expression:null}}),n?(0,e.Immutable)(n):null}(I)),[I]),de=e.React.useCallback(((t,n)=>{if(t){const o=Re(D,k.current);if(Oe(o)){if(k.current=o,t=t.set("id",o),"number"==typeof n&&n>=0&&n<=D.length){const o=D.asMutable({deep:!0}),a=t.asMutable({deep:!0});o.splice(n,0,a);const s=(0,e.Immutable)(o),i=f.set("items",s);K(i)}else{const e=D.concat(t),n=f.set("items",e);K(n)}ae(t.id);if(e.dynamicStyleUtils.validateConditionInfo(O,null==t?void 0:t.condition)){const e=Te().set("styleSettingsVisible",!0);le(t.id,e)}}}}),[f,D,O,K,le]),pe=e.React.useCallback((()=>{if(ue){const t=function(t,n){n||(n=null);const o={id:t,condition:n,style:null};return(0,e.Immutable)(o)}(null,ue);t&&de(t,null)}}),[de,ue]),me=e.React.useCallback((e=>{if("number"==typeof e){if(e===oe&&ae(null),e in se){const t=se.without(e);ie(t)}const t=D.filter((t=>t.id!==e)),n=f.set("items",t);K(n)}}),[se,f,D,oe,K]),ye=e.React.useCallback(((t,n)=>{var o;const a=null===(o=null==n?void 0:n.props)||void 0===o?void 0:o.itemJsons,s=(null==a?void 0:a.length)>0?a[0]:null;if(s){const o=s.itemKey;if("string"==typeof o){const a=Number(o),s=null==D?void 0:D.find((e=>"number"==typeof e.id&&e.id===a)),i=null==s?void 0:s.condition,l=!!i&&e.dynamicStyleUtils.validateConditionInfo(O,i),r=se[a]||Te();let c=null;if(a!==oe)ae(a),l&&(c=r.set("styleSettingsVisible",!0));else{const e=function(e,t,n){var o,a;const s=null===(o=null==t?void 0:t.event)||void 0===o?void 0:o.target,i=null===(a=null==n?void 0:n.dropZoneInteractable)||void 0===a?void 0:a.target;if(!e||!s||!i)return!1;if(!e.contains(s))return!1;const l=i.querySelector(".jimu-tree-item__draggable"),r=i.querySelector(".style-editor"),c=i.querySelector(".condition-editor");if(l&&(l===s||l.contains(s)))return s.classList.contains("jimu-tree-item__title");if(c&&(c===s||c.contains(s))){const e=c.querySelector(".condition-editor-operators"),t=c.querySelector(".condition-editor-second-row");return(!e||e!==s&&!e.contains(s))&&(!t||t!==s&&!t.contains(s))}if(r&&(r===s||r.contains(s)))return!1;return!0}(null==ne?void 0:ne.current,t,n);e&&(r.styleSettingsVisible?(ae(null),c=r.set("styleSettingsVisible",!1)):l?c=r.set("styleSettingsVisible",!0):(ae(null),c=r.set("styleSettingsVisible",!1)))}c&&c!==r&&le(a,c)}}}),[se,D,O,oe,le]),fe=e.React.useCallback(((t,n)=>{var o;const a=null===(o=null==n?void 0:n.props)||void 0===o?void 0:o.itemJsons;if((null==a?void 0:a.length)>=2){const t=a[1];if((null==t?void 0:t.length)>0){const n=[];D.forEach((e=>{var t;const o=null===(t=null==e?void 0:e.id)||void 0===t?void 0:t.toString();h(o)||n.push(o)}));const o=n.join(","),a=[];t.forEach((e=>{const t=null==e?void 0:e.itemKey;h(t)||a.push(t)}));if(a.join(",")!==o){const t={};D.forEach((e=>{const n=null==e?void 0:e.id;h(n)||(t[n]=e)}));const n=[];a.forEach((e=>{const o=t[e];o&&n.push(o)}));const o=(0,e.Immutable)(n),s=f.set("items",o);K(s)}}}}),[f,D,K]),ge=e.React.useMemo((()=>{const t=[];return D.forEach((n=>{const{id:o,condition:a,style:s}=n,i=se[o]||Te(),l=i.styleSettingsVisible,c=e.dynamicStyleUtils.validateConditionInfo(O,null==n?void 0:n.condition),u=(0,e.jsx)("div",{className:"condition-style-builder-list-item-content w-100"},(0,e.jsx)(ce,{widgetId:m,className:(0,e.classNames)(["p-2",{"condition-editor-show-bottom-border":l}]),useDataSources:b,refValueInfo:R,refValueSchemaInfo:G,expressionReturnType:I,conditionInfo:a,onChange:t=>{const a=n.set("condition",t);re(o,a);const s=e.dynamicStyleUtils.validateConditionInfo(O,t);if(!c&&s){const e=i.set("styleSettingsVisible",!0);le(o,e)}}}),l&&(0,e.jsx)(je,{className:"p-2",dynamicStyleTypes:$,dynamicStyle:s,onChange:e=>{const t=n.set("style",e);re(o,t)}})),d=l?"pressed-setting-icon":"",f={label:z("settings"),iconProps:()=>({icon:y(),size:16,className:d}),action:()=>{const e=i.set("styleSettingsVisible",!i.styleSettingsVisible);le(o,e)}},v={label:z("duplicate"),iconProps:()=>({icon:p(),size:16}),action:()=>{const t=(0,e.Immutable)(n.asMutable({deep:!0})).set("id",null),a=D.findIndex((e=>"number"==typeof e.id&&e.id===o));de(t,a>=0?a+1:null)}},h={label:z("incompleteCondition"),iconProps:()=>({icon:g(),size:16,color:"var(--sys-color-warning-main)"})},S={label:z("remove"),iconProps:()=>({icon:r(),size:16}),action:()=>{me(o)}},x=[];c?x.push(f,v,S):x.push(h,f,S);const C="number"==typeof o&&o===oe,j={itemKey:null==o?void 0:o.toString(),isItemSelectable:!0,itemStateChecked:C,itemStateTitle:"",itemStateCommands:x,itemStateExpanded:!0,itemStateDetailVisible:!0,itemStateDetailContent:u};t.push(j)})),t}),[de,se,$,I,D,O,R,G,me,oe,z,re,le,b,m]),be=(null===(u=null===(c=null===(l=null===(s=n.theme)||void 0===s?void 0:s.sys)||void 0===l?void 0:l.color)||void 0===c?void 0:c.primary)||void 0===u?void 0:u.light)||"#00aabb",ve=e.css`
    /* Loading uses absolute position. */
    position: relative;

    .condition-style-list {
      /* When the scroll bar appears, the right side of the condition style builder is cut off. Thew following 4 width:100% is used to fix this issue. */
      .jimu-tree-item__droppable {
        width: 100%;

        .jimu-tree-item__content {
          width: 100%;

          .jimu-tree-item__body {
            width: 100%;

            .jimu-tree-item__detail-line {
              width: 100%;
            }
          }
        }
      }

      .jimu-tree-command-list > button {
        margin: 0 !important;
        padding: 4px;
      }

      .jimu-tree-command-list > button:has(svg.pressed-setting-icon) {
        background: var(--sys-color-action-select-default, #007F94);
      }

      .jimu-tree-item_focused-true .jimu-tree-item__body:after {
        height: 40px;
        bottom: auto;
      }

      .jimu-tree-item_focused-true .condition-editor:after {
        border-left: .125rem solid ${be};
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
      }

      .jimu-tree-item__body {
        background: transparent !important;

        .jimu-tree-item__main-line, .condition-editor {
          /* TODO: need to replace the color with variable */
          background: #444 !important;
        }

        .style-editor {
          /* TODO: need to replace the color with variable */
          border: 1px solid #444;
          border-top: none;
        }
      }
    }
    `;return(0,e.jsx)("div",{className:"condition-style-builder h-100",css:ve},M&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(W,{widgetId:m,useDataSources:b,widgetDynamicContentCapability:P,hideConditionIndicatorCustomAttributeDsViewSelector:S,hideConditionIndicatorCustomStatistics:C,configuredExpressionsLabel:j,expressions:F,refValueInfo:R,onChange:Q}),U&&ue&&(0,e.jsx)(L,{title:J},(0,e.jsx)(t.Button,{className:"w-100 text-default set-link-btn",onClick:pe,type:"primary",title:z("addStyleCondition"),disabled:!ue},(0,e.jsx)("div",{className:"w-100 px-2 text-truncate"},(0,e.jsx)(t.Icon,{icon:i(),className:"mr-1",size:14}),z("addStyleCondition"))),(0,e.jsx)(a.List,{forwardRef:e=>{ne&&(ne.current=e)},className:"condition-style-list mt-2",treeStyle:a.TreeStyle.Card,dndEnabled:!0,showCheckbox:!1,itemsJson:ge,renderOverrideItemDetailToggle:()=>null,onClickItemBody:ye,onDidDrop:fe})),X&&(0,e.jsx)(t.AlertPopup,{withIcon:!0,severity:"warning",closable:!1,isOpen:!0,title:q,description:H,onClickOk:ee,onClickClose:te})),!M&&(0,e.jsx)(t.Loading,{type:t.LoadingType.Secondary}))})));var Ne=c(42018);const De=(0,n.withTheme)((0,e.injectIntl)((function(t){const n=t.onChange,o=t.widgetId,a=t.config,s=t.useDataSources,i=t.dynamicStyleTypes,l=t.useIcons,r=e.React.useCallback((e=>{n&&n(e)}),[n]);return(0,e.jsx)(Ne.ArcadeContentBuilder,{className:"arcade-style-builder",capabilities:[e.ArcadeContentCapability.Style],useTitle:!1,widgetId:o,useDataSources:s,dynamicStyleTypes:i,useIcons:l,config:a,onChange:r})})));const ke=(0,n.withTheme)((0,e.injectIntl)((function(n){const o=n.onChange,a=n.widgetId,s=n.useDataSources,i=n.widgetDynamicContentCapability,l=n.hideConditionIndicatorCustomAttributeDsViewSelector,r=n.hideConditionIndicatorCustomStatistics,c=n.configuredExpressionsLabel,u=n.expressions,d=n.conditionStyleTypes,p=n.arcacdeStyleTypes,m=n.useIconsForArcade,y=n.config||function(){const t={sourceType:e.DynamicStyleSourceType.Condition,conditionConfig:x(),arcadeConfig:null};return(0,e.Immutable)(t)}(),f=y.conditionConfig,g=y.arcadeConfig,b=e.hooks.useTranslation(t.defaultMessages),v=e.React.useCallback((e=>{if(o){const t=y.set("sourceType",e);o(t)}}),[y,o]),h=e.React.useCallback((e=>{if(o){const t=y.set("conditionConfig",e);o(t)}}),[y,o]),S=e.React.useCallback((e=>{if(o){const t=y.set("arcadeConfig",e);o(t)}}),[y,o]),C=y.sourceType===e.DynamicStyleSourceType.Arcade?e.DynamicStyleSourceType.Arcade:e.DynamicStyleSourceType.Condition,j=e.css`
   > .jimu-tabs-nav {
    margin-left: 16px !important;
    margin-right: 16px !important;
   }
  `;return(0,e.jsx)(t.Tabs,{className:(0,e.classNames)("dynamic-style-builder h-100",n.className),fill:!0,type:"pills",css:j,value:C,onChange:v},(0,e.jsx)(t.Tab,{id:e.DynamicStyleSourceType.Condition,title:b("condition")},(0,e.jsx)(Ie,{widgetId:a,useDataSources:s,widgetDynamicContentCapability:i,hideConditionIndicatorCustomAttributeDsViewSelector:l,hideConditionIndicatorCustomStatistics:r,configuredExpressionsLabel:c,expressions:u,dynamicStyleTypes:d,config:f,onChange:h})),(0,e.jsx)(t.Tab,{id:e.DynamicStyleSourceType.Arcade,title:b("script")},(0,e.jsx)(De,{widgetId:a,useDataSources:s,dynamicStyleTypes:p,useIcons:m,config:g,onChange:S})))})));var Me=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(n[o[a]]=e[o[a]])}return n};const Ee=t=>{const n=window.SVG,{className:o}=t,a=Me(t,["className"]),s=(0,e.classNames)("jimu-icon jimu-icon-component",o);return n?e.React.createElement(n,Object.assign({className:s,src:y()},a)):e.React.createElement("svg",Object.assign({className:s},a))};const Ae=(0,n.withTheme)((0,e.injectIntl)((function(n){const o=n.switchChecked,a=!!n.disabled,s=n.onSwitchChange,[i,l]=e.React.useState(!1),r=e.React.useCallback((()=>{l(!0)}),[]),c=e.React.useCallback((()=>{l(!1)}),[]),u=e.React.useRef(null),d=[];u.current&&d.push(u.current);const[p,m]=e.hooks.useLoadedModuleComponent("jimu-ui/advanced/setting-components","SidePopper"),y=e.hooks.useTranslation(t.defaultMessages)("dynamicStyle"),f=Object.assign(Object.assign({},n),{className:""});return(0,e.jsx)("div",{className:(0,e.classNames)("dynamic-style-builder-switch w-100 d-flex align-items-center",n.className)},(0,e.jsx)("div",{className:"w-100 text-break text-wrap d-inline","aria-label":y},y),(0,e.jsx)("div",{className:"d-flex align-items-center ml-auto"},o&&(0,e.jsx)(t.Button,{ref:u,className:"p-0",type:"tertiary",size:"sm",disabled:a,disableHoverEffect:!0,disableRipple:!0,onClick:r},(0,e.jsx)(Ee,{size:16})),(0,e.jsx)(t.Switch,{disabled:a,checked:o,onChange:s})),!a&&i&&p&&m&&(0,e.jsx)(m,{isOpen:!0,position:"right",toggle:c,trigger:d,title:y},(0,e.jsx)(ke,Object.assign({},f))))})))})(),u})())}}}));